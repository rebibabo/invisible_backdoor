<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/1/27168.c" pos:tabs="8"><function pos:start="1:1" pos:end="81:1"><type pos:start="1:1" pos:end="1:11"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:11">void</name></type> <name pos:start="1:13" pos:end="1:23">musb_packet</name><parameter_list pos:start="1:24" pos:end="3:69">(<parameter pos:start="1:25" pos:end="1:36"><decl pos:start="1:25" pos:end="1:36"><type pos:start="1:25" pos:end="1:36"><name pos:start="1:25" pos:end="1:33">MUSBState</name> <modifier pos:start="1:35" pos:end="1:35">*</modifier></type><name pos:start="1:36" pos:end="1:36">s</name></decl></parameter>, <parameter pos:start="1:39" pos:end="1:54"><decl pos:start="1:39" pos:end="1:54"><type pos:start="1:39" pos:end="1:54"><name pos:start="1:39" pos:end="1:50">MUSBEndPoint</name> <modifier pos:start="1:52" pos:end="1:52">*</modifier></type><name pos:start="1:53" pos:end="1:54">ep</name></decl></parameter>,

                <parameter pos:start="3:17" pos:end="3:25"><decl pos:start="3:17" pos:end="3:25"><type pos:start="3:17" pos:end="3:25"><name pos:start="3:17" pos:end="3:19">int</name></type> <name pos:start="3:21" pos:end="3:25">epnum</name></decl></parameter>, <parameter pos:start="3:28" pos:end="3:34"><decl pos:start="3:28" pos:end="3:34"><type pos:start="3:28" pos:end="3:34"><name pos:start="3:28" pos:end="3:30">int</name></type> <name pos:start="3:32" pos:end="3:34">pid</name></decl></parameter>, <parameter pos:start="3:37" pos:end="3:43"><decl pos:start="3:37" pos:end="3:43"><type pos:start="3:37" pos:end="3:43"><name pos:start="3:37" pos:end="3:39">int</name></type> <name pos:start="3:41" pos:end="3:43">len</name></decl></parameter>, <parameter pos:start="3:46" pos:end="3:59"><decl pos:start="3:46" pos:end="3:59"><type pos:start="3:46" pos:end="3:59"><name pos:start="3:46" pos:end="3:56">USBCallback</name></type> <name pos:start="3:58" pos:end="3:59">cb</name></decl></parameter>, <parameter pos:start="3:62" pos:end="3:68"><decl pos:start="3:62" pos:end="3:68"><type pos:start="3:62" pos:end="3:68"><name pos:start="3:62" pos:end="3:64">int</name></type> <name pos:start="3:66" pos:end="3:68">dir</name></decl></parameter>)</parameter_list>

<block pos:start="5:1" pos:end="81:1">{<block_content pos:start="7:5" pos:end="79:51">

    <decl_stmt pos:start="7:5" pos:end="7:12"><decl pos:start="7:5" pos:end="7:11"><type pos:start="7:5" pos:end="7:7"><name pos:start="7:5" pos:end="7:7">int</name></type> <name pos:start="7:9" pos:end="7:11">ret</name></decl>;</decl_stmt>

    <decl_stmt pos:start="9:5" pos:end="9:27"><decl pos:start="9:5" pos:end="9:26"><type pos:start="9:5" pos:end="9:7"><name pos:start="9:5" pos:end="9:7">int</name></type> <name pos:start="9:9" pos:end="9:11">idx</name> <init pos:start="9:13" pos:end="9:26">= <expr pos:start="9:15" pos:end="9:26"><name pos:start="9:15" pos:end="9:19">epnum</name> <operator pos:start="9:21" pos:end="9:22">&amp;&amp;</operator> <name pos:start="9:24" pos:end="9:26">dir</name></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="11:5" pos:end="11:14"><decl pos:start="11:5" pos:end="11:13"><type pos:start="11:5" pos:end="11:7"><name pos:start="11:5" pos:end="11:7">int</name></type> <name pos:start="11:9" pos:end="11:13">ttype</name></decl>;</decl_stmt>



    <comment type="block" pos:start="15:5" pos:end="23:7">/* ep-&gt;type[0,1] contains:

     * in bits 7:6 the speed (0 - invalid, 1 - high, 2 - full, 3 - slow)

     * in bits 5:4 the transfer type (BULK / INT)

     * in bits 3:0 the EP num

     */</comment>

    <expr_stmt pos:start="25:5" pos:end="25:49"><expr pos:start="25:5" pos:end="25:48"><name pos:start="25:5" pos:end="25:9">ttype</name> <operator pos:start="25:11" pos:end="25:11">=</operator> <ternary pos:start="25:13" pos:end="25:48"><condition pos:start="25:13" pos:end="25:19"><expr pos:start="25:13" pos:end="25:17"><name pos:start="25:13" pos:end="25:17">epnum</name></expr> ?</condition><then pos:start="25:21" pos:end="25:44"> <expr pos:start="25:21" pos:end="25:44"><operator pos:start="25:21" pos:end="25:21">(</operator><name pos:start="25:22" pos:end="25:34"><name pos:start="25:22" pos:end="25:23">ep</name><operator pos:start="25:24" pos:end="25:25">-&gt;</operator><name pos:start="25:26" pos:end="25:29">type</name><index pos:start="25:30" pos:end="25:34">[<expr pos:start="25:31" pos:end="25:33"><name pos:start="25:31" pos:end="25:33">idx</name></expr>]</index></name> <operator pos:start="25:36" pos:end="25:37">&gt;&gt;</operator> <literal type="number" pos:start="25:39" pos:end="25:39">4</literal><operator pos:start="25:40" pos:end="25:40">)</operator> <operator pos:start="25:42" pos:end="25:42">&amp;</operator> <literal type="number" pos:start="25:44" pos:end="25:44">3</literal></expr> </then><else pos:start="25:46" pos:end="25:48">: <expr pos:start="25:48" pos:end="25:48"><literal type="number" pos:start="25:48" pos:end="25:48">0</literal></expr></else></ternary></expr>;</expr_stmt>



    <expr_stmt pos:start="29:5" pos:end="31:59"><expr pos:start="29:5" pos:end="31:58"><name pos:start="29:5" pos:end="29:20"><name pos:start="29:5" pos:end="29:6">ep</name><operator pos:start="29:7" pos:end="29:8">-&gt;</operator><name pos:start="29:9" pos:end="29:15">timeout</name><index pos:start="29:16" pos:end="29:20">[<expr pos:start="29:17" pos:end="29:19"><name pos:start="29:17" pos:end="29:19">dir</name></expr>]</index></name> <operator pos:start="29:22" pos:end="29:22">=</operator> <call pos:start="29:24" pos:end="31:58"><name pos:start="29:24" pos:end="29:35">musb_timeout</name><argument_list pos:start="29:36" pos:end="31:58">(<argument pos:start="29:37" pos:end="29:41"><expr pos:start="29:37" pos:end="29:41"><name pos:start="29:37" pos:end="29:41">ttype</name></expr></argument>,

                    <argument pos:start="31:21" pos:end="31:38"><expr pos:start="31:21" pos:end="31:38"><name pos:start="31:21" pos:end="31:33"><name pos:start="31:21" pos:end="31:22">ep</name><operator pos:start="31:23" pos:end="31:24">-&gt;</operator><name pos:start="31:25" pos:end="31:28">type</name><index pos:start="31:29" pos:end="31:33">[<expr pos:start="31:30" pos:end="31:32"><name pos:start="31:30" pos:end="31:32">idx</name></expr>]</index></name> <operator pos:start="31:35" pos:end="31:36">&gt;&gt;</operator> <literal type="number" pos:start="31:38" pos:end="31:38">6</literal></expr></argument>, <argument pos:start="31:41" pos:end="31:57"><expr pos:start="31:41" pos:end="31:57"><name pos:start="31:41" pos:end="31:57"><name pos:start="31:41" pos:end="31:42">ep</name><operator pos:start="31:43" pos:end="31:44">-&gt;</operator><name pos:start="31:45" pos:end="31:52">interval</name><index pos:start="31:53" pos:end="31:57">[<expr pos:start="31:54" pos:end="31:56"><name pos:start="31:54" pos:end="31:56">idx</name></expr>]</index></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="33:5" pos:end="33:56"><expr pos:start="33:5" pos:end="33:55"><name pos:start="33:5" pos:end="33:22"><name pos:start="33:5" pos:end="33:6">ep</name><operator pos:start="33:7" pos:end="33:8">-&gt;</operator><name pos:start="33:9" pos:end="33:17">interrupt</name><index pos:start="33:18" pos:end="33:22">[<expr pos:start="33:19" pos:end="33:21"><name pos:start="33:19" pos:end="33:21">dir</name></expr>]</index></name> <operator pos:start="33:24" pos:end="33:24">=</operator> <name pos:start="33:26" pos:end="33:30">ttype</name> <operator pos:start="33:32" pos:end="33:33">==</operator> <name pos:start="33:35" pos:end="33:55">USB_ENDPOINT_XFER_INT</name></expr>;</expr_stmt>

    <expr_stmt pos:start="35:5" pos:end="35:29"><expr pos:start="35:5" pos:end="35:28"><name pos:start="35:5" pos:end="35:23"><name pos:start="35:5" pos:end="35:6">ep</name><operator pos:start="35:7" pos:end="35:8">-&gt;</operator><name pos:start="35:9" pos:end="35:18">delayed_cb</name><index pos:start="35:19" pos:end="35:23">[<expr pos:start="35:20" pos:end="35:22"><name pos:start="35:20" pos:end="35:22">dir</name></expr>]</index></name> <operator pos:start="35:25" pos:end="35:25">=</operator> <name pos:start="35:27" pos:end="35:28">cb</name></expr>;</expr_stmt>



    <expr_stmt pos:start="39:5" pos:end="39:32"><expr pos:start="39:5" pos:end="39:31"><name pos:start="39:5" pos:end="39:19"><name pos:start="39:5" pos:end="39:6">ep</name><operator pos:start="39:7" pos:end="39:8">-&gt;</operator><name pos:start="39:9" pos:end="39:14">packey</name><index pos:start="39:15" pos:end="39:19">[<expr pos:start="39:16" pos:end="39:18"><name pos:start="39:16" pos:end="39:18">dir</name></expr>]</index></name><operator pos:start="39:20" pos:end="39:20">.</operator><name pos:start="39:21" pos:end="39:25"><name pos:start="39:21" pos:end="39:21">p</name><operator pos:start="39:22" pos:end="39:22">.</operator><name pos:start="39:23" pos:end="39:25">pid</name></name> <operator pos:start="39:27" pos:end="39:27">=</operator> <name pos:start="39:29" pos:end="39:31">pid</name></expr>;</expr_stmt>

    <comment type="block" pos:start="41:5" pos:end="41:48">/* A wild guess on the FADDR semantics... */</comment>

    <expr_stmt pos:start="43:5" pos:end="43:47"><expr pos:start="43:5" pos:end="43:46"><name pos:start="43:5" pos:end="43:19"><name pos:start="43:5" pos:end="43:6">ep</name><operator pos:start="43:7" pos:end="43:8">-&gt;</operator><name pos:start="43:9" pos:end="43:14">packey</name><index pos:start="43:15" pos:end="43:19">[<expr pos:start="43:16" pos:end="43:18"><name pos:start="43:16" pos:end="43:18">dir</name></expr>]</index></name><operator pos:start="43:20" pos:end="43:20">.</operator><name pos:start="43:21" pos:end="43:29"><name pos:start="43:21" pos:end="43:21">p</name><operator pos:start="43:22" pos:end="43:22">.</operator><name pos:start="43:23" pos:end="43:29">devaddr</name></name> <operator pos:start="43:31" pos:end="43:31">=</operator> <name pos:start="43:33" pos:end="43:46"><name pos:start="43:33" pos:end="43:34">ep</name><operator pos:start="43:35" pos:end="43:36">-&gt;</operator><name pos:start="43:37" pos:end="43:41">faddr</name><index pos:start="43:42" pos:end="43:46">[<expr pos:start="43:43" pos:end="43:45"><name pos:start="43:43" pos:end="43:45">idx</name></expr>]</index></name></expr>;</expr_stmt>

    <expr_stmt pos:start="45:5" pos:end="45:50"><expr pos:start="45:5" pos:end="45:49"><name pos:start="45:5" pos:end="45:19"><name pos:start="45:5" pos:end="45:6">ep</name><operator pos:start="45:7" pos:end="45:8">-&gt;</operator><name pos:start="45:9" pos:end="45:14">packey</name><index pos:start="45:15" pos:end="45:19">[<expr pos:start="45:16" pos:end="45:18"><name pos:start="45:16" pos:end="45:18">dir</name></expr>]</index></name><operator pos:start="45:20" pos:end="45:20">.</operator><name pos:start="45:21" pos:end="45:27"><name pos:start="45:21" pos:end="45:21">p</name><operator pos:start="45:22" pos:end="45:22">.</operator><name pos:start="45:23" pos:end="45:27">devep</name></name> <operator pos:start="45:29" pos:end="45:29">=</operator> <name pos:start="45:31" pos:end="45:43"><name pos:start="45:31" pos:end="45:32">ep</name><operator pos:start="45:33" pos:end="45:34">-&gt;</operator><name pos:start="45:35" pos:end="45:38">type</name><index pos:start="45:39" pos:end="45:43">[<expr pos:start="45:40" pos:end="45:42"><name pos:start="45:40" pos:end="45:42">idx</name></expr>]</index></name> <operator pos:start="45:45" pos:end="45:45">&amp;</operator> <literal type="number" pos:start="45:47" pos:end="45:49">0xf</literal></expr>;</expr_stmt>

    <expr_stmt pos:start="47:5" pos:end="47:51"><expr pos:start="47:5" pos:end="47:50"><name pos:start="47:5" pos:end="47:19"><name pos:start="47:5" pos:end="47:6">ep</name><operator pos:start="47:7" pos:end="47:8">-&gt;</operator><name pos:start="47:9" pos:end="47:14">packey</name><index pos:start="47:15" pos:end="47:19">[<expr pos:start="47:16" pos:end="47:18"><name pos:start="47:16" pos:end="47:18">dir</name></expr>]</index></name><operator pos:start="47:20" pos:end="47:20">.</operator><name pos:start="47:21" pos:end="47:26"><name pos:start="47:21" pos:end="47:21">p</name><operator pos:start="47:22" pos:end="47:22">.</operator><name pos:start="47:23" pos:end="47:26">data</name></name> <operator pos:start="47:28" pos:end="47:28">=</operator> <operator pos:start="47:30" pos:end="47:30">(</operator><name pos:start="47:31" pos:end="47:34">void</name> <operator pos:start="47:36" pos:end="47:36">*</operator><operator pos:start="47:37" pos:end="47:37">)</operator> <name pos:start="47:39" pos:end="47:50"><name pos:start="47:39" pos:end="47:40">ep</name><operator pos:start="47:41" pos:end="47:42">-&gt;</operator><name pos:start="47:43" pos:end="47:45">buf</name><index pos:start="47:46" pos:end="47:50">[<expr pos:start="47:47" pos:end="47:49"><name pos:start="47:47" pos:end="47:49">idx</name></expr>]</index></name></expr>;</expr_stmt>

    <expr_stmt pos:start="49:5" pos:end="49:32"><expr pos:start="49:5" pos:end="49:31"><name pos:start="49:5" pos:end="49:19"><name pos:start="49:5" pos:end="49:6">ep</name><operator pos:start="49:7" pos:end="49:8">-&gt;</operator><name pos:start="49:9" pos:end="49:14">packey</name><index pos:start="49:15" pos:end="49:19">[<expr pos:start="49:16" pos:end="49:18"><name pos:start="49:16" pos:end="49:18">dir</name></expr>]</index></name><operator pos:start="49:20" pos:end="49:20">.</operator><name pos:start="49:21" pos:end="49:25"><name pos:start="49:21" pos:end="49:21">p</name><operator pos:start="49:22" pos:end="49:22">.</operator><name pos:start="49:23" pos:end="49:25">len</name></name> <operator pos:start="49:27" pos:end="49:27">=</operator> <name pos:start="49:29" pos:end="49:31">len</name></expr>;</expr_stmt>

    <expr_stmt pos:start="51:5" pos:end="51:28"><expr pos:start="51:5" pos:end="51:27"><name pos:start="51:5" pos:end="51:19"><name pos:start="51:5" pos:end="51:6">ep</name><operator pos:start="51:7" pos:end="51:8">-&gt;</operator><name pos:start="51:9" pos:end="51:14">packey</name><index pos:start="51:15" pos:end="51:19">[<expr pos:start="51:16" pos:end="51:18"><name pos:start="51:16" pos:end="51:18">dir</name></expr>]</index></name><operator pos:start="51:20" pos:end="51:20">.</operator><name pos:start="51:21" pos:end="51:22">ep</name> <operator pos:start="51:24" pos:end="51:24">=</operator> <name pos:start="51:26" pos:end="51:27">ep</name></expr>;</expr_stmt>

    <expr_stmt pos:start="53:5" pos:end="53:30"><expr pos:start="53:5" pos:end="53:29"><name pos:start="53:5" pos:end="53:19"><name pos:start="53:5" pos:end="53:6">ep</name><operator pos:start="53:7" pos:end="53:8">-&gt;</operator><name pos:start="53:9" pos:end="53:14">packey</name><index pos:start="53:15" pos:end="53:19">[<expr pos:start="53:16" pos:end="53:18"><name pos:start="53:16" pos:end="53:18">dir</name></expr>]</index></name><operator pos:start="53:20" pos:end="53:20">.</operator><name pos:start="53:21" pos:end="53:23">dir</name> <operator pos:start="53:25" pos:end="53:25">=</operator> <name pos:start="53:27" pos:end="53:29">dir</name></expr>;</expr_stmt>



    <if_stmt pos:start="57:5" pos:end="63:28"><if pos:start="57:5" pos:end="59:65">if <condition pos:start="57:8" pos:end="57:20">(<expr pos:start="57:9" pos:end="57:19"><name pos:start="57:9" pos:end="57:19"><name pos:start="57:9" pos:end="57:9">s</name><operator pos:start="57:10" pos:end="57:11">-&gt;</operator><name pos:start="57:12" pos:end="57:15">port</name><operator pos:start="57:16" pos:end="57:16">.</operator><name pos:start="57:17" pos:end="57:19">dev</name></name></expr>)</condition><block type="pseudo" pos:start="59:9" pos:end="59:65"><block_content pos:start="59:9" pos:end="59:65">

        <expr_stmt pos:start="59:9" pos:end="59:65"><expr pos:start="59:9" pos:end="59:64"><name pos:start="59:9" pos:end="59:11">ret</name> <operator pos:start="59:13" pos:end="59:13">=</operator> <call pos:start="59:15" pos:end="59:64"><name pos:start="59:15" pos:end="59:31">usb_handle_packet</name><argument_list pos:start="59:32" pos:end="59:64">(<argument pos:start="59:33" pos:end="59:43"><expr pos:start="59:33" pos:end="59:43"><name pos:start="59:33" pos:end="59:43"><name pos:start="59:33" pos:end="59:33">s</name><operator pos:start="59:34" pos:end="59:35">-&gt;</operator><name pos:start="59:36" pos:end="59:39">port</name><operator pos:start="59:40" pos:end="59:40">.</operator><name pos:start="59:41" pos:end="59:43">dev</name></name></expr></argument>, <argument pos:start="59:46" pos:end="59:63"><expr pos:start="59:46" pos:end="59:63"><operator pos:start="59:46" pos:end="59:46">&amp;</operator><name pos:start="59:47" pos:end="59:61"><name pos:start="59:47" pos:end="59:48">ep</name><operator pos:start="59:49" pos:end="59:50">-&gt;</operator><name pos:start="59:51" pos:end="59:56">packey</name><index pos:start="59:57" pos:end="59:61">[<expr pos:start="59:58" pos:end="59:60"><name pos:start="59:58" pos:end="59:60">dir</name></expr>]</index></name><operator pos:start="59:62" pos:end="59:62">.</operator><name pos:start="59:63" pos:end="59:63">p</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if>

    <else pos:start="61:5" pos:end="63:28">else<block type="pseudo" pos:start="63:9" pos:end="63:28"><block_content pos:start="63:9" pos:end="63:28">

        <expr_stmt pos:start="63:9" pos:end="63:28"><expr pos:start="63:9" pos:end="63:27"><name pos:start="63:9" pos:end="63:11">ret</name> <operator pos:start="63:13" pos:end="63:13">=</operator> <name pos:start="63:15" pos:end="63:27">USB_RET_NODEV</name></expr>;</expr_stmt></block_content></block></else></if_stmt>



    <if_stmt pos:start="67:5" pos:end="73:5"><if pos:start="67:5" pos:end="73:5">if <condition pos:start="67:8" pos:end="67:29">(<expr pos:start="67:9" pos:end="67:28"><name pos:start="67:9" pos:end="67:11">ret</name> <operator pos:start="67:13" pos:end="67:14">==</operator> <name pos:start="67:16" pos:end="67:28">USB_RET_ASYNC</name></expr>)</condition> <block pos:start="67:31" pos:end="73:5">{<block_content pos:start="69:9" pos:end="71:15">

        <expr_stmt pos:start="69:9" pos:end="69:30"><expr pos:start="69:9" pos:end="69:29"><name pos:start="69:9" pos:end="69:23"><name pos:start="69:9" pos:end="69:10">ep</name><operator pos:start="69:11" pos:end="69:12">-&gt;</operator><name pos:start="69:13" pos:end="69:18">status</name><index pos:start="69:19" pos:end="69:23">[<expr pos:start="69:20" pos:end="69:22"><name pos:start="69:20" pos:end="69:22">dir</name></expr>]</index></name> <operator pos:start="69:25" pos:end="69:25">=</operator> <name pos:start="69:27" pos:end="69:29">len</name></expr>;</expr_stmt>

        <return pos:start="71:9" pos:end="71:15">return;</return>

    </block_content>}</block></if></if_stmt>



    <expr_stmt pos:start="77:5" pos:end="77:26"><expr pos:start="77:5" pos:end="77:25"><name pos:start="77:5" pos:end="77:19"><name pos:start="77:5" pos:end="77:6">ep</name><operator pos:start="77:7" pos:end="77:8">-&gt;</operator><name pos:start="77:9" pos:end="77:14">status</name><index pos:start="77:15" pos:end="77:19">[<expr pos:start="77:16" pos:end="77:18"><name pos:start="77:16" pos:end="77:18">dir</name></expr>]</index></name> <operator pos:start="77:21" pos:end="77:21">=</operator> <name pos:start="77:23" pos:end="77:25">ret</name></expr>;</expr_stmt>

    <expr_stmt pos:start="79:5" pos:end="79:51"><expr pos:start="79:5" pos:end="79:50"><call pos:start="79:5" pos:end="79:50"><name pos:start="79:5" pos:end="79:20">musb_schedule_cb</name><argument_list pos:start="79:21" pos:end="79:50">(<argument pos:start="79:22" pos:end="79:29"><expr pos:start="79:22" pos:end="79:29"><operator pos:start="79:22" pos:end="79:22">&amp;</operator><name pos:start="79:23" pos:end="79:29"><name pos:start="79:23" pos:end="79:23">s</name><operator pos:start="79:24" pos:end="79:25">-&gt;</operator><name pos:start="79:26" pos:end="79:29">port</name></name></expr></argument>, <argument pos:start="79:32" pos:end="79:49"><expr pos:start="79:32" pos:end="79:49"><operator pos:start="79:32" pos:end="79:32">&amp;</operator><name pos:start="79:33" pos:end="79:47"><name pos:start="79:33" pos:end="79:34">ep</name><operator pos:start="79:35" pos:end="79:36">-&gt;</operator><name pos:start="79:37" pos:end="79:42">packey</name><index pos:start="79:43" pos:end="79:47">[<expr pos:start="79:44" pos:end="79:46"><name pos:start="79:44" pos:end="79:46">dir</name></expr>]</index></name><operator pos:start="79:48" pos:end="79:48">.</operator><name pos:start="79:49" pos:end="79:49">p</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>
</unit>
