<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/1/23326.c" pos:tabs="8"><function pos:start="1:1" pos:end="85:1"><type pos:start="1:1" pos:end="1:10"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:10">int</name></type> <name pos:start="1:12" pos:end="1:28">qemu_chr_open_pty</name><parameter_list pos:start="1:29" pos:end="1:68">(<parameter pos:start="1:30" pos:end="1:43"><decl pos:start="1:30" pos:end="1:43"><type pos:start="1:30" pos:end="1:43"><name pos:start="1:30" pos:end="1:37">QemuOpts</name> <modifier pos:start="1:39" pos:end="1:39">*</modifier></type><name pos:start="1:40" pos:end="1:43">opts</name></decl></parameter>, <parameter pos:start="1:46" pos:end="1:67"><decl pos:start="1:46" pos:end="1:67"><type pos:start="1:46" pos:end="1:67"><name pos:start="1:46" pos:end="1:60">CharDriverState</name> <modifier pos:start="1:62" pos:end="1:62">*</modifier><modifier pos:start="1:63" pos:end="1:63">*</modifier></type><name pos:start="1:64" pos:end="1:67">_chr</name></decl></parameter>)</parameter_list>

<block pos:start="3:1" pos:end="85:1">{<block_content pos:start="5:5" pos:end="83:13">

    <decl_stmt pos:start="5:5" pos:end="5:25"><decl pos:start="5:5" pos:end="5:24"><type pos:start="5:5" pos:end="5:21"><name pos:start="5:5" pos:end="5:19">CharDriverState</name> <modifier pos:start="5:21" pos:end="5:21">*</modifier></type><name pos:start="5:22" pos:end="5:24">chr</name></decl>;</decl_stmt>

    <decl_stmt pos:start="7:5" pos:end="7:21"><decl pos:start="7:5" pos:end="7:20"><type pos:start="7:5" pos:end="7:19"><name pos:start="7:5" pos:end="7:17">PtyCharDriver</name> <modifier pos:start="7:19" pos:end="7:19">*</modifier></type><name pos:start="7:20" pos:end="7:20">s</name></decl>;</decl_stmt>

    <decl_stmt pos:start="9:5" pos:end="9:23"><decl pos:start="9:5" pos:end="9:22"><type pos:start="9:5" pos:end="9:18"><name pos:start="9:5" pos:end="9:18"><name pos:start="9:5" pos:end="9:10">struct</name> <name pos:start="9:12" pos:end="9:18">termios</name></name></type> <name pos:start="9:20" pos:end="9:22">tty</name></decl>;</decl_stmt>

    <decl_stmt pos:start="11:5" pos:end="14:0"><decl pos:start="11:5" pos:end="11:16"><type pos:start="11:5" pos:end="11:7"><name pos:start="11:5" pos:end="11:7">int</name></type> <name pos:start="11:9" pos:end="11:16">slave_fd</name></decl>, <decl pos:start="11:19" pos:end="11:21"><type ref="prev" pos:start="11:5" pos:end="11:7"/><name pos:start="11:19" pos:end="11:21">len</name></decl>;</decl_stmt>

<cpp:if pos:start="13:1" pos:end="13:50">#<cpp:directive pos:start="13:2" pos:end="13:3">if</cpp:directive> <expr pos:start="13:5" pos:end="13:50"><call pos:start="13:5" pos:end="13:24"><name pos:start="13:5" pos:end="13:11">defined</name><argument_list pos:start="13:12" pos:end="13:24">(<argument pos:start="13:13" pos:end="13:23"><expr pos:start="13:13" pos:end="13:23"><name pos:start="13:13" pos:end="13:23">__OpenBSD__</name></expr></argument>)</argument_list></call> <operator pos:start="13:26" pos:end="13:27">||</operator> <call pos:start="13:29" pos:end="13:50"><name pos:start="13:29" pos:end="13:35">defined</name><argument_list pos:start="13:36" pos:end="13:50">(<argument pos:start="13:37" pos:end="13:49"><expr pos:start="13:37" pos:end="13:49"><name pos:start="13:37" pos:end="13:49">__DragonFly__</name></expr></argument>)</argument_list></call></expr></cpp:if>

    <decl_stmt pos:start="15:5" pos:end="20:0"><decl pos:start="15:5" pos:end="15:27"><type pos:start="15:5" pos:end="15:8"><name pos:start="15:5" pos:end="15:8">char</name></type> <name pos:start="15:10" pos:end="15:27"><name pos:start="15:10" pos:end="15:17">pty_name</name><index pos:start="15:18" pos:end="15:27">[<expr pos:start="15:19" pos:end="15:26"><name pos:start="15:19" pos:end="15:26">PATH_MAX</name></expr>]</index></name></decl>;</decl_stmt>

<cpp:define pos:start="17:1" pos:end="17:29">#<cpp:directive pos:start="17:2" pos:end="17:7">define</cpp:directive> <cpp:macro pos:start="17:9" pos:end="17:20"><name pos:start="17:9" pos:end="17:17">q_ptsname</name><parameter_list pos:start="17:18" pos:end="17:20">(<parameter pos:start="17:19" pos:end="17:19"><type pos:start="17:19" pos:end="17:19"><name pos:start="17:19" pos:end="17:19">x</name></type></parameter>)</parameter_list></cpp:macro> <cpp:value pos:start="17:22" pos:end="17:29">pty_name</cpp:value></cpp:define>

<cpp:else pos:start="19:1" pos:end="19:5">#<cpp:directive pos:start="19:2" pos:end="19:5">else</cpp:directive></cpp:else>

    <decl_stmt pos:start="21:5" pos:end="26:0"><decl pos:start="21:5" pos:end="21:25"><type pos:start="21:5" pos:end="21:10"><name pos:start="21:5" pos:end="21:8">char</name> <modifier pos:start="21:10" pos:end="21:10">*</modifier></type><name pos:start="21:11" pos:end="21:18">pty_name</name> <init pos:start="21:20" pos:end="21:25">= <expr pos:start="21:22" pos:end="21:25"><name pos:start="21:22" pos:end="21:25">NULL</name></expr></init></decl>;</decl_stmt>

<cpp:define pos:start="23:1" pos:end="23:31">#<cpp:directive pos:start="23:2" pos:end="23:7">define</cpp:directive> <cpp:macro pos:start="23:9" pos:end="23:20"><name pos:start="23:9" pos:end="23:17">q_ptsname</name><parameter_list pos:start="23:18" pos:end="23:20">(<parameter pos:start="23:19" pos:end="23:19"><type pos:start="23:19" pos:end="23:19"><name pos:start="23:19" pos:end="23:19">x</name></type></parameter>)</parameter_list></cpp:macro> <cpp:value pos:start="23:22" pos:end="23:31">ptsname(x)</cpp:value></cpp:define>

<cpp:endif pos:start="25:1" pos:end="25:6">#<cpp:directive pos:start="25:2" pos:end="25:6">endif</cpp:directive></cpp:endif>



    <expr_stmt pos:start="29:5" pos:end="29:45"><expr pos:start="29:5" pos:end="29:44"><name pos:start="29:5" pos:end="29:7">chr</name> <operator pos:start="29:9" pos:end="29:9">=</operator> <call pos:start="29:11" pos:end="29:44"><name pos:start="29:11" pos:end="29:19">g_malloc0</name><argument_list pos:start="29:20" pos:end="29:44">(<argument pos:start="29:21" pos:end="29:43"><expr pos:start="29:21" pos:end="29:43"><sizeof pos:start="29:21" pos:end="29:43">sizeof<argument_list pos:start="29:27" pos:end="29:43">(<argument pos:start="29:28" pos:end="29:42"><expr pos:start="29:28" pos:end="29:42"><name pos:start="29:28" pos:end="29:42">CharDriverState</name></expr></argument>)</argument_list></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="31:5" pos:end="31:41"><expr pos:start="31:5" pos:end="31:40"><name pos:start="31:5" pos:end="31:5">s</name> <operator pos:start="31:7" pos:end="31:7">=</operator> <call pos:start="31:9" pos:end="31:40"><name pos:start="31:9" pos:end="31:17">g_malloc0</name><argument_list pos:start="31:18" pos:end="31:40">(<argument pos:start="31:19" pos:end="31:39"><expr pos:start="31:19" pos:end="31:39"><sizeof pos:start="31:19" pos:end="31:39">sizeof<argument_list pos:start="31:25" pos:end="31:39">(<argument pos:start="31:26" pos:end="31:38"><expr pos:start="31:26" pos:end="31:38"><name pos:start="31:26" pos:end="31:38">PtyCharDriver</name></expr></argument>)</argument_list></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <if_stmt pos:start="35:5" pos:end="39:5"><if pos:start="35:5" pos:end="39:5">if <condition pos:start="35:8" pos:end="35:61">(<expr pos:start="35:9" pos:end="35:60"><call pos:start="35:9" pos:end="35:56"><name pos:start="35:9" pos:end="35:15">openpty</name><argument_list pos:start="35:16" pos:end="35:56">(<argument pos:start="35:17" pos:end="35:22"><expr pos:start="35:17" pos:end="35:22"><operator pos:start="35:17" pos:end="35:17">&amp;</operator><name pos:start="35:18" pos:end="35:22"><name pos:start="35:18" pos:end="35:18">s</name><operator pos:start="35:19" pos:end="35:20">-&gt;</operator><name pos:start="35:21" pos:end="35:22">fd</name></name></expr></argument>, <argument pos:start="35:25" pos:end="35:33"><expr pos:start="35:25" pos:end="35:33"><operator pos:start="35:25" pos:end="35:25">&amp;</operator><name pos:start="35:26" pos:end="35:33">slave_fd</name></expr></argument>, <argument pos:start="35:36" pos:end="35:43"><expr pos:start="35:36" pos:end="35:43"><name pos:start="35:36" pos:end="35:43">pty_name</name></expr></argument>, <argument pos:start="35:46" pos:end="35:49"><expr pos:start="35:46" pos:end="35:49"><name pos:start="35:46" pos:end="35:49">NULL</name></expr></argument>, <argument pos:start="35:52" pos:end="35:55"><expr pos:start="35:52" pos:end="35:55"><name pos:start="35:52" pos:end="35:55">NULL</name></expr></argument>)</argument_list></call> <operator pos:start="35:58" pos:end="35:58">&lt;</operator> <literal type="number" pos:start="35:60" pos:end="35:60">0</literal></expr>)</condition> <block pos:start="35:63" pos:end="39:5">{<block_content pos:start="37:9" pos:end="37:22">

        <return pos:start="37:9" pos:end="37:22">return <expr pos:start="37:16" pos:end="37:21"><operator pos:start="37:16" pos:end="37:16">-</operator><name pos:start="37:17" pos:end="37:21">errno</name></expr>;</return>

    </block_content>}</block></if></if_stmt>



    <comment type="block" pos:start="43:5" pos:end="43:40">/* Set raw attributes on the pty. */</comment>

    <expr_stmt pos:start="45:5" pos:end="45:30"><expr pos:start="45:5" pos:end="45:29"><call pos:start="45:5" pos:end="45:29"><name pos:start="45:5" pos:end="45:13">tcgetattr</name><argument_list pos:start="45:14" pos:end="45:29">(<argument pos:start="45:15" pos:end="45:22"><expr pos:start="45:15" pos:end="45:22"><name pos:start="45:15" pos:end="45:22">slave_fd</name></expr></argument>, <argument pos:start="45:25" pos:end="45:28"><expr pos:start="45:25" pos:end="45:28"><operator pos:start="45:25" pos:end="45:25">&amp;</operator><name pos:start="45:26" pos:end="45:28">tty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="47:5" pos:end="47:20"><expr pos:start="47:5" pos:end="47:19"><call pos:start="47:5" pos:end="47:19"><name pos:start="47:5" pos:end="47:13">cfmakeraw</name><argument_list pos:start="47:14" pos:end="47:19">(<argument pos:start="47:15" pos:end="47:18"><expr pos:start="47:15" pos:end="47:18"><operator pos:start="47:15" pos:end="47:15">&amp;</operator><name pos:start="47:16" pos:end="47:18">tty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="49:5" pos:end="49:41"><expr pos:start="49:5" pos:end="49:40"><call pos:start="49:5" pos:end="49:40"><name pos:start="49:5" pos:end="49:13">tcsetattr</name><argument_list pos:start="49:14" pos:end="49:40">(<argument pos:start="49:15" pos:end="49:22"><expr pos:start="49:15" pos:end="49:22"><name pos:start="49:15" pos:end="49:22">slave_fd</name></expr></argument>, <argument pos:start="49:25" pos:end="49:33"><expr pos:start="49:25" pos:end="49:33"><name pos:start="49:25" pos:end="49:33">TCSAFLUSH</name></expr></argument>, <argument pos:start="49:36" pos:end="49:39"><expr pos:start="49:36" pos:end="49:39"><operator pos:start="49:36" pos:end="49:36">&amp;</operator><name pos:start="49:37" pos:end="49:39">tty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="51:5" pos:end="51:20"><expr pos:start="51:5" pos:end="51:19"><call pos:start="51:5" pos:end="51:19"><name pos:start="51:5" pos:end="51:9">close</name><argument_list pos:start="51:10" pos:end="51:19">(<argument pos:start="51:11" pos:end="51:18"><expr pos:start="51:11" pos:end="51:18"><name pos:start="51:11" pos:end="51:18">slave_fd</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <expr_stmt pos:start="55:5" pos:end="55:39"><expr pos:start="55:5" pos:end="55:38"><name pos:start="55:5" pos:end="55:7">len</name> <operator pos:start="55:9" pos:end="55:9">=</operator> <call pos:start="55:11" pos:end="55:34"><name pos:start="55:11" pos:end="55:16">strlen</name><argument_list pos:start="55:17" pos:end="55:34">(<argument pos:start="55:18" pos:end="55:33"><expr pos:start="55:18" pos:end="55:33"><call pos:start="55:18" pos:end="55:33"><name pos:start="55:18" pos:end="55:26">q_ptsname</name><argument_list pos:start="55:27" pos:end="55:33">(<argument pos:start="55:28" pos:end="55:32"><expr pos:start="55:28" pos:end="55:32"><name pos:start="55:28" pos:end="55:32"><name pos:start="55:28" pos:end="55:28">s</name><operator pos:start="55:29" pos:end="55:30">-&gt;</operator><name pos:start="55:31" pos:end="55:32">fd</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call> <operator pos:start="55:36" pos:end="55:36">+</operator> <literal type="number" pos:start="55:38" pos:end="55:38">5</literal></expr>;</expr_stmt>

    <expr_stmt pos:start="57:5" pos:end="57:34"><expr pos:start="57:5" pos:end="57:33"><name pos:start="57:5" pos:end="57:17"><name pos:start="57:5" pos:end="57:7">chr</name><operator pos:start="57:8" pos:end="57:9">-&gt;</operator><name pos:start="57:10" pos:end="57:17">filename</name></name> <operator pos:start="57:19" pos:end="57:19">=</operator> <call pos:start="57:21" pos:end="57:33"><name pos:start="57:21" pos:end="57:28">g_malloc</name><argument_list pos:start="57:29" pos:end="57:33">(<argument pos:start="57:30" pos:end="57:32"><expr pos:start="57:30" pos:end="57:32"><name pos:start="57:30" pos:end="57:32">len</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="59:5" pos:end="59:61"><expr pos:start="59:5" pos:end="59:60"><call pos:start="59:5" pos:end="59:60"><name pos:start="59:5" pos:end="59:12">snprintf</name><argument_list pos:start="59:13" pos:end="59:60">(<argument pos:start="59:14" pos:end="59:26"><expr pos:start="59:14" pos:end="59:26"><name pos:start="59:14" pos:end="59:26"><name pos:start="59:14" pos:end="59:16">chr</name><operator pos:start="59:17" pos:end="59:18">-&gt;</operator><name pos:start="59:19" pos:end="59:26">filename</name></name></expr></argument>, <argument pos:start="59:29" pos:end="59:31"><expr pos:start="59:29" pos:end="59:31"><name pos:start="59:29" pos:end="59:31">len</name></expr></argument>, <argument pos:start="59:34" pos:end="59:41"><expr pos:start="59:34" pos:end="59:41"><literal type="string" pos:start="59:34" pos:end="59:41">"pty:%s"</literal></expr></argument>, <argument pos:start="59:44" pos:end="59:59"><expr pos:start="59:44" pos:end="59:59"><call pos:start="59:44" pos:end="59:59"><name pos:start="59:44" pos:end="59:52">q_ptsname</name><argument_list pos:start="59:53" pos:end="59:59">(<argument pos:start="59:54" pos:end="59:58"><expr pos:start="59:54" pos:end="59:58"><name pos:start="59:54" pos:end="59:58"><name pos:start="59:54" pos:end="59:54">s</name><operator pos:start="59:55" pos:end="59:56">-&gt;</operator><name pos:start="59:57" pos:end="59:58">fd</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="61:5" pos:end="61:49"><expr pos:start="61:5" pos:end="61:48"><call pos:start="61:5" pos:end="61:48"><name pos:start="61:5" pos:end="61:16">qemu_opt_set</name><argument_list pos:start="61:17" pos:end="61:48">(<argument pos:start="61:18" pos:end="61:21"><expr pos:start="61:18" pos:end="61:21"><name pos:start="61:18" pos:end="61:21">opts</name></expr></argument>, <argument pos:start="61:24" pos:end="61:29"><expr pos:start="61:24" pos:end="61:29"><literal type="string" pos:start="61:24" pos:end="61:29">"path"</literal></expr></argument>, <argument pos:start="61:32" pos:end="61:47"><expr pos:start="61:32" pos:end="61:47"><call pos:start="61:32" pos:end="61:47"><name pos:start="61:32" pos:end="61:40">q_ptsname</name><argument_list pos:start="61:41" pos:end="61:47">(<argument pos:start="61:42" pos:end="61:46"><expr pos:start="61:42" pos:end="61:46"><name pos:start="61:42" pos:end="61:46"><name pos:start="61:42" pos:end="61:42">s</name><operator pos:start="61:43" pos:end="61:44">-&gt;</operator><name pos:start="61:45" pos:end="61:46">fd</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="63:5" pos:end="63:72"><expr pos:start="63:5" pos:end="63:71"><call pos:start="63:5" pos:end="63:71"><name pos:start="63:5" pos:end="63:11">fprintf</name><argument_list pos:start="63:12" pos:end="63:71">(<argument pos:start="63:13" pos:end="63:18"><expr pos:start="63:13" pos:end="63:18"><name pos:start="63:13" pos:end="63:18">stderr</name></expr></argument>, <argument pos:start="63:21" pos:end="63:52"><expr pos:start="63:21" pos:end="63:52"><literal type="string" pos:start="63:21" pos:end="63:52">"char device redirected to %s\n"</literal></expr></argument>, <argument pos:start="63:55" pos:end="63:70"><expr pos:start="63:55" pos:end="63:70"><call pos:start="63:55" pos:end="63:70"><name pos:start="63:55" pos:end="63:63">q_ptsname</name><argument_list pos:start="63:64" pos:end="63:70">(<argument pos:start="63:65" pos:end="63:69"><expr pos:start="63:65" pos:end="63:69"><name pos:start="63:65" pos:end="63:69"><name pos:start="63:65" pos:end="63:65">s</name><operator pos:start="63:66" pos:end="63:67">-&gt;</operator><name pos:start="63:68" pos:end="63:69">fd</name></name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <expr_stmt pos:start="67:5" pos:end="67:20"><expr pos:start="67:5" pos:end="67:19"><name pos:start="67:5" pos:end="67:15"><name pos:start="67:5" pos:end="67:7">chr</name><operator pos:start="67:8" pos:end="67:9">-&gt;</operator><name pos:start="67:10" pos:end="67:15">opaque</name></name> <operator pos:start="67:17" pos:end="67:17">=</operator> <name pos:start="67:19" pos:end="67:19">s</name></expr>;</expr_stmt>

    <expr_stmt pos:start="69:5" pos:end="69:35"><expr pos:start="69:5" pos:end="69:34"><name pos:start="69:5" pos:end="69:18"><name pos:start="69:5" pos:end="69:7">chr</name><operator pos:start="69:8" pos:end="69:9">-&gt;</operator><name pos:start="69:10" pos:end="69:18">chr_write</name></name> <operator pos:start="69:20" pos:end="69:20">=</operator> <name pos:start="69:22" pos:end="69:34">pty_chr_write</name></expr>;</expr_stmt>

    <expr_stmt pos:start="71:5" pos:end="71:63"><expr pos:start="71:5" pos:end="71:62"><name pos:start="71:5" pos:end="71:32"><name pos:start="71:5" pos:end="71:7">chr</name><operator pos:start="71:8" pos:end="71:9">-&gt;</operator><name pos:start="71:10" pos:end="71:32">chr_update_read_handler</name></name> <operator pos:start="71:34" pos:end="71:34">=</operator> <name pos:start="71:36" pos:end="71:62">pty_chr_update_read_handler</name></expr>;</expr_stmt>

    <expr_stmt pos:start="73:5" pos:end="73:35"><expr pos:start="73:5" pos:end="73:34"><name pos:start="73:5" pos:end="73:18"><name pos:start="73:5" pos:end="73:7">chr</name><operator pos:start="73:8" pos:end="73:9">-&gt;</operator><name pos:start="73:10" pos:end="73:18">chr_close</name></name> <operator pos:start="73:20" pos:end="73:20">=</operator> <name pos:start="73:22" pos:end="73:34">pty_chr_close</name></expr>;</expr_stmt>



    <expr_stmt pos:start="77:5" pos:end="77:63"><expr pos:start="77:5" pos:end="77:62"><name pos:start="77:5" pos:end="77:12"><name pos:start="77:5" pos:end="77:5">s</name><operator pos:start="77:6" pos:end="77:7">-&gt;</operator><name pos:start="77:8" pos:end="77:12">timer</name></name> <operator pos:start="77:14" pos:end="77:14">=</operator> <call pos:start="77:16" pos:end="77:62"><name pos:start="77:16" pos:end="77:32">qemu_new_timer_ms</name><argument_list pos:start="77:33" pos:end="77:62">(<argument pos:start="77:34" pos:end="77:41"><expr pos:start="77:34" pos:end="77:41"><name pos:start="77:34" pos:end="77:41">rt_clock</name></expr></argument>, <argument pos:start="77:44" pos:end="77:56"><expr pos:start="77:44" pos:end="77:56"><name pos:start="77:44" pos:end="77:56">pty_chr_timer</name></expr></argument>, <argument pos:start="77:59" pos:end="77:61"><expr pos:start="77:59" pos:end="77:61"><name pos:start="77:59" pos:end="77:61">chr</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <expr_stmt pos:start="81:5" pos:end="81:16"><expr pos:start="81:5" pos:end="81:15"><operator pos:start="81:5" pos:end="81:5">*</operator><name pos:start="81:6" pos:end="81:9">_chr</name> <operator pos:start="81:11" pos:end="81:11">=</operator> <name pos:start="81:13" pos:end="81:15">chr</name></expr>;</expr_stmt>

    <return pos:start="83:5" pos:end="83:13">return <expr pos:start="83:12" pos:end="83:12"><literal type="number" pos:start="83:12" pos:end="83:12">0</literal></expr>;</return>

</block_content>}</block></function>
</unit>
