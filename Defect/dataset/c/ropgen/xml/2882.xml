<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/0/2882.c" pos:tabs="8"><function pos:start="1:1" pos:end="593:1"><type pos:start="1:1" pos:end="1:11"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:11">void</name></type> <name pos:start="1:13" pos:end="1:37">tpm_tis_mmio_write_intern</name><parameter_list pos:start="1:38" pos:end="5:53">(<parameter pos:start="1:39" pos:end="1:50"><decl pos:start="1:39" pos:end="1:50"><type pos:start="1:39" pos:end="1:50"><name pos:start="1:39" pos:end="1:42">void</name> <modifier pos:start="1:44" pos:end="1:44">*</modifier></type><name pos:start="1:45" pos:end="1:50">opaque</name></decl></parameter>, <parameter pos:start="1:53" pos:end="1:63"><decl pos:start="1:53" pos:end="1:63"><type pos:start="1:53" pos:end="1:63"><name pos:start="1:53" pos:end="1:58">hwaddr</name></type> <name pos:start="1:60" pos:end="1:63">addr</name></decl></parameter>,

                                      <parameter pos:start="3:39" pos:end="3:50"><decl pos:start="3:39" pos:end="3:50"><type pos:start="3:39" pos:end="3:50"><name pos:start="3:39" pos:end="3:46">uint64_t</name></type> <name pos:start="3:48" pos:end="3:50">val</name></decl></parameter>, <parameter pos:start="3:53" pos:end="3:65"><decl pos:start="3:53" pos:end="3:65"><type pos:start="3:53" pos:end="3:65"><name pos:start="3:53" pos:end="3:60">unsigned</name></type> <name pos:start="3:62" pos:end="3:65">size</name></decl></parameter>,

                                      <parameter pos:start="5:39" pos:end="5:52"><decl pos:start="5:39" pos:end="5:52"><type pos:start="5:39" pos:end="5:52"><name pos:start="5:39" pos:end="5:42">bool</name></type> <name pos:start="5:44" pos:end="5:52">hw_access</name></decl></parameter>)</parameter_list>

<block pos:start="7:1" pos:end="593:1">{<block_content pos:start="9:5" pos:end="591:5">

    <decl_stmt pos:start="9:5" pos:end="9:25"><decl pos:start="9:5" pos:end="9:24"><type pos:start="9:5" pos:end="9:14"><name pos:start="9:5" pos:end="9:12">TPMState</name> <modifier pos:start="9:14" pos:end="9:14">*</modifier></type><name pos:start="9:15" pos:end="9:15">s</name> <init pos:start="9:17" pos:end="9:24">= <expr pos:start="9:19" pos:end="9:24"><name pos:start="9:19" pos:end="9:24">opaque</name></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="11:5" pos:end="11:36"><decl pos:start="11:5" pos:end="11:35"><type pos:start="11:5" pos:end="11:20"><name pos:start="11:5" pos:end="11:18">TPMTISEmuState</name> <modifier pos:start="11:20" pos:end="11:20">*</modifier></type><name pos:start="11:21" pos:end="11:23">tis</name> <init pos:start="11:25" pos:end="11:35">= <expr pos:start="11:27" pos:end="11:35"><operator pos:start="11:27" pos:end="11:27">&amp;</operator><name pos:start="11:28" pos:end="11:35"><name pos:start="11:28" pos:end="11:28">s</name><operator pos:start="11:29" pos:end="11:30">-&gt;</operator><name pos:start="11:31" pos:end="11:31">s</name><operator pos:start="11:32" pos:end="11:32">.</operator><name pos:start="11:33" pos:end="11:35">tis</name></name></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="13:5" pos:end="13:32"><decl pos:start="13:5" pos:end="13:31"><type pos:start="13:5" pos:end="13:12"><name pos:start="13:5" pos:end="13:12">uint16_t</name></type> <name pos:start="13:14" pos:end="13:16">off</name> <init pos:start="13:18" pos:end="13:31">= <expr pos:start="13:20" pos:end="13:31"><name pos:start="13:20" pos:end="13:23">addr</name> <operator pos:start="13:25" pos:end="13:25">&amp;</operator> <literal type="number" pos:start="13:27" pos:end="13:31">0xffc</literal></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="15:5" pos:end="15:37"><decl pos:start="15:5" pos:end="15:36"><type pos:start="15:5" pos:end="15:11"><name pos:start="15:5" pos:end="15:11">uint8_t</name></type> <name pos:start="15:13" pos:end="15:17">shift</name> <init pos:start="15:19" pos:end="15:36">= <expr pos:start="15:21" pos:end="15:36"><operator pos:start="15:21" pos:end="15:21">(</operator><name pos:start="15:22" pos:end="15:25">addr</name> <operator pos:start="15:27" pos:end="15:27">&amp;</operator> <literal type="number" pos:start="15:29" pos:end="15:31">0x3</literal><operator pos:start="15:32" pos:end="15:32">)</operator> <operator pos:start="15:34" pos:end="15:34">*</operator> <literal type="number" pos:start="15:36" pos:end="15:36">8</literal></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="17:5" pos:end="17:53"><decl pos:start="17:5" pos:end="17:52"><type pos:start="17:5" pos:end="17:11"><name pos:start="17:5" pos:end="17:11">uint8_t</name></type> <name pos:start="17:13" pos:end="17:17">locty</name> <init pos:start="17:19" pos:end="17:52">= <expr pos:start="17:21" pos:end="17:52"><call pos:start="17:21" pos:end="17:52"><name pos:start="17:21" pos:end="17:46">tpm_tis_locality_from_addr</name><argument_list pos:start="17:47" pos:end="17:52">(<argument pos:start="17:48" pos:end="17:51"><expr pos:start="17:48" pos:end="17:51"><name pos:start="17:48" pos:end="17:51">addr</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="19:5" pos:end="19:28"><decl pos:start="19:5" pos:end="19:24"><type pos:start="19:5" pos:end="19:11"><name pos:start="19:5" pos:end="19:11">uint8_t</name></type> <name pos:start="19:13" pos:end="19:24">active_locty</name></decl>, <decl pos:start="19:27" pos:end="19:27"><type ref="prev" pos:start="19:5" pos:end="19:11"/><name pos:start="19:27" pos:end="19:27">l</name></decl>;</decl_stmt>

    <decl_stmt pos:start="21:5" pos:end="21:29"><decl pos:start="21:5" pos:end="21:9"><type pos:start="21:5" pos:end="21:7"><name pos:start="21:5" pos:end="21:7">int</name></type> <name pos:start="21:9" pos:end="21:9">c</name></decl>, <decl pos:start="21:12" pos:end="21:28"><type ref="prev" pos:start="21:5" pos:end="21:7"/><name pos:start="21:12" pos:end="21:24">set_new_locty</name> <init pos:start="21:26" pos:end="21:28">= <expr pos:start="21:28" pos:end="21:28"><literal type="number" pos:start="21:28" pos:end="21:28">1</literal></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="23:5" pos:end="23:17"><decl pos:start="23:5" pos:end="23:16"><type pos:start="23:5" pos:end="23:12"><name pos:start="23:5" pos:end="23:12">uint16_t</name></type> <name pos:start="23:14" pos:end="23:16">len</name></decl>;</decl_stmt>

    <decl_stmt pos:start="25:5" pos:end="25:69"><decl pos:start="25:5" pos:end="25:68"><type pos:start="25:5" pos:end="25:12"><name pos:start="25:5" pos:end="25:12">uint32_t</name></type> <name pos:start="25:14" pos:end="25:17">mask</name> <init pos:start="25:19" pos:end="25:68">= <expr pos:start="25:21" pos:end="25:68"><ternary pos:start="25:21" pos:end="25:68"><condition pos:start="25:21" pos:end="25:33"><expr pos:start="25:21" pos:end="25:31"><operator pos:start="25:21" pos:end="25:21">(</operator><name pos:start="25:22" pos:end="25:25">size</name> <operator pos:start="25:27" pos:end="25:28">==</operator> <literal type="number" pos:start="25:30" pos:end="25:30">1</literal><operator pos:start="25:31" pos:end="25:31">)</operator></expr> ?</condition><then pos:start="25:35" pos:end="25:38"> <expr pos:start="25:35" pos:end="25:38"><literal type="number" pos:start="25:35" pos:end="25:38">0xff</literal></expr> </then><else pos:start="25:40" pos:end="25:68">: <expr pos:start="25:42" pos:end="25:68"><operator pos:start="25:42" pos:end="25:42">(</operator><ternary pos:start="25:43" pos:end="25:67"><condition pos:start="25:43" pos:end="25:55"><expr pos:start="25:43" pos:end="25:53"><operator pos:start="25:43" pos:end="25:43">(</operator><name pos:start="25:44" pos:end="25:47">size</name> <operator pos:start="25:49" pos:end="25:50">==</operator> <literal type="number" pos:start="25:52" pos:end="25:52">2</literal><operator pos:start="25:53" pos:end="25:53">)</operator></expr> ?</condition><then pos:start="25:57" pos:end="25:62"> <expr pos:start="25:57" pos:end="25:62"><literal type="number" pos:start="25:57" pos:end="25:62">0xffff</literal></expr> </then><else pos:start="25:64" pos:end="25:67">: <expr pos:start="25:66" pos:end="25:67"><operator pos:start="25:66" pos:end="25:66">~</operator><literal type="number" pos:start="25:67" pos:end="25:67">0</literal></expr></else></ternary><operator pos:start="25:68" pos:end="25:68">)</operator></expr></else></ternary></expr></init></decl>;</decl_stmt>



    <expr_stmt pos:start="29:5" pos:end="29:80"><expr pos:start="29:5" pos:end="29:79"><call pos:start="29:5" pos:end="29:79"><name pos:start="29:5" pos:end="29:11">DPRINTF</name><argument_list pos:start="29:12" pos:end="29:79">(<argument pos:start="29:13" pos:end="29:46"><expr pos:start="29:13" pos:end="29:46"><literal type="string" pos:start="29:13" pos:end="29:46">"tpm_tis: write.%u(%08x) = %08x\n"</literal></expr></argument>, <argument pos:start="29:49" pos:end="29:52"><expr pos:start="29:49" pos:end="29:52"><name pos:start="29:49" pos:end="29:52">size</name></expr></argument>, <argument pos:start="29:55" pos:end="29:63"><expr pos:start="29:55" pos:end="29:63"><operator pos:start="29:55" pos:end="29:55">(</operator><name pos:start="29:56" pos:end="29:58">int</name><operator pos:start="29:59" pos:end="29:59">)</operator><name pos:start="29:60" pos:end="29:63">addr</name></expr></argument>, <argument pos:start="29:66" pos:end="29:78"><expr pos:start="29:66" pos:end="29:78"><operator pos:start="29:66" pos:end="29:66">(</operator><name pos:start="29:67" pos:end="29:74">uint32_t</name><operator pos:start="29:75" pos:end="29:75">)</operator><name pos:start="29:76" pos:end="29:78">val</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <if_stmt pos:start="33:5" pos:end="39:5"><if pos:start="33:5" pos:end="39:5">if <condition pos:start="33:8" pos:end="33:33">(<expr pos:start="33:9" pos:end="33:32"><name pos:start="33:9" pos:end="33:13">locty</name> <operator pos:start="33:15" pos:end="33:16">==</operator> <literal type="number" pos:start="33:18" pos:end="33:18">4</literal> <operator pos:start="33:20" pos:end="33:21">&amp;&amp;</operator> <operator pos:start="33:23" pos:end="33:23">!</operator><name pos:start="33:24" pos:end="33:32">hw_access</name></expr>)</condition> <block pos:start="33:35" pos:end="39:5">{<block_content pos:start="35:9" pos:end="37:15">

        <expr_stmt pos:start="35:9" pos:end="35:78"><expr pos:start="35:9" pos:end="35:77"><call pos:start="35:9" pos:end="35:77"><name pos:start="35:9" pos:end="35:15">DPRINTF</name><argument_list pos:start="35:16" pos:end="35:77">(<argument pos:start="35:17" pos:end="35:76"><expr pos:start="35:17" pos:end="35:76"><literal type="string" pos:start="35:17" pos:end="35:76">"tpm_tis: Access to locality 4 only allowed from hardware\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <return pos:start="37:9" pos:end="37:15">return;</return>

    </block_content>}</block></if></if_stmt>



    <if_stmt pos:start="43:5" pos:end="47:5"><if pos:start="43:5" pos:end="47:5">if <condition pos:start="43:8" pos:end="43:52">(<expr pos:start="43:9" pos:end="43:51"><call pos:start="43:9" pos:end="43:51"><name pos:start="43:9" pos:end="43:37">tpm_backend_had_startup_error</name><argument_list pos:start="43:38" pos:end="43:51">(<argument pos:start="43:39" pos:end="43:50"><expr pos:start="43:39" pos:end="43:50"><name pos:start="43:39" pos:end="43:50"><name pos:start="43:39" pos:end="43:39">s</name><operator pos:start="43:40" pos:end="43:41">-&gt;</operator><name pos:start="43:42" pos:end="43:50">be_driver</name></name></expr></argument>)</argument_list></call></expr>)</condition> <block pos:start="43:54" pos:end="47:5">{<block_content pos:start="45:9" pos:end="45:15">

        <return pos:start="45:9" pos:end="45:15">return;</return>

    </block_content>}</block></if></if_stmt>



    <expr_stmt pos:start="51:5" pos:end="51:16"><expr pos:start="51:5" pos:end="51:15"><name pos:start="51:5" pos:end="51:7">val</name> <operator pos:start="51:9" pos:end="51:10">&amp;=</operator> <name pos:start="51:12" pos:end="51:15">mask</name></expr>;</expr_stmt>



    <if_stmt pos:start="55:5" pos:end="61:5"><if pos:start="55:5" pos:end="61:5">if <condition pos:start="55:8" pos:end="55:14">(<expr pos:start="55:9" pos:end="55:13"><name pos:start="55:9" pos:end="55:13">shift</name></expr>)</condition> <block pos:start="55:16" pos:end="61:5">{<block_content pos:start="57:9" pos:end="59:23">

        <expr_stmt pos:start="57:9" pos:end="57:22"><expr pos:start="57:9" pos:end="57:21"><name pos:start="57:9" pos:end="57:11">val</name> <operator pos:start="57:13" pos:end="57:15">&lt;&lt;=</operator> <name pos:start="57:17" pos:end="57:21">shift</name></expr>;</expr_stmt>

        <expr_stmt pos:start="59:9" pos:end="59:23"><expr pos:start="59:9" pos:end="59:22"><name pos:start="59:9" pos:end="59:12">mask</name> <operator pos:start="59:14" pos:end="59:16">&lt;&lt;=</operator> <name pos:start="59:18" pos:end="59:22">shift</name></expr>;</expr_stmt>

    </block_content>}</block></if></if_stmt>



    <expr_stmt pos:start="65:5" pos:end="65:23"><expr pos:start="65:5" pos:end="65:22"><name pos:start="65:5" pos:end="65:8">mask</name> <operator pos:start="65:10" pos:end="65:11">^=</operator> <literal type="number" pos:start="65:13" pos:end="65:22">0xffffffff</literal></expr>;</expr_stmt>



    <switch pos:start="69:5" pos:end="591:5">switch <condition pos:start="69:12" pos:end="69:16">(<expr pos:start="69:13" pos:end="69:15"><name pos:start="69:13" pos:end="69:15">off</name></expr>)</condition> <block pos:start="69:18" pos:end="591:5">{<block_content pos:start="71:5" pos:end="589:14">

    <case pos:start="71:5" pos:end="71:28">case <expr pos:start="71:10" pos:end="71:27"><name pos:start="71:10" pos:end="71:27">TPM_TIS_REG_ACCESS</name></expr>:</case>



        <if_stmt pos:start="75:9" pos:end="81:9"><if pos:start="75:9" pos:end="81:9">if <condition pos:start="75:12" pos:end="75:41">(<expr pos:start="75:13" pos:end="75:40"><operator pos:start="75:13" pos:end="75:13">(</operator><name pos:start="75:14" pos:end="75:16">val</name> <operator pos:start="75:18" pos:end="75:18">&amp;</operator> <name pos:start="75:20" pos:end="75:39">TPM_TIS_ACCESS_SEIZE</name><operator pos:start="75:40" pos:end="75:40">)</operator></expr>)</condition> <block pos:start="75:43" pos:end="81:9">{<block_content pos:start="77:13" pos:end="79:53">

            <expr_stmt pos:start="77:13" pos:end="79:53"><expr pos:start="77:13" pos:end="79:52"><name pos:start="77:13" pos:end="77:15">val</name> <operator pos:start="77:17" pos:end="77:18">&amp;=</operator> <operator pos:start="77:20" pos:end="77:20">~</operator><operator pos:start="77:21" pos:end="77:21">(</operator><name pos:start="77:22" pos:end="77:47">TPM_TIS_ACCESS_REQUEST_USE</name> <operator pos:start="77:49" pos:end="77:49">|</operator>

                     <name pos:start="79:22" pos:end="79:51">TPM_TIS_ACCESS_ACTIVE_LOCALITY</name><operator pos:start="79:52" pos:end="79:52">)</operator></expr>;</expr_stmt>

        </block_content>}</block></if></if_stmt>



        <expr_stmt pos:start="85:9" pos:end="85:41"><expr pos:start="85:9" pos:end="85:40"><name pos:start="85:9" pos:end="85:20">active_locty</name> <operator pos:start="85:22" pos:end="85:22">=</operator> <name pos:start="85:24" pos:end="85:40"><name pos:start="85:24" pos:end="85:26">tis</name><operator pos:start="85:27" pos:end="85:28">-&gt;</operator><name pos:start="85:29" pos:end="85:40">active_locty</name></name></expr>;</expr_stmt>



        <if_stmt pos:start="89:9" pos:end="145:9"><if pos:start="89:9" pos:end="145:9">if <condition pos:start="89:12" pos:end="89:51">(<expr pos:start="89:13" pos:end="89:50"><operator pos:start="89:13" pos:end="89:13">(</operator><name pos:start="89:14" pos:end="89:16">val</name> <operator pos:start="89:18" pos:end="89:18">&amp;</operator> <name pos:start="89:20" pos:end="89:49">TPM_TIS_ACCESS_ACTIVE_LOCALITY</name><operator pos:start="89:50" pos:end="89:50">)</operator></expr>)</condition> <block pos:start="89:53" pos:end="145:9">{<block_content pos:start="93:13" pos:end="143:13">

            <comment type="block" pos:start="91:13" pos:end="91:53">/* give up locality if currently owned */</comment>

            <if_stmt pos:start="93:13" pos:end="143:13"><if pos:start="93:13" pos:end="137:13">if <condition pos:start="93:16" pos:end="93:43">(<expr pos:start="93:17" pos:end="93:42"><name pos:start="93:17" pos:end="93:33"><name pos:start="93:17" pos:end="93:19">tis</name><operator pos:start="93:20" pos:end="93:21">-&gt;</operator><name pos:start="93:22" pos:end="93:33">active_locty</name></name> <operator pos:start="93:35" pos:end="93:36">==</operator> <name pos:start="93:38" pos:end="93:42">locty</name></expr>)</condition> <block pos:start="93:45" pos:end="137:13">{<block_content pos:start="95:17" pos:end="135:17">

                <expr_stmt pos:start="95:17" pos:end="95:67"><expr pos:start="95:17" pos:end="95:66"><call pos:start="95:17" pos:end="95:66"><name pos:start="95:17" pos:end="95:23">DPRINTF</name><argument_list pos:start="95:24" pos:end="95:66">(<argument pos:start="95:25" pos:end="95:58"><expr pos:start="95:25" pos:end="95:58"><literal type="string" pos:start="95:25" pos:end="95:58">"tpm_tis: Releasing locality %d\n"</literal></expr></argument>, <argument pos:start="95:61" pos:end="95:65"><expr pos:start="95:61" pos:end="95:65"><name pos:start="95:61" pos:end="95:65">locty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



                <decl_stmt pos:start="99:17" pos:end="99:55"><decl pos:start="99:17" pos:end="99:54"><type pos:start="99:17" pos:end="99:23"><name pos:start="99:17" pos:end="99:23">uint8_t</name></type> <name pos:start="99:25" pos:end="99:32">newlocty</name> <init pos:start="99:34" pos:end="99:54">= <expr pos:start="99:36" pos:end="99:54"><name pos:start="99:36" pos:end="99:54">TPM_TIS_NO_LOCALITY</name></expr></init></decl>;</decl_stmt>

                <comment type="block" pos:start="101:17" pos:end="101:50">/* anybody wants the locality ? */</comment>

                <for pos:start="103:17" pos:end="115:17">for <control pos:start="103:21" pos:end="103:65">(<init pos:start="103:22" pos:end="103:52"><expr pos:start="103:22" pos:end="103:51"><name pos:start="103:22" pos:end="103:22">c</name> <operator pos:start="103:24" pos:end="103:24">=</operator> <name pos:start="103:26" pos:end="103:47">TPM_TIS_NUM_LOCALITIES</name> <operator pos:start="103:49" pos:end="103:49">-</operator> <literal type="number" pos:start="103:51" pos:end="103:51">1</literal></expr>;</init> <condition pos:start="103:54" pos:end="103:60"><expr pos:start="103:54" pos:end="103:59"><name pos:start="103:54" pos:end="103:54">c</name> <operator pos:start="103:56" pos:end="103:57">&gt;=</operator> <literal type="number" pos:start="103:59" pos:end="103:59">0</literal></expr>;</condition> <incr pos:start="103:62" pos:end="103:64"><expr pos:start="103:62" pos:end="103:64"><name pos:start="103:62" pos:end="103:62">c</name><operator pos:start="103:63" pos:end="103:64">--</operator></expr></incr>)</control> <block pos:start="103:67" pos:end="115:17">{<block_content pos:start="105:21" pos:end="113:21">

                    <if_stmt pos:start="105:21" pos:end="113:21"><if pos:start="105:21" pos:end="113:21">if <condition pos:start="105:24" pos:end="105:74">(<expr pos:start="105:25" pos:end="105:73"><operator pos:start="105:25" pos:end="105:25">(</operator><name pos:start="105:26" pos:end="105:36"><name pos:start="105:26" pos:end="105:28">tis</name><operator pos:start="105:29" pos:end="105:30">-&gt;</operator><name pos:start="105:31" pos:end="105:33">loc</name><index pos:start="105:34" pos:end="105:36">[<expr pos:start="105:35" pos:end="105:35"><name pos:start="105:35" pos:end="105:35">c</name></expr>]</index></name><operator pos:start="105:37" pos:end="105:37">.</operator><name pos:start="105:38" pos:end="105:43">access</name> <operator pos:start="105:45" pos:end="105:45">&amp;</operator> <name pos:start="105:47" pos:end="105:72">TPM_TIS_ACCESS_REQUEST_USE</name><operator pos:start="105:73" pos:end="105:73">)</operator></expr>)</condition> <block pos:start="105:76" pos:end="113:21">{<block_content pos:start="107:25" pos:end="111:30">

                        <expr_stmt pos:start="107:25" pos:end="107:75"><expr pos:start="107:25" pos:end="107:74"><call pos:start="107:25" pos:end="107:74"><name pos:start="107:25" pos:end="107:31">DPRINTF</name><argument_list pos:start="107:32" pos:end="107:74">(<argument pos:start="107:33" pos:end="107:70"><expr pos:start="107:33" pos:end="107:70"><literal type="string" pos:start="107:33" pos:end="107:70">"tpm_tis: Locality %d requests use.\n"</literal></expr></argument>, <argument pos:start="107:73" pos:end="107:73"><expr pos:start="107:73" pos:end="107:73"><name pos:start="107:73" pos:end="107:73">c</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                        <expr_stmt pos:start="109:25" pos:end="109:37"><expr pos:start="109:25" pos:end="109:36"><name pos:start="109:25" pos:end="109:32">newlocty</name> <operator pos:start="109:34" pos:end="109:34">=</operator> <name pos:start="109:36" pos:end="109:36">c</name></expr>;</expr_stmt>

                        <break pos:start="111:25" pos:end="111:30">break;</break>

                    </block_content>}</block></if></if_stmt>

                </block_content>}</block></for>

                <expr_stmt pos:start="117:17" pos:end="121:34"><expr pos:start="117:17" pos:end="121:33"><call pos:start="117:17" pos:end="121:33"><name pos:start="117:17" pos:end="117:23">DPRINTF</name><argument_list pos:start="117:24" pos:end="121:33">(<argument pos:start="117:25" pos:end="119:52"><expr pos:start="117:25" pos:end="119:52"><literal type="string" pos:start="117:25" pos:end="117:67">"tpm_tis: TPM_TIS_ACCESS_ACTIVE_LOCALITY: "</literal>

                        <literal type="string" pos:start="119:25" pos:end="119:52">"Next active locality: %d\n"</literal></expr></argument>,

                        <argument pos:start="121:25" pos:end="121:32"><expr pos:start="121:25" pos:end="121:32"><name pos:start="121:25" pos:end="121:32">newlocty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



                <if_stmt pos:start="125:17" pos:end="135:17"><if pos:start="125:17" pos:end="131:17">if <condition pos:start="125:20" pos:end="125:53">(<expr pos:start="125:21" pos:end="125:52"><call pos:start="125:21" pos:end="125:52"><name pos:start="125:21" pos:end="125:42">TPM_TIS_IS_VALID_LOCTY</name><argument_list pos:start="125:43" pos:end="125:52">(<argument pos:start="125:44" pos:end="125:51"><expr pos:start="125:44" pos:end="125:51"><name pos:start="125:44" pos:end="125:51">newlocty</name></expr></argument>)</argument_list></call></expr>)</condition> <block pos:start="125:55" pos:end="131:17">{<block_content pos:start="127:21" pos:end="129:59">

                    <expr_stmt pos:start="127:21" pos:end="127:38"><expr pos:start="127:21" pos:end="127:37"><name pos:start="127:21" pos:end="127:33">set_new_locty</name> <operator pos:start="127:35" pos:end="127:35">=</operator> <literal type="number" pos:start="127:37" pos:end="127:37">0</literal></expr>;</expr_stmt>

                    <expr_stmt pos:start="129:21" pos:end="129:59"><expr pos:start="129:21" pos:end="129:58"><call pos:start="129:21" pos:end="129:58"><name pos:start="129:21" pos:end="129:38">tpm_tis_prep_abort</name><argument_list pos:start="129:39" pos:end="129:58">(<argument pos:start="129:40" pos:end="129:40"><expr pos:start="129:40" pos:end="129:40"><name pos:start="129:40" pos:end="129:40">s</name></expr></argument>, <argument pos:start="129:43" pos:end="129:47"><expr pos:start="129:43" pos:end="129:47"><name pos:start="129:43" pos:end="129:47">locty</name></expr></argument>, <argument pos:start="129:50" pos:end="129:57"><expr pos:start="129:50" pos:end="129:57"><name pos:start="129:50" pos:end="129:57">newlocty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                </block_content>}</block></if> <else pos:start="131:19" pos:end="135:17">else <block pos:start="131:24" pos:end="135:17">{<block_content pos:start="133:21" pos:end="133:55">

                    <expr_stmt pos:start="133:21" pos:end="133:55"><expr pos:start="133:21" pos:end="133:54"><name pos:start="133:21" pos:end="133:32">active_locty</name> <operator pos:start="133:34" pos:end="133:34">=</operator> <name pos:start="133:36" pos:end="133:54">TPM_TIS_NO_LOCALITY</name></expr>;</expr_stmt>

                </block_content>}</block></else></if_stmt>

            </block_content>}</block></if> <else pos:start="137:15" pos:end="143:13">else <block pos:start="137:20" pos:end="143:13">{<block_content pos:start="141:17" pos:end="141:70">

                <comment type="block" pos:start="139:17" pos:end="139:70">/* not currently the owner; clear a pending request */</comment>

                <expr_stmt pos:start="141:17" pos:end="141:70"><expr pos:start="141:17" pos:end="141:69"><name pos:start="141:17" pos:end="141:31"><name pos:start="141:17" pos:end="141:19">tis</name><operator pos:start="141:20" pos:end="141:21">-&gt;</operator><name pos:start="141:22" pos:end="141:24">loc</name><index pos:start="141:25" pos:end="141:31">[<expr pos:start="141:26" pos:end="141:30"><name pos:start="141:26" pos:end="141:30">locty</name></expr>]</index></name><operator pos:start="141:32" pos:end="141:32">.</operator><name pos:start="141:33" pos:end="141:38">access</name> <operator pos:start="141:40" pos:end="141:41">&amp;=</operator> <operator pos:start="141:43" pos:end="141:43">~</operator><name pos:start="141:44" pos:end="141:69">TPM_TIS_ACCESS_REQUEST_USE</name></expr>;</expr_stmt>

            </block_content>}</block></else></if_stmt>

        </block_content>}</block></if></if_stmt>



        <if_stmt pos:start="149:9" pos:end="153:9"><if pos:start="149:9" pos:end="153:9">if <condition pos:start="149:12" pos:end="149:47">(<expr pos:start="149:13" pos:end="149:46"><operator pos:start="149:13" pos:end="149:13">(</operator><name pos:start="149:14" pos:end="149:16">val</name> <operator pos:start="149:18" pos:end="149:18">&amp;</operator> <name pos:start="149:20" pos:end="149:45">TPM_TIS_ACCESS_BEEN_SEIZED</name><operator pos:start="149:46" pos:end="149:46">)</operator></expr>)</condition> <block pos:start="149:49" pos:end="153:9">{<block_content pos:start="151:13" pos:end="151:66">

            <expr_stmt pos:start="151:13" pos:end="151:66"><expr pos:start="151:13" pos:end="151:65"><name pos:start="151:13" pos:end="151:27"><name pos:start="151:13" pos:end="151:15">tis</name><operator pos:start="151:16" pos:end="151:17">-&gt;</operator><name pos:start="151:18" pos:end="151:20">loc</name><index pos:start="151:21" pos:end="151:27">[<expr pos:start="151:22" pos:end="151:26"><name pos:start="151:22" pos:end="151:26">locty</name></expr>]</index></name><operator pos:start="151:28" pos:end="151:28">.</operator><name pos:start="151:29" pos:end="151:34">access</name> <operator pos:start="151:36" pos:end="151:37">&amp;=</operator> <operator pos:start="151:39" pos:end="151:39">~</operator><name pos:start="151:40" pos:end="151:65">TPM_TIS_ACCESS_BEEN_SEIZED</name></expr>;</expr_stmt>

        </block_content>}</block></if></if_stmt>



        <if_stmt pos:start="157:9" pos:end="245:9"><if pos:start="157:9" pos:end="245:9">if <condition pos:start="157:12" pos:end="157:41">(<expr pos:start="157:13" pos:end="157:40"><operator pos:start="157:13" pos:end="157:13">(</operator><name pos:start="157:14" pos:end="157:16">val</name> <operator pos:start="157:18" pos:end="157:18">&amp;</operator> <name pos:start="157:20" pos:end="157:39">TPM_TIS_ACCESS_SEIZE</name><operator pos:start="157:40" pos:end="157:40">)</operator></expr>)</condition> <block pos:start="157:43" pos:end="245:9">{<block_content pos:start="173:13" pos:end="243:13">

            <comment type="block" pos:start="159:13" pos:end="171:15">/*

             * allow seize if a locality is active and the requesting

             * locality is higher than the one that's active

             * OR

             * allow seize for requesting locality if no locality is

             * active

             */</comment>

            <while pos:start="173:13" pos:end="243:13">while <condition pos:start="173:19" pos:end="177:63">(<expr pos:start="173:20" pos:end="177:62"><operator pos:start="173:20" pos:end="173:20">(</operator><call pos:start="173:21" pos:end="173:61"><name pos:start="173:21" pos:end="173:42">TPM_TIS_IS_VALID_LOCTY</name><argument_list pos:start="173:43" pos:end="173:61">(<argument pos:start="173:44" pos:end="173:60"><expr pos:start="173:44" pos:end="173:60"><name pos:start="173:44" pos:end="173:60"><name pos:start="173:44" pos:end="173:46">tis</name><operator pos:start="173:47" pos:end="173:48">-&gt;</operator><name pos:start="173:49" pos:end="173:60">active_locty</name></name></expr></argument>)</argument_list></call> <operator pos:start="173:63" pos:end="173:64">&amp;&amp;</operator>

                    <name pos:start="175:21" pos:end="175:25">locty</name> <operator pos:start="175:27" pos:end="175:27">&gt;</operator> <name pos:start="175:29" pos:end="175:45"><name pos:start="175:29" pos:end="175:31">tis</name><operator pos:start="175:32" pos:end="175:33">-&gt;</operator><name pos:start="175:34" pos:end="175:45">active_locty</name></name><operator pos:start="175:46" pos:end="175:46">)</operator> <operator pos:start="175:48" pos:end="175:49">||</operator>

                    <operator pos:start="177:21" pos:end="177:21">!</operator><call pos:start="177:22" pos:end="177:62"><name pos:start="177:22" pos:end="177:43">TPM_TIS_IS_VALID_LOCTY</name><argument_list pos:start="177:44" pos:end="177:62">(<argument pos:start="177:45" pos:end="177:61"><expr pos:start="177:45" pos:end="177:61"><name pos:start="177:45" pos:end="177:61"><name pos:start="177:45" pos:end="177:47">tis</name><operator pos:start="177:48" pos:end="177:49">-&gt;</operator><name pos:start="177:50" pos:end="177:61">active_locty</name></name></expr></argument>)</argument_list></call></expr>)</condition> <block pos:start="177:65" pos:end="243:13">{<block_content pos:start="179:17" pos:end="241:22">

                <decl_stmt pos:start="179:17" pos:end="179:42"><decl pos:start="179:17" pos:end="179:41"><type pos:start="179:17" pos:end="179:20"><name pos:start="179:17" pos:end="179:20">bool</name></type> <name pos:start="179:22" pos:end="179:33">higher_seize</name> <init pos:start="179:35" pos:end="179:41">= <expr pos:start="179:37" pos:end="179:41"><name pos:start="179:37" pos:end="179:41">FALSE</name></expr></init></decl>;</decl_stmt>



                <comment type="block" pos:start="183:17" pos:end="183:47">/* already a pending SEIZE ? */</comment>

                <if_stmt pos:start="185:17" pos:end="189:17"><if pos:start="185:17" pos:end="189:17">if <condition pos:start="185:20" pos:end="185:68">(<expr pos:start="185:21" pos:end="185:67"><operator pos:start="185:21" pos:end="185:21">(</operator><name pos:start="185:22" pos:end="185:36"><name pos:start="185:22" pos:end="185:24">tis</name><operator pos:start="185:25" pos:end="185:26">-&gt;</operator><name pos:start="185:27" pos:end="185:29">loc</name><index pos:start="185:30" pos:end="185:36">[<expr pos:start="185:31" pos:end="185:35"><name pos:start="185:31" pos:end="185:35">locty</name></expr>]</index></name><operator pos:start="185:37" pos:end="185:37">.</operator><name pos:start="185:38" pos:end="185:43">access</name> <operator pos:start="185:45" pos:end="185:45">&amp;</operator> <name pos:start="185:47" pos:end="185:66">TPM_TIS_ACCESS_SEIZE</name><operator pos:start="185:67" pos:end="185:67">)</operator></expr>)</condition> <block pos:start="185:70" pos:end="189:17">{<block_content pos:start="187:21" pos:end="187:26">

                    <break pos:start="187:21" pos:end="187:26">break;</break>

                </block_content>}</block></if></if_stmt>



                <comment type="block" pos:start="193:17" pos:end="193:66">/* check for ongoing seize by a higher locality */</comment>

                <for pos:start="195:17" pos:end="205:17">for <control pos:start="195:21" pos:end="195:68">(<init pos:start="195:22" pos:end="195:35"><expr pos:start="195:22" pos:end="195:34"><name pos:start="195:22" pos:end="195:22">l</name> <operator pos:start="195:24" pos:end="195:24">=</operator> <name pos:start="195:26" pos:end="195:30">locty</name> <operator pos:start="195:32" pos:end="195:32">+</operator> <literal type="number" pos:start="195:34" pos:end="195:34">1</literal></expr>;</init> <condition pos:start="195:37" pos:end="195:63"><expr pos:start="195:37" pos:end="195:62"><name pos:start="195:37" pos:end="195:37">l</name> <operator pos:start="195:39" pos:end="195:39">&lt;</operator> <name pos:start="195:41" pos:end="195:62">TPM_TIS_NUM_LOCALITIES</name></expr>;</condition> <incr pos:start="195:65" pos:end="195:67"><expr pos:start="195:65" pos:end="195:67"><name pos:start="195:65" pos:end="195:65">l</name><operator pos:start="195:66" pos:end="195:67">++</operator></expr></incr>)</control> <block pos:start="195:70" pos:end="205:17">{<block_content pos:start="197:21" pos:end="203:21">

                    <if_stmt pos:start="197:21" pos:end="203:21"><if pos:start="197:21" pos:end="203:21">if <condition pos:start="197:24" pos:end="197:68">(<expr pos:start="197:25" pos:end="197:67"><operator pos:start="197:25" pos:end="197:25">(</operator><name pos:start="197:26" pos:end="197:36"><name pos:start="197:26" pos:end="197:28">tis</name><operator pos:start="197:29" pos:end="197:30">-&gt;</operator><name pos:start="197:31" pos:end="197:33">loc</name><index pos:start="197:34" pos:end="197:36">[<expr pos:start="197:35" pos:end="197:35"><name pos:start="197:35" pos:end="197:35">l</name></expr>]</index></name><operator pos:start="197:37" pos:end="197:37">.</operator><name pos:start="197:38" pos:end="197:43">access</name> <operator pos:start="197:45" pos:end="197:45">&amp;</operator> <name pos:start="197:47" pos:end="197:66">TPM_TIS_ACCESS_SEIZE</name><operator pos:start="197:67" pos:end="197:67">)</operator></expr>)</condition> <block pos:start="197:70" pos:end="203:21">{<block_content pos:start="199:25" pos:end="201:30">

                        <expr_stmt pos:start="199:25" pos:end="199:44"><expr pos:start="199:25" pos:end="199:43"><name pos:start="199:25" pos:end="199:36">higher_seize</name> <operator pos:start="199:38" pos:end="199:38">=</operator> <name pos:start="199:40" pos:end="199:43">TRUE</name></expr>;</expr_stmt>

                        <break pos:start="201:25" pos:end="201:30">break;</break>

                    </block_content>}</block></if></if_stmt>

                </block_content>}</block></for>



                <if_stmt pos:start="209:17" pos:end="213:17"><if pos:start="209:17" pos:end="213:17">if <condition pos:start="209:20" pos:end="209:33">(<expr pos:start="209:21" pos:end="209:32"><name pos:start="209:21" pos:end="209:32">higher_seize</name></expr>)</condition> <block pos:start="209:35" pos:end="213:17">{<block_content pos:start="211:21" pos:end="211:26">

                    <break pos:start="211:21" pos:end="211:26">break;</break>

                </block_content>}</block></if></if_stmt>



                <comment type="block" pos:start="217:17" pos:end="217:58">/* cancel any seize by a lower locality */</comment>

                <for pos:start="219:17" pos:end="223:17">for <control pos:start="219:21" pos:end="219:47">(<init pos:start="219:22" pos:end="219:27"><expr pos:start="219:22" pos:end="219:26"><name pos:start="219:22" pos:end="219:22">l</name> <operator pos:start="219:24" pos:end="219:24">=</operator> <literal type="number" pos:start="219:26" pos:end="219:26">0</literal></expr>;</init> <condition pos:start="219:29" pos:end="219:42"><expr pos:start="219:29" pos:end="219:41"><name pos:start="219:29" pos:end="219:29">l</name> <operator pos:start="219:31" pos:end="219:31">&lt;</operator> <name pos:start="219:33" pos:end="219:37">locty</name> <operator pos:start="219:39" pos:end="219:39">-</operator> <literal type="number" pos:start="219:41" pos:end="219:41">1</literal></expr>;</condition> <incr pos:start="219:44" pos:end="219:46"><expr pos:start="219:44" pos:end="219:46"><name pos:start="219:44" pos:end="219:44">l</name><operator pos:start="219:45" pos:end="219:46">++</operator></expr></incr>)</control> <block pos:start="219:49" pos:end="223:17">{<block_content pos:start="221:21" pos:end="221:64">

                    <expr_stmt pos:start="221:21" pos:end="221:64"><expr pos:start="221:21" pos:end="221:63"><name pos:start="221:21" pos:end="221:31"><name pos:start="221:21" pos:end="221:23">tis</name><operator pos:start="221:24" pos:end="221:25">-&gt;</operator><name pos:start="221:26" pos:end="221:28">loc</name><index pos:start="221:29" pos:end="221:31">[<expr pos:start="221:30" pos:end="221:30"><name pos:start="221:30" pos:end="221:30">l</name></expr>]</index></name><operator pos:start="221:32" pos:end="221:32">.</operator><name pos:start="221:33" pos:end="221:38">access</name> <operator pos:start="221:40" pos:end="221:41">&amp;=</operator> <operator pos:start="221:43" pos:end="221:43">~</operator><name pos:start="221:44" pos:end="221:63">TPM_TIS_ACCESS_SEIZE</name></expr>;</expr_stmt>

                </block_content>}</block></for>



                <expr_stmt pos:start="227:17" pos:end="227:63"><expr pos:start="227:17" pos:end="227:62"><name pos:start="227:17" pos:end="227:31"><name pos:start="227:17" pos:end="227:19">tis</name><operator pos:start="227:20" pos:end="227:21">-&gt;</operator><name pos:start="227:22" pos:end="227:24">loc</name><index pos:start="227:25" pos:end="227:31">[<expr pos:start="227:26" pos:end="227:30"><name pos:start="227:26" pos:end="227:30">locty</name></expr>]</index></name><operator pos:start="227:32" pos:end="227:32">.</operator><name pos:start="227:33" pos:end="227:38">access</name> <operator pos:start="227:40" pos:end="227:41">|=</operator> <name pos:start="227:43" pos:end="227:62">TPM_TIS_ACCESS_SEIZE</name></expr>;</expr_stmt>

                <expr_stmt pos:start="229:17" pos:end="233:50"><expr pos:start="229:17" pos:end="233:49"><call pos:start="229:17" pos:end="233:49"><name pos:start="229:17" pos:end="229:23">DPRINTF</name><argument_list pos:start="229:24" pos:end="233:49">(<argument pos:start="229:25" pos:end="231:63"><expr pos:start="229:25" pos:end="231:63"><literal type="string" pos:start="229:25" pos:end="229:57">"tpm_tis: TPM_TIS_ACCESS_SEIZE: "</literal>

                        <literal type="string" pos:start="231:25" pos:end="231:63">"Locality %d seized from locality %d\n"</literal></expr></argument>,

                        <argument pos:start="233:25" pos:end="233:29"><expr pos:start="233:25" pos:end="233:29"><name pos:start="233:25" pos:end="233:29">locty</name></expr></argument>, <argument pos:start="233:32" pos:end="233:48"><expr pos:start="233:32" pos:end="233:48"><name pos:start="233:32" pos:end="233:48"><name pos:start="233:32" pos:end="233:34">tis</name><operator pos:start="233:35" pos:end="233:36">-&gt;</operator><name pos:start="233:37" pos:end="233:48">active_locty</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <expr_stmt pos:start="235:17" pos:end="235:78"><expr pos:start="235:17" pos:end="235:77"><call pos:start="235:17" pos:end="235:77"><name pos:start="235:17" pos:end="235:23">DPRINTF</name><argument_list pos:start="235:24" pos:end="235:77">(<argument pos:start="235:25" pos:end="235:76"><expr pos:start="235:25" pos:end="235:76"><literal type="string" pos:start="235:25" pos:end="235:76">"tpm_tis: TPM_TIS_ACCESS_SEIZE: Initiating abort.\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <expr_stmt pos:start="237:17" pos:end="237:34"><expr pos:start="237:17" pos:end="237:33"><name pos:start="237:17" pos:end="237:29">set_new_locty</name> <operator pos:start="237:31" pos:end="237:31">=</operator> <literal type="number" pos:start="237:33" pos:end="237:33">0</literal></expr>;</expr_stmt>

                <expr_stmt pos:start="239:17" pos:end="239:64"><expr pos:start="239:17" pos:end="239:63"><call pos:start="239:17" pos:end="239:63"><name pos:start="239:17" pos:end="239:34">tpm_tis_prep_abort</name><argument_list pos:start="239:35" pos:end="239:63">(<argument pos:start="239:36" pos:end="239:36"><expr pos:start="239:36" pos:end="239:36"><name pos:start="239:36" pos:end="239:36">s</name></expr></argument>, <argument pos:start="239:39" pos:end="239:55"><expr pos:start="239:39" pos:end="239:55"><name pos:start="239:39" pos:end="239:55"><name pos:start="239:39" pos:end="239:41">tis</name><operator pos:start="239:42" pos:end="239:43">-&gt;</operator><name pos:start="239:44" pos:end="239:55">active_locty</name></name></expr></argument>, <argument pos:start="239:58" pos:end="239:62"><expr pos:start="239:58" pos:end="239:62"><name pos:start="239:58" pos:end="239:62">locty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <break pos:start="241:17" pos:end="241:22">break;</break>

            </block_content>}</block></while>

        </block_content>}</block></if></if_stmt>



        <if_stmt pos:start="249:9" pos:end="267:9"><if pos:start="249:9" pos:end="267:9">if <condition pos:start="249:12" pos:end="249:47">(<expr pos:start="249:13" pos:end="249:46"><operator pos:start="249:13" pos:end="249:13">(</operator><name pos:start="249:14" pos:end="249:16">val</name> <operator pos:start="249:18" pos:end="249:18">&amp;</operator> <name pos:start="249:20" pos:end="249:45">TPM_TIS_ACCESS_REQUEST_USE</name><operator pos:start="249:46" pos:end="249:46">)</operator></expr>)</condition> <block pos:start="249:49" pos:end="267:9">{<block_content pos:start="251:13" pos:end="265:13">

            <if_stmt pos:start="251:13" pos:end="265:13"><if pos:start="251:13" pos:end="265:13">if <condition pos:start="251:16" pos:end="251:43">(<expr pos:start="251:17" pos:end="251:42"><name pos:start="251:17" pos:end="251:33"><name pos:start="251:17" pos:end="251:19">tis</name><operator pos:start="251:20" pos:end="251:21">-&gt;</operator><name pos:start="251:22" pos:end="251:33">active_locty</name></name> <operator pos:start="251:35" pos:end="251:36">!=</operator> <name pos:start="251:38" pos:end="251:42">locty</name></expr>)</condition> <block pos:start="251:45" pos:end="265:13">{<block_content pos:start="253:17" pos:end="263:17">

                <if_stmt pos:start="253:17" pos:end="263:17"><if pos:start="253:17" pos:end="257:17">if <condition pos:start="253:20" pos:end="253:62">(<expr pos:start="253:21" pos:end="253:61"><call pos:start="253:21" pos:end="253:61"><name pos:start="253:21" pos:end="253:42">TPM_TIS_IS_VALID_LOCTY</name><argument_list pos:start="253:43" pos:end="253:61">(<argument pos:start="253:44" pos:end="253:60"><expr pos:start="253:44" pos:end="253:60"><name pos:start="253:44" pos:end="253:60"><name pos:start="253:44" pos:end="253:46">tis</name><operator pos:start="253:47" pos:end="253:48">-&gt;</operator><name pos:start="253:49" pos:end="253:60">active_locty</name></name></expr></argument>)</argument_list></call></expr>)</condition> <block pos:start="253:64" pos:end="257:17">{<block_content pos:start="255:21" pos:end="255:73">

                    <expr_stmt pos:start="255:21" pos:end="255:73"><expr pos:start="255:21" pos:end="255:72"><name pos:start="255:21" pos:end="255:35"><name pos:start="255:21" pos:end="255:23">tis</name><operator pos:start="255:24" pos:end="255:25">-&gt;</operator><name pos:start="255:26" pos:end="255:28">loc</name><index pos:start="255:29" pos:end="255:35">[<expr pos:start="255:30" pos:end="255:34"><name pos:start="255:30" pos:end="255:34">locty</name></expr>]</index></name><operator pos:start="255:36" pos:end="255:36">.</operator><name pos:start="255:37" pos:end="255:42">access</name> <operator pos:start="255:44" pos:end="255:45">|=</operator> <name pos:start="255:47" pos:end="255:72">TPM_TIS_ACCESS_REQUEST_USE</name></expr>;</expr_stmt>

                </block_content>}</block></if> <else pos:start="257:19" pos:end="263:17">else <block pos:start="257:24" pos:end="263:17">{<block_content pos:start="261:21" pos:end="261:41">

                    <comment type="block" pos:start="259:21" pos:end="259:72">/* no locality active -&gt; make this one active now */</comment>

                    <expr_stmt pos:start="261:21" pos:end="261:41"><expr pos:start="261:21" pos:end="261:40"><name pos:start="261:21" pos:end="261:32">active_locty</name> <operator pos:start="261:34" pos:end="261:34">=</operator> <name pos:start="261:36" pos:end="261:40">locty</name></expr>;</expr_stmt>

                </block_content>}</block></else></if_stmt>

            </block_content>}</block></if></if_stmt>

        </block_content>}</block></if></if_stmt>



        <if_stmt pos:start="271:9" pos:end="275:9"><if pos:start="271:9" pos:end="275:9">if <condition pos:start="271:12" pos:end="271:26">(<expr pos:start="271:13" pos:end="271:25"><name pos:start="271:13" pos:end="271:25">set_new_locty</name></expr>)</condition> <block pos:start="271:28" pos:end="275:9">{<block_content pos:start="273:13" pos:end="273:57">

            <expr_stmt pos:start="273:13" pos:end="273:57"><expr pos:start="273:13" pos:end="273:56"><call pos:start="273:13" pos:end="273:56"><name pos:start="273:13" pos:end="273:39">tpm_tis_new_active_locality</name><argument_list pos:start="273:40" pos:end="273:56">(<argument pos:start="273:41" pos:end="273:41"><expr pos:start="273:41" pos:end="273:41"><name pos:start="273:41" pos:end="273:41">s</name></expr></argument>, <argument pos:start="273:44" pos:end="273:55"><expr pos:start="273:44" pos:end="273:55"><name pos:start="273:44" pos:end="273:55">active_locty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        </block_content>}</block></if></if_stmt>



        <break pos:start="279:9" pos:end="279:14">break;</break>

    <case pos:start="281:5" pos:end="281:32">case <expr pos:start="281:10" pos:end="281:31"><name pos:start="281:10" pos:end="281:31">TPM_TIS_REG_INT_ENABLE</name></expr>:</case>

        <if_stmt pos:start="283:9" pos:end="287:9"><if pos:start="283:9" pos:end="287:9">if <condition pos:start="283:12" pos:end="283:39">(<expr pos:start="283:13" pos:end="283:38"><name pos:start="283:13" pos:end="283:29"><name pos:start="283:13" pos:end="283:15">tis</name><operator pos:start="283:16" pos:end="283:17">-&gt;</operator><name pos:start="283:18" pos:end="283:29">active_locty</name></name> <operator pos:start="283:31" pos:end="283:32">!=</operator> <name pos:start="283:34" pos:end="283:38">locty</name></expr>)</condition> <block pos:start="283:41" pos:end="287:9">{<block_content pos:start="285:13" pos:end="285:18">

            <break pos:start="285:13" pos:end="285:18">break;</break>

        </block_content>}</block></if></if_stmt>



        <expr_stmt pos:start="291:9" pos:end="291:37"><expr pos:start="291:9" pos:end="291:36"><name pos:start="291:9" pos:end="291:23"><name pos:start="291:9" pos:end="291:11">tis</name><operator pos:start="291:12" pos:end="291:13">-&gt;</operator><name pos:start="291:14" pos:end="291:16">loc</name><index pos:start="291:17" pos:end="291:23">[<expr pos:start="291:18" pos:end="291:22"><name pos:start="291:18" pos:end="291:22">locty</name></expr>]</index></name><operator pos:start="291:24" pos:end="291:24">.</operator><name pos:start="291:25" pos:end="291:28">inte</name> <operator pos:start="291:30" pos:end="291:31">&amp;=</operator> <name pos:start="291:33" pos:end="291:36">mask</name></expr>;</expr_stmt>

        <expr_stmt pos:start="293:9" pos:end="297:71"><expr pos:start="293:9" pos:end="297:70"><name pos:start="293:9" pos:end="293:23"><name pos:start="293:9" pos:end="293:11">tis</name><operator pos:start="293:12" pos:end="293:13">-&gt;</operator><name pos:start="293:14" pos:end="293:16">loc</name><index pos:start="293:17" pos:end="293:23">[<expr pos:start="293:18" pos:end="293:22"><name pos:start="293:18" pos:end="293:22">locty</name></expr>]</index></name><operator pos:start="293:24" pos:end="293:24">.</operator><name pos:start="293:25" pos:end="293:28">inte</name> <operator pos:start="293:30" pos:end="293:31">|=</operator> <operator pos:start="293:33" pos:end="293:33">(</operator><name pos:start="293:34" pos:end="293:36">val</name> <operator pos:start="293:38" pos:end="293:38">&amp;</operator> <operator pos:start="293:40" pos:end="293:40">(</operator><name pos:start="293:41" pos:end="293:59">TPM_TIS_INT_ENABLED</name> <operator pos:start="293:61" pos:end="293:61">|</operator>

                                        <name pos:start="295:41" pos:end="295:65">TPM_TIS_INT_POLARITY_MASK</name> <operator pos:start="295:67" pos:end="295:67">|</operator>

                                        <name pos:start="297:41" pos:end="297:68">TPM_TIS_INTERRUPTS_SUPPORTED</name><operator pos:start="297:69" pos:end="297:69">)</operator><operator pos:start="297:70" pos:end="297:70">)</operator></expr>;</expr_stmt>

        <break pos:start="299:9" pos:end="299:14">break;</break>

    <case pos:start="301:5" pos:end="301:32">case <expr pos:start="301:10" pos:end="301:31"><name pos:start="301:10" pos:end="301:31">TPM_TIS_REG_INT_VECTOR</name></expr>:</case>

        <comment type="block" pos:start="303:9" pos:end="303:34">/* hard wired -- ignore */</comment>

        <break pos:start="305:9" pos:end="305:14">break;</break>

    <case pos:start="307:5" pos:end="307:32">case <expr pos:start="307:10" pos:end="307:31"><name pos:start="307:10" pos:end="307:31">TPM_TIS_REG_INT_STATUS</name></expr>:</case>

        <if_stmt pos:start="309:9" pos:end="313:9"><if pos:start="309:9" pos:end="313:9">if <condition pos:start="309:12" pos:end="309:39">(<expr pos:start="309:13" pos:end="309:38"><name pos:start="309:13" pos:end="309:29"><name pos:start="309:13" pos:end="309:15">tis</name><operator pos:start="309:16" pos:end="309:17">-&gt;</operator><name pos:start="309:18" pos:end="309:29">active_locty</name></name> <operator pos:start="309:31" pos:end="309:32">!=</operator> <name pos:start="309:34" pos:end="309:38">locty</name></expr>)</condition> <block pos:start="309:41" pos:end="313:9">{<block_content pos:start="311:13" pos:end="311:18">

            <break pos:start="311:13" pos:end="311:18">break;</break>

        </block_content>}</block></if></if_stmt>



        <comment type="block" pos:start="317:9" pos:end="317:41">/* clearing of interrupt flags */</comment>

        <if_stmt pos:start="319:9" pos:end="333:9"><if pos:start="319:9" pos:end="333:9">if <condition pos:start="319:12" pos:end="321:66">(<expr pos:start="319:13" pos:end="321:65"><operator pos:start="319:13" pos:end="319:13">(</operator><operator pos:start="319:14" pos:end="319:14">(</operator><name pos:start="319:15" pos:end="319:17">val</name> <operator pos:start="319:19" pos:end="319:19">&amp;</operator> <name pos:start="319:21" pos:end="319:48">TPM_TIS_INTERRUPTS_SUPPORTED</name><operator pos:start="319:49" pos:end="319:49">)</operator><operator pos:start="319:50" pos:end="319:50">)</operator> <operator pos:start="319:52" pos:end="319:53">&amp;&amp;</operator>

            <operator pos:start="321:13" pos:end="321:13">(</operator><name pos:start="321:14" pos:end="321:28"><name pos:start="321:14" pos:end="321:16">tis</name><operator pos:start="321:17" pos:end="321:18">-&gt;</operator><name pos:start="321:19" pos:end="321:21">loc</name><index pos:start="321:22" pos:end="321:28">[<expr pos:start="321:23" pos:end="321:27"><name pos:start="321:23" pos:end="321:27">locty</name></expr>]</index></name><operator pos:start="321:29" pos:end="321:29">.</operator><name pos:start="321:30" pos:end="321:33">ints</name> <operator pos:start="321:35" pos:end="321:35">&amp;</operator> <name pos:start="321:37" pos:end="321:64">TPM_TIS_INTERRUPTS_SUPPORTED</name><operator pos:start="321:65" pos:end="321:65">)</operator></expr>)</condition> <block pos:start="321:68" pos:end="333:9">{<block_content pos:start="323:13" pos:end="331:13">

            <expr_stmt pos:start="323:13" pos:end="323:41"><expr pos:start="323:13" pos:end="323:40"><name pos:start="323:13" pos:end="323:27"><name pos:start="323:13" pos:end="323:15">tis</name><operator pos:start="323:16" pos:end="323:17">-&gt;</operator><name pos:start="323:18" pos:end="323:20">loc</name><index pos:start="323:21" pos:end="323:27">[<expr pos:start="323:22" pos:end="323:26"><name pos:start="323:22" pos:end="323:26">locty</name></expr>]</index></name><operator pos:start="323:28" pos:end="323:28">.</operator><name pos:start="323:29" pos:end="323:32">ints</name> <operator pos:start="323:34" pos:end="323:35">&amp;=</operator> <operator pos:start="323:37" pos:end="323:37">~</operator><name pos:start="323:38" pos:end="323:40">val</name></expr>;</expr_stmt>

            <if_stmt pos:start="325:13" pos:end="331:13"><if pos:start="325:13" pos:end="331:13">if <condition pos:start="325:16" pos:end="325:42">(<expr pos:start="325:17" pos:end="325:41"><name pos:start="325:17" pos:end="325:31"><name pos:start="325:17" pos:end="325:19">tis</name><operator pos:start="325:20" pos:end="325:21">-&gt;</operator><name pos:start="325:22" pos:end="325:24">loc</name><index pos:start="325:25" pos:end="325:31">[<expr pos:start="325:26" pos:end="325:30"><name pos:start="325:26" pos:end="325:30">locty</name></expr>]</index></name><operator pos:start="325:32" pos:end="325:32">.</operator><name pos:start="325:33" pos:end="325:36">ints</name> <operator pos:start="325:38" pos:end="325:39">==</operator> <literal type="number" pos:start="325:41" pos:end="325:41">0</literal></expr>)</condition> <block pos:start="325:44" pos:end="331:13">{<block_content pos:start="327:17" pos:end="329:51">

                <expr_stmt pos:start="327:17" pos:end="327:41"><expr pos:start="327:17" pos:end="327:40"><call pos:start="327:17" pos:end="327:40"><name pos:start="327:17" pos:end="327:30">qemu_irq_lower</name><argument_list pos:start="327:31" pos:end="327:40">(<argument pos:start="327:32" pos:end="327:39"><expr pos:start="327:32" pos:end="327:39"><name pos:start="327:32" pos:end="327:39"><name pos:start="327:32" pos:end="327:34">tis</name><operator pos:start="327:35" pos:end="327:36">-&gt;</operator><name pos:start="327:37" pos:end="327:39">irq</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <expr_stmt pos:start="329:17" pos:end="329:51"><expr pos:start="329:17" pos:end="329:50"><call pos:start="329:17" pos:end="329:50"><name pos:start="329:17" pos:end="329:23">DPRINTF</name><argument_list pos:start="329:24" pos:end="329:50">(<argument pos:start="329:25" pos:end="329:49"><expr pos:start="329:25" pos:end="329:49"><literal type="string" pos:start="329:25" pos:end="329:49">"tpm_tis: Lowering IRQ\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            </block_content>}</block></if></if_stmt>

        </block_content>}</block></if></if_stmt>

        <expr_stmt pos:start="335:9" pos:end="335:70"><expr pos:start="335:9" pos:end="335:69"><name pos:start="335:9" pos:end="335:23"><name pos:start="335:9" pos:end="335:11">tis</name><operator pos:start="335:12" pos:end="335:13">-&gt;</operator><name pos:start="335:14" pos:end="335:16">loc</name><index pos:start="335:17" pos:end="335:23">[<expr pos:start="335:18" pos:end="335:22"><name pos:start="335:18" pos:end="335:22">locty</name></expr>]</index></name><operator pos:start="335:24" pos:end="335:24">.</operator><name pos:start="335:25" pos:end="335:28">ints</name> <operator pos:start="335:30" pos:end="335:31">&amp;=</operator> <operator pos:start="335:33" pos:end="335:33">~</operator><operator pos:start="335:34" pos:end="335:34">(</operator><name pos:start="335:35" pos:end="335:37">val</name> <operator pos:start="335:39" pos:end="335:39">&amp;</operator> <name pos:start="335:41" pos:end="335:68">TPM_TIS_INTERRUPTS_SUPPORTED</name><operator pos:start="335:69" pos:end="335:69">)</operator></expr>;</expr_stmt>

        <break pos:start="337:9" pos:end="337:14">break;</break>

    <case pos:start="339:5" pos:end="339:25">case <expr pos:start="339:10" pos:end="339:24"><name pos:start="339:10" pos:end="339:24">TPM_TIS_REG_STS</name></expr>:</case>

        <if_stmt pos:start="341:9" pos:end="345:9"><if pos:start="341:9" pos:end="345:9">if <condition pos:start="341:12" pos:end="341:39">(<expr pos:start="341:13" pos:end="341:38"><name pos:start="341:13" pos:end="341:29"><name pos:start="341:13" pos:end="341:15">tis</name><operator pos:start="341:16" pos:end="341:17">-&gt;</operator><name pos:start="341:18" pos:end="341:29">active_locty</name></name> <operator pos:start="341:31" pos:end="341:32">!=</operator> <name pos:start="341:34" pos:end="341:38">locty</name></expr>)</condition> <block pos:start="341:41" pos:end="345:9">{<block_content pos:start="343:13" pos:end="343:18">

            <break pos:start="343:13" pos:end="343:18">break;</break>

        </block_content>}</block></if></if_stmt>



        <expr_stmt pos:start="349:9" pos:end="351:44"><expr pos:start="349:9" pos:end="351:43"><name pos:start="349:9" pos:end="349:11">val</name> <operator pos:start="349:13" pos:end="349:14">&amp;=</operator> <operator pos:start="349:16" pos:end="349:16">(</operator><name pos:start="349:17" pos:end="349:41">TPM_TIS_STS_COMMAND_READY</name> <operator pos:start="349:43" pos:end="349:43">|</operator> <name pos:start="349:45" pos:end="349:62">TPM_TIS_STS_TPM_GO</name> <operator pos:start="349:64" pos:end="349:64">|</operator>

                <name pos:start="351:17" pos:end="351:42">TPM_TIS_STS_RESPONSE_RETRY</name><operator pos:start="351:43" pos:end="351:43">)</operator></expr>;</expr_stmt>



        <if_stmt pos:start="355:9" pos:end="469:9"><if pos:start="355:9" pos:end="425:9">if <condition pos:start="355:12" pos:end="355:45">(<expr pos:start="355:13" pos:end="355:44"><name pos:start="355:13" pos:end="355:15">val</name> <operator pos:start="355:17" pos:end="355:18">==</operator> <name pos:start="355:20" pos:end="355:44">TPM_TIS_STS_COMMAND_READY</name></expr>)</condition> <block pos:start="355:47" pos:end="425:9">{<block_content pos:start="357:13" pos:end="423:13">

            <switch pos:start="357:13" pos:end="423:13">switch <condition pos:start="357:20" pos:end="357:42">(<expr pos:start="357:21" pos:end="357:41"><name pos:start="357:21" pos:end="357:35"><name pos:start="357:21" pos:end="357:23">tis</name><operator pos:start="357:24" pos:end="357:25">-&gt;</operator><name pos:start="357:26" pos:end="357:28">loc</name><index pos:start="357:29" pos:end="357:35">[<expr pos:start="357:30" pos:end="357:34"><name pos:start="357:30" pos:end="357:34">locty</name></expr>]</index></name><operator pos:start="357:36" pos:end="357:36">.</operator><name pos:start="357:37" pos:end="357:41">state</name></expr>)</condition> <block pos:start="357:44" pos:end="423:13">{<block_content pos:start="361:13" pos:end="419:18">



            <case pos:start="361:13" pos:end="361:37">case <expr pos:start="361:18" pos:end="361:36"><name pos:start="361:18" pos:end="361:36">TPM_TIS_STATE_READY</name></expr>:</case>

                <expr_stmt pos:start="363:17" pos:end="363:45"><expr pos:start="363:17" pos:end="363:44"><name pos:start="363:17" pos:end="363:31"><name pos:start="363:17" pos:end="363:19">tis</name><operator pos:start="363:20" pos:end="363:21">-&gt;</operator><name pos:start="363:22" pos:end="363:24">loc</name><index pos:start="363:25" pos:end="363:31">[<expr pos:start="363:26" pos:end="363:30"><name pos:start="363:26" pos:end="363:30">locty</name></expr>]</index></name><operator pos:start="363:32" pos:end="363:32">.</operator><name pos:start="363:33" pos:end="363:40">w_offset</name> <operator pos:start="363:42" pos:end="363:42">=</operator> <literal type="number" pos:start="363:44" pos:end="363:44">0</literal></expr>;</expr_stmt>

                <expr_stmt pos:start="365:17" pos:end="365:45"><expr pos:start="365:17" pos:end="365:44"><name pos:start="365:17" pos:end="365:31"><name pos:start="365:17" pos:end="365:19">tis</name><operator pos:start="365:20" pos:end="365:21">-&gt;</operator><name pos:start="365:22" pos:end="365:24">loc</name><index pos:start="365:25" pos:end="365:31">[<expr pos:start="365:26" pos:end="365:30"><name pos:start="365:26" pos:end="365:30">locty</name></expr>]</index></name><operator pos:start="365:32" pos:end="365:32">.</operator><name pos:start="365:33" pos:end="365:40">r_offset</name> <operator pos:start="365:42" pos:end="365:42">=</operator> <literal type="number" pos:start="365:44" pos:end="365:44">0</literal></expr>;</expr_stmt>

            <break pos:start="367:13" pos:end="367:18">break;</break>



            <case pos:start="371:13" pos:end="371:36">case <expr pos:start="371:18" pos:end="371:35"><name pos:start="371:18" pos:end="371:35">TPM_TIS_STATE_IDLE</name></expr>:</case>

                <expr_stmt pos:start="373:17" pos:end="373:64"><expr pos:start="373:17" pos:end="373:63"><name pos:start="373:17" pos:end="373:31"><name pos:start="373:17" pos:end="373:19">tis</name><operator pos:start="373:20" pos:end="373:21">-&gt;</operator><name pos:start="373:22" pos:end="373:24">loc</name><index pos:start="373:25" pos:end="373:31">[<expr pos:start="373:26" pos:end="373:30"><name pos:start="373:26" pos:end="373:30">locty</name></expr>]</index></name><operator pos:start="373:32" pos:end="373:32">.</operator><name pos:start="373:33" pos:end="373:35">sts</name> <operator pos:start="373:37" pos:end="373:37">=</operator> <name pos:start="373:39" pos:end="373:63">TPM_TIS_STS_COMMAND_READY</name></expr>;</expr_stmt>

                <expr_stmt pos:start="375:17" pos:end="375:60"><expr pos:start="375:17" pos:end="375:59"><name pos:start="375:17" pos:end="375:31"><name pos:start="375:17" pos:end="375:19">tis</name><operator pos:start="375:20" pos:end="375:21">-&gt;</operator><name pos:start="375:22" pos:end="375:24">loc</name><index pos:start="375:25" pos:end="375:31">[<expr pos:start="375:26" pos:end="375:30"><name pos:start="375:26" pos:end="375:30">locty</name></expr>]</index></name><operator pos:start="375:32" pos:end="375:32">.</operator><name pos:start="375:33" pos:end="375:37">state</name> <operator pos:start="375:39" pos:end="375:39">=</operator> <name pos:start="375:41" pos:end="375:59">TPM_TIS_STATE_READY</name></expr>;</expr_stmt>

                <expr_stmt pos:start="377:17" pos:end="377:71"><expr pos:start="377:17" pos:end="377:70"><call pos:start="377:17" pos:end="377:70"><name pos:start="377:17" pos:end="377:33">tpm_tis_raise_irq</name><argument_list pos:start="377:34" pos:end="377:70">(<argument pos:start="377:35" pos:end="377:35"><expr pos:start="377:35" pos:end="377:35"><name pos:start="377:35" pos:end="377:35">s</name></expr></argument>, <argument pos:start="377:38" pos:end="377:42"><expr pos:start="377:38" pos:end="377:42"><name pos:start="377:38" pos:end="377:42">locty</name></expr></argument>, <argument pos:start="377:45" pos:end="377:69"><expr pos:start="377:45" pos:end="377:69"><name pos:start="377:45" pos:end="377:69">TPM_TIS_INT_COMMAND_READY</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <break pos:start="379:13" pos:end="379:18">break;</break>



            <case pos:start="383:13" pos:end="383:41">case <expr pos:start="383:18" pos:end="383:40"><name pos:start="383:18" pos:end="383:40">TPM_TIS_STATE_EXECUTION</name></expr>:</case>

            <case pos:start="385:13" pos:end="385:41">case <expr pos:start="385:18" pos:end="385:40"><name pos:start="385:18" pos:end="385:40">TPM_TIS_STATE_RECEPTION</name></expr>:</case>

                <comment type="block" pos:start="387:17" pos:end="387:53">/* abort currently running command */</comment>

                <expr_stmt pos:start="389:17" pos:end="391:34"><expr pos:start="389:17" pos:end="391:33"><call pos:start="389:17" pos:end="391:33"><name pos:start="389:17" pos:end="389:23">DPRINTF</name><argument_list pos:start="389:24" pos:end="391:33">(<argument pos:start="389:25" pos:end="389:58"><expr pos:start="389:25" pos:end="389:58"><literal type="string" pos:start="389:25" pos:end="389:58">"tpm_tis: %s: Initiating abort.\n"</literal></expr></argument>,

                        <argument pos:start="391:25" pos:end="391:32"><expr pos:start="391:25" pos:end="391:32"><name pos:start="391:25" pos:end="391:32">__func__</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <expr_stmt pos:start="393:17" pos:end="393:52"><expr pos:start="393:17" pos:end="393:51"><call pos:start="393:17" pos:end="393:51"><name pos:start="393:17" pos:end="393:34">tpm_tis_prep_abort</name><argument_list pos:start="393:35" pos:end="393:51">(<argument pos:start="393:36" pos:end="393:36"><expr pos:start="393:36" pos:end="393:36"><name pos:start="393:36" pos:end="393:36">s</name></expr></argument>, <argument pos:start="393:39" pos:end="393:43"><expr pos:start="393:39" pos:end="393:43"><name pos:start="393:39" pos:end="393:43">locty</name></expr></argument>, <argument pos:start="393:46" pos:end="393:50"><expr pos:start="393:46" pos:end="393:50"><name pos:start="393:46" pos:end="393:50">locty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <break pos:start="395:13" pos:end="395:18">break;</break>



            <case pos:start="399:13" pos:end="399:42">case <expr pos:start="399:18" pos:end="399:41"><name pos:start="399:18" pos:end="399:41">TPM_TIS_STATE_COMPLETION</name></expr>:</case>

                <expr_stmt pos:start="401:17" pos:end="401:45"><expr pos:start="401:17" pos:end="401:44"><name pos:start="401:17" pos:end="401:31"><name pos:start="401:17" pos:end="401:19">tis</name><operator pos:start="401:20" pos:end="401:21">-&gt;</operator><name pos:start="401:22" pos:end="401:24">loc</name><index pos:start="401:25" pos:end="401:31">[<expr pos:start="401:26" pos:end="401:30"><name pos:start="401:26" pos:end="401:30">locty</name></expr>]</index></name><operator pos:start="401:32" pos:end="401:32">.</operator><name pos:start="401:33" pos:end="401:40">w_offset</name> <operator pos:start="401:42" pos:end="401:42">=</operator> <literal type="number" pos:start="401:44" pos:end="401:44">0</literal></expr>;</expr_stmt>

                <expr_stmt pos:start="403:17" pos:end="403:45"><expr pos:start="403:17" pos:end="403:44"><name pos:start="403:17" pos:end="403:31"><name pos:start="403:17" pos:end="403:19">tis</name><operator pos:start="403:20" pos:end="403:21">-&gt;</operator><name pos:start="403:22" pos:end="403:24">loc</name><index pos:start="403:25" pos:end="403:31">[<expr pos:start="403:26" pos:end="403:30"><name pos:start="403:26" pos:end="403:30">locty</name></expr>]</index></name><operator pos:start="403:32" pos:end="403:32">.</operator><name pos:start="403:33" pos:end="403:40">r_offset</name> <operator pos:start="403:42" pos:end="403:42">=</operator> <literal type="number" pos:start="403:44" pos:end="403:44">0</literal></expr>;</expr_stmt>

                <comment type="block" pos:start="405:17" pos:end="405:58">/* shortcut to ready state with C/R set */</comment>

                <expr_stmt pos:start="407:17" pos:end="407:60"><expr pos:start="407:17" pos:end="407:59"><name pos:start="407:17" pos:end="407:31"><name pos:start="407:17" pos:end="407:19">tis</name><operator pos:start="407:20" pos:end="407:21">-&gt;</operator><name pos:start="407:22" pos:end="407:24">loc</name><index pos:start="407:25" pos:end="407:31">[<expr pos:start="407:26" pos:end="407:30"><name pos:start="407:26" pos:end="407:30">locty</name></expr>]</index></name><operator pos:start="407:32" pos:end="407:32">.</operator><name pos:start="407:33" pos:end="407:37">state</name> <operator pos:start="407:39" pos:end="407:39">=</operator> <name pos:start="407:41" pos:end="407:59">TPM_TIS_STATE_READY</name></expr>;</expr_stmt>

                <if_stmt pos:start="409:17" pos:end="415:17"><if pos:start="409:17" pos:end="415:17">if <condition pos:start="409:20" pos:end="409:71">(<expr pos:start="409:21" pos:end="409:70"><operator pos:start="409:21" pos:end="409:21">!</operator><operator pos:start="409:22" pos:end="409:22">(</operator><name pos:start="409:23" pos:end="409:37"><name pos:start="409:23" pos:end="409:25">tis</name><operator pos:start="409:26" pos:end="409:27">-&gt;</operator><name pos:start="409:28" pos:end="409:30">loc</name><index pos:start="409:31" pos:end="409:37">[<expr pos:start="409:32" pos:end="409:36"><name pos:start="409:32" pos:end="409:36">locty</name></expr>]</index></name><operator pos:start="409:38" pos:end="409:38">.</operator><name pos:start="409:39" pos:end="409:41">sts</name> <operator pos:start="409:43" pos:end="409:43">&amp;</operator> <name pos:start="409:45" pos:end="409:69">TPM_TIS_STS_COMMAND_READY</name><operator pos:start="409:70" pos:end="409:70">)</operator></expr>)</condition> <block pos:start="409:73" pos:end="415:17">{<block_content pos:start="411:21" pos:end="413:75">

                    <expr_stmt pos:start="411:21" pos:end="411:70"><expr pos:start="411:21" pos:end="411:69"><name pos:start="411:21" pos:end="411:35"><name pos:start="411:21" pos:end="411:23">tis</name><operator pos:start="411:24" pos:end="411:25">-&gt;</operator><name pos:start="411:26" pos:end="411:28">loc</name><index pos:start="411:29" pos:end="411:35">[<expr pos:start="411:30" pos:end="411:34"><name pos:start="411:30" pos:end="411:34">locty</name></expr>]</index></name><operator pos:start="411:36" pos:end="411:36">.</operator><name pos:start="411:37" pos:end="411:39">sts</name>   <operator pos:start="411:43" pos:end="411:43">=</operator> <name pos:start="411:45" pos:end="411:69">TPM_TIS_STS_COMMAND_READY</name></expr>;</expr_stmt>

                    <expr_stmt pos:start="413:21" pos:end="413:75"><expr pos:start="413:21" pos:end="413:74"><call pos:start="413:21" pos:end="413:74"><name pos:start="413:21" pos:end="413:37">tpm_tis_raise_irq</name><argument_list pos:start="413:38" pos:end="413:74">(<argument pos:start="413:39" pos:end="413:39"><expr pos:start="413:39" pos:end="413:39"><name pos:start="413:39" pos:end="413:39">s</name></expr></argument>, <argument pos:start="413:42" pos:end="413:46"><expr pos:start="413:42" pos:end="413:46"><name pos:start="413:42" pos:end="413:46">locty</name></expr></argument>, <argument pos:start="413:49" pos:end="413:73"><expr pos:start="413:49" pos:end="413:73"><name pos:start="413:49" pos:end="413:73">TPM_TIS_INT_COMMAND_READY</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                </block_content>}</block></if></if_stmt>

                <expr_stmt pos:start="417:17" pos:end="417:69"><expr pos:start="417:17" pos:end="417:68"><name pos:start="417:17" pos:end="417:31"><name pos:start="417:17" pos:end="417:19">tis</name><operator pos:start="417:20" pos:end="417:21">-&gt;</operator><name pos:start="417:22" pos:end="417:24">loc</name><index pos:start="417:25" pos:end="417:31">[<expr pos:start="417:26" pos:end="417:30"><name pos:start="417:26" pos:end="417:30">locty</name></expr>]</index></name><operator pos:start="417:32" pos:end="417:32">.</operator><name pos:start="417:33" pos:end="417:35">sts</name> <operator pos:start="417:37" pos:end="417:38">&amp;=</operator> <operator pos:start="417:40" pos:end="417:40">~</operator><operator pos:start="417:41" pos:end="417:41">(</operator><name pos:start="417:42" pos:end="417:67">TPM_TIS_STS_DATA_AVAILABLE</name><operator pos:start="417:68" pos:end="417:68">)</operator></expr>;</expr_stmt>

            <break pos:start="419:13" pos:end="419:18">break;</break>



            </block_content>}</block></switch>

        </block_content>}</block></if> <if type="elseif" pos:start="425:11" pos:end="447:9">else if <condition pos:start="425:19" pos:end="425:45">(<expr pos:start="425:20" pos:end="425:44"><name pos:start="425:20" pos:end="425:22">val</name> <operator pos:start="425:24" pos:end="425:25">==</operator> <name pos:start="425:27" pos:end="425:44">TPM_TIS_STS_TPM_GO</name></expr>)</condition> <block pos:start="425:47" pos:end="447:9">{<block_content pos:start="427:13" pos:end="445:13">

            <switch pos:start="427:13" pos:end="445:13">switch <condition pos:start="427:20" pos:end="427:42">(<expr pos:start="427:21" pos:end="427:41"><name pos:start="427:21" pos:end="427:35"><name pos:start="427:21" pos:end="427:23">tis</name><operator pos:start="427:24" pos:end="427:25">-&gt;</operator><name pos:start="427:26" pos:end="427:28">loc</name><index pos:start="427:29" pos:end="427:35">[<expr pos:start="427:30" pos:end="427:34"><name pos:start="427:30" pos:end="427:34">locty</name></expr>]</index></name><operator pos:start="427:36" pos:end="427:36">.</operator><name pos:start="427:37" pos:end="427:41">state</name></expr>)</condition> <block pos:start="427:44" pos:end="445:13">{<block_content pos:start="429:13" pos:end="443:22">

            <case pos:start="429:13" pos:end="429:41">case <expr pos:start="429:18" pos:end="429:40"><name pos:start="429:18" pos:end="429:40">TPM_TIS_STATE_RECEPTION</name></expr>:</case>

                <if_stmt pos:start="431:17" pos:end="435:17"><if pos:start="431:17" pos:end="435:17">if <condition pos:start="431:20" pos:end="431:68">(<expr pos:start="431:21" pos:end="431:67"><operator pos:start="431:21" pos:end="431:21">(</operator><name pos:start="431:22" pos:end="431:36"><name pos:start="431:22" pos:end="431:24">tis</name><operator pos:start="431:25" pos:end="431:26">-&gt;</operator><name pos:start="431:27" pos:end="431:29">loc</name><index pos:start="431:30" pos:end="431:36">[<expr pos:start="431:31" pos:end="431:35"><name pos:start="431:31" pos:end="431:35">locty</name></expr>]</index></name><operator pos:start="431:37" pos:end="431:37">.</operator><name pos:start="431:38" pos:end="431:40">sts</name> <operator pos:start="431:42" pos:end="431:42">&amp;</operator> <name pos:start="431:44" pos:end="431:61">TPM_TIS_STS_EXPECT</name><operator pos:start="431:62" pos:end="431:62">)</operator> <operator pos:start="431:64" pos:end="431:65">==</operator> <literal type="number" pos:start="431:67" pos:end="431:67">0</literal></expr>)</condition> <block pos:start="431:70" pos:end="435:17">{<block_content pos:start="433:21" pos:end="433:47">

                    <expr_stmt pos:start="433:21" pos:end="433:47"><expr pos:start="433:21" pos:end="433:46"><call pos:start="433:21" pos:end="433:46"><name pos:start="433:21" pos:end="433:36">tpm_tis_tpm_send</name><argument_list pos:start="433:37" pos:end="433:46">(<argument pos:start="433:38" pos:end="433:38"><expr pos:start="433:38" pos:end="433:38"><name pos:start="433:38" pos:end="433:38">s</name></expr></argument>, <argument pos:start="433:41" pos:end="433:45"><expr pos:start="433:41" pos:end="433:45"><name pos:start="433:41" pos:end="433:45">locty</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                </block_content>}</block></if></if_stmt>

                <break pos:start="437:17" pos:end="437:22">break;</break>

            <default pos:start="439:13" pos:end="439:20">default:</default>

                <comment type="block" pos:start="441:17" pos:end="441:28">/* ignore */</comment>

                <break pos:start="443:17" pos:end="443:22">break;</break>

            </block_content>}</block></switch>

        </block_content>}</block></if> <if type="elseif" pos:start="447:11" pos:end="469:9">else if <condition pos:start="447:19" pos:end="447:53">(<expr pos:start="447:20" pos:end="447:52"><name pos:start="447:20" pos:end="447:22">val</name> <operator pos:start="447:24" pos:end="447:25">==</operator> <name pos:start="447:27" pos:end="447:52">TPM_TIS_STS_RESPONSE_RETRY</name></expr>)</condition> <block pos:start="447:55" pos:end="469:9">{<block_content pos:start="449:13" pos:end="467:13">

            <switch pos:start="449:13" pos:end="467:13">switch <condition pos:start="449:20" pos:end="449:42">(<expr pos:start="449:21" pos:end="449:41"><name pos:start="449:21" pos:end="449:35"><name pos:start="449:21" pos:end="449:23">tis</name><operator pos:start="449:24" pos:end="449:25">-&gt;</operator><name pos:start="449:26" pos:end="449:28">loc</name><index pos:start="449:29" pos:end="449:35">[<expr pos:start="449:30" pos:end="449:34"><name pos:start="449:30" pos:end="449:34">locty</name></expr>]</index></name><operator pos:start="449:36" pos:end="449:36">.</operator><name pos:start="449:37" pos:end="449:41">state</name></expr>)</condition> <block pos:start="449:44" pos:end="467:13">{<block_content pos:start="451:13" pos:end="465:22">

            <case pos:start="451:13" pos:end="451:42">case <expr pos:start="451:18" pos:end="451:41"><name pos:start="451:18" pos:end="451:41">TPM_TIS_STATE_COMPLETION</name></expr>:</case>

                <expr_stmt pos:start="453:17" pos:end="453:45"><expr pos:start="453:17" pos:end="453:44"><name pos:start="453:17" pos:end="453:31"><name pos:start="453:17" pos:end="453:19">tis</name><operator pos:start="453:20" pos:end="453:21">-&gt;</operator><name pos:start="453:22" pos:end="453:24">loc</name><index pos:start="453:25" pos:end="453:31">[<expr pos:start="453:26" pos:end="453:30"><name pos:start="453:26" pos:end="453:30">locty</name></expr>]</index></name><operator pos:start="453:32" pos:end="453:32">.</operator><name pos:start="453:33" pos:end="453:40">r_offset</name> <operator pos:start="453:42" pos:end="453:42">=</operator> <literal type="number" pos:start="453:44" pos:end="453:44">0</literal></expr>;</expr_stmt>

                <expr_stmt pos:start="455:17" pos:end="457:65"><expr pos:start="455:17" pos:end="457:64"><name pos:start="455:17" pos:end="455:31"><name pos:start="455:17" pos:end="455:19">tis</name><operator pos:start="455:20" pos:end="455:21">-&gt;</operator><name pos:start="455:22" pos:end="455:24">loc</name><index pos:start="455:25" pos:end="455:31">[<expr pos:start="455:26" pos:end="455:30"><name pos:start="455:26" pos:end="455:30">locty</name></expr>]</index></name><operator pos:start="455:32" pos:end="455:32">.</operator><name pos:start="455:33" pos:end="455:35">sts</name> <operator pos:start="455:37" pos:end="455:37">=</operator> <name pos:start="455:39" pos:end="455:55">TPM_TIS_STS_VALID</name> <operator pos:start="455:57" pos:end="455:57">|</operator>

                                      <name pos:start="457:39" pos:end="457:64">TPM_TIS_STS_DATA_AVAILABLE</name></expr>;</expr_stmt>

                <break pos:start="459:17" pos:end="459:22">break;</break>

            <default pos:start="461:13" pos:end="461:20">default:</default>

                <comment type="block" pos:start="463:17" pos:end="463:28">/* ignore */</comment>

                <break pos:start="465:17" pos:end="465:22">break;</break>

            </block_content>}</block></switch>

        </block_content>}</block></if></if_stmt>

        <break pos:start="471:9" pos:end="471:14">break;</break>

    <case pos:start="473:5" pos:end="473:31">case <expr pos:start="473:10" pos:end="473:30"><name pos:start="473:10" pos:end="473:30">TPM_TIS_REG_DATA_FIFO</name></expr>:</case>

    <case pos:start="475:5" pos:end="475:63">case <expr pos:start="475:10" pos:end="475:62"><name pos:start="475:10" pos:end="475:31">TPM_TIS_REG_DATA_XFIFO</name> <operator pos:start="475:33" pos:end="475:35">...</operator> <name pos:start="475:37" pos:end="475:62">TPM_TIS_REG_DATA_XFIFO_END</name></expr>:</case>

        <comment type="block" pos:start="477:9" pos:end="477:23">/* data fifo */</comment>

        <if_stmt pos:start="479:9" pos:end="483:9"><if pos:start="479:9" pos:end="483:9">if <condition pos:start="479:12" pos:end="479:39">(<expr pos:start="479:13" pos:end="479:38"><name pos:start="479:13" pos:end="479:29"><name pos:start="479:13" pos:end="479:15">tis</name><operator pos:start="479:16" pos:end="479:17">-&gt;</operator><name pos:start="479:18" pos:end="479:29">active_locty</name></name> <operator pos:start="479:31" pos:end="479:32">!=</operator> <name pos:start="479:34" pos:end="479:38">locty</name></expr>)</condition> <block pos:start="479:41" pos:end="483:9">{<block_content pos:start="481:13" pos:end="481:18">

            <break pos:start="481:13" pos:end="481:18">break;</break>

        </block_content>}</block></if></if_stmt>



        <if_stmt pos:start="487:9" pos:end="587:9"><if pos:start="487:9" pos:end="495:9">if <condition pos:start="487:12" pos:end="491:62">(<expr pos:start="487:13" pos:end="491:61"><name pos:start="487:13" pos:end="487:27"><name pos:start="487:13" pos:end="487:15">tis</name><operator pos:start="487:16" pos:end="487:17">-&gt;</operator><name pos:start="487:18" pos:end="487:20">loc</name><index pos:start="487:21" pos:end="487:27">[<expr pos:start="487:22" pos:end="487:26"><name pos:start="487:22" pos:end="487:26">locty</name></expr>]</index></name><operator pos:start="487:28" pos:end="487:28">.</operator><name pos:start="487:29" pos:end="487:33">state</name> <operator pos:start="487:35" pos:end="487:36">==</operator> <name pos:start="487:38" pos:end="487:55">TPM_TIS_STATE_IDLE</name> <operator pos:start="487:57" pos:end="487:58">||</operator>

            <name pos:start="489:13" pos:end="489:27"><name pos:start="489:13" pos:end="489:15">tis</name><operator pos:start="489:16" pos:end="489:17">-&gt;</operator><name pos:start="489:18" pos:end="489:20">loc</name><index pos:start="489:21" pos:end="489:27">[<expr pos:start="489:22" pos:end="489:26"><name pos:start="489:22" pos:end="489:26">locty</name></expr>]</index></name><operator pos:start="489:28" pos:end="489:28">.</operator><name pos:start="489:29" pos:end="489:33">state</name> <operator pos:start="489:35" pos:end="489:36">==</operator> <name pos:start="489:38" pos:end="489:60">TPM_TIS_STATE_EXECUTION</name> <operator pos:start="489:62" pos:end="489:63">||</operator>

            <name pos:start="491:13" pos:end="491:27"><name pos:start="491:13" pos:end="491:15">tis</name><operator pos:start="491:16" pos:end="491:17">-&gt;</operator><name pos:start="491:18" pos:end="491:20">loc</name><index pos:start="491:21" pos:end="491:27">[<expr pos:start="491:22" pos:end="491:26"><name pos:start="491:22" pos:end="491:26">locty</name></expr>]</index></name><operator pos:start="491:28" pos:end="491:28">.</operator><name pos:start="491:29" pos:end="491:33">state</name> <operator pos:start="491:35" pos:end="491:36">==</operator> <name pos:start="491:38" pos:end="491:61">TPM_TIS_STATE_COMPLETION</name></expr>)</condition> <block pos:start="491:64" pos:end="495:9">{<block_content>

            <comment type="block" pos:start="493:13" pos:end="493:31">/* drop the byte */</comment>

        </block_content>}</block></if> <else pos:start="495:11" pos:end="587:9">else <block pos:start="495:16" pos:end="587:9">{<block_content pos:start="497:13" pos:end="585:13">

            <expr_stmt pos:start="497:13" pos:end="499:31"><expr pos:start="497:13" pos:end="499:30"><call pos:start="497:13" pos:end="499:30"><name pos:start="497:13" pos:end="497:19">DPRINTF</name><argument_list pos:start="497:20" pos:end="499:30">(<argument pos:start="497:21" pos:end="497:68"><expr pos:start="497:21" pos:end="497:68"><literal type="string" pos:start="497:21" pos:end="497:68">"tpm_tis: Data to send to TPM: %08x (size=%d)\n"</literal></expr></argument>,

                    <argument pos:start="499:21" pos:end="499:23"><expr pos:start="499:21" pos:end="499:23"><name pos:start="499:21" pos:end="499:23">val</name></expr></argument>, <argument pos:start="499:26" pos:end="499:29"><expr pos:start="499:26" pos:end="499:29"><name pos:start="499:26" pos:end="499:29">size</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <if_stmt pos:start="501:13" pos:end="507:13"><if pos:start="501:13" pos:end="507:13">if <condition pos:start="501:16" pos:end="501:61">(<expr pos:start="501:17" pos:end="501:60"><name pos:start="501:17" pos:end="501:31"><name pos:start="501:17" pos:end="501:19">tis</name><operator pos:start="501:20" pos:end="501:21">-&gt;</operator><name pos:start="501:22" pos:end="501:24">loc</name><index pos:start="501:25" pos:end="501:31">[<expr pos:start="501:26" pos:end="501:30"><name pos:start="501:26" pos:end="501:30">locty</name></expr>]</index></name><operator pos:start="501:32" pos:end="501:32">.</operator><name pos:start="501:33" pos:end="501:37">state</name> <operator pos:start="501:39" pos:end="501:40">==</operator> <name pos:start="501:42" pos:end="501:60">TPM_TIS_STATE_READY</name></expr>)</condition> <block pos:start="501:63" pos:end="507:13">{<block_content pos:start="503:17" pos:end="505:77">

                <expr_stmt pos:start="503:17" pos:end="503:64"><expr pos:start="503:17" pos:end="503:63"><name pos:start="503:17" pos:end="503:31"><name pos:start="503:17" pos:end="503:19">tis</name><operator pos:start="503:20" pos:end="503:21">-&gt;</operator><name pos:start="503:22" pos:end="503:24">loc</name><index pos:start="503:25" pos:end="503:31">[<expr pos:start="503:26" pos:end="503:30"><name pos:start="503:26" pos:end="503:30">locty</name></expr>]</index></name><operator pos:start="503:32" pos:end="503:32">.</operator><name pos:start="503:33" pos:end="503:37">state</name> <operator pos:start="503:39" pos:end="503:39">=</operator> <name pos:start="503:41" pos:end="503:63">TPM_TIS_STATE_RECEPTION</name></expr>;</expr_stmt>

                <expr_stmt pos:start="505:17" pos:end="505:77"><expr pos:start="505:17" pos:end="505:76"><name pos:start="505:17" pos:end="505:31"><name pos:start="505:17" pos:end="505:19">tis</name><operator pos:start="505:20" pos:end="505:21">-&gt;</operator><name pos:start="505:22" pos:end="505:24">loc</name><index pos:start="505:25" pos:end="505:31">[<expr pos:start="505:26" pos:end="505:30"><name pos:start="505:26" pos:end="505:30">locty</name></expr>]</index></name><operator pos:start="505:32" pos:end="505:32">.</operator><name pos:start="505:33" pos:end="505:35">sts</name> <operator pos:start="505:37" pos:end="505:37">=</operator> <name pos:start="505:39" pos:end="505:56">TPM_TIS_STS_EXPECT</name> <operator pos:start="505:58" pos:end="505:58">|</operator> <name pos:start="505:60" pos:end="505:76">TPM_TIS_STS_VALID</name></expr>;</expr_stmt>

            </block_content>}</block></if></if_stmt>



            <expr_stmt pos:start="511:13" pos:end="511:26"><expr pos:start="511:13" pos:end="511:25"><name pos:start="511:13" pos:end="511:15">val</name> <operator pos:start="511:17" pos:end="511:19">&gt;&gt;=</operator> <name pos:start="511:21" pos:end="511:25">shift</name></expr>;</expr_stmt>

            <if_stmt pos:start="513:13" pos:end="519:13"><if pos:start="513:13" pos:end="519:13">if <condition pos:start="513:16" pos:end="513:40">(<expr pos:start="513:17" pos:end="513:39"><name pos:start="513:17" pos:end="513:20">size</name> <operator pos:start="513:22" pos:end="513:22">&gt;</operator> <literal type="number" pos:start="513:24" pos:end="513:26">4</literal> <operator pos:start="513:26" pos:end="513:26">-</operator> <operator pos:start="513:28" pos:end="513:28">(</operator><name pos:start="513:29" pos:end="513:32">addr</name> <operator pos:start="513:34" pos:end="513:34">&amp;</operator> <literal type="number" pos:start="513:36" pos:end="513:38">0x3</literal><operator pos:start="513:39" pos:end="513:39">)</operator></expr>)</condition> <block pos:start="513:42" pos:end="519:13">{<block_content pos:start="517:17" pos:end="517:40">

                <comment type="block" pos:start="515:17" pos:end="515:48">/* prevent access beyond FIFO */</comment>

                <expr_stmt pos:start="517:17" pos:end="517:40"><expr pos:start="517:17" pos:end="517:39"><name pos:start="517:17" pos:end="517:20">size</name> <operator pos:start="517:22" pos:end="517:22">=</operator> <literal type="number" pos:start="517:24" pos:end="517:26">4</literal> <operator pos:start="517:26" pos:end="517:26">-</operator> <operator pos:start="517:28" pos:end="517:28">(</operator><name pos:start="517:29" pos:end="517:32">addr</name> <operator pos:start="517:34" pos:end="517:34">&amp;</operator> <literal type="number" pos:start="517:36" pos:end="517:38">0x3</literal><operator pos:start="517:39" pos:end="517:39">)</operator></expr>;</expr_stmt>

            </block_content>}</block></if></if_stmt>



            <while pos:start="523:13" pos:end="541:13">while <condition pos:start="523:19" pos:end="523:74">(<expr pos:start="523:20" pos:end="523:73"><operator pos:start="523:20" pos:end="523:20">(</operator><name pos:start="523:21" pos:end="523:35"><name pos:start="523:21" pos:end="523:23">tis</name><operator pos:start="523:24" pos:end="523:25">-&gt;</operator><name pos:start="523:26" pos:end="523:28">loc</name><index pos:start="523:29" pos:end="523:35">[<expr pos:start="523:30" pos:end="523:34"><name pos:start="523:30" pos:end="523:34">locty</name></expr>]</index></name><operator pos:start="523:36" pos:end="523:36">.</operator><name pos:start="523:37" pos:end="523:39">sts</name> <operator pos:start="523:41" pos:end="523:41">&amp;</operator> <name pos:start="523:43" pos:end="523:60">TPM_TIS_STS_EXPECT</name><operator pos:start="523:61" pos:end="523:61">)</operator> <operator pos:start="523:63" pos:end="523:64">&amp;&amp;</operator> <name pos:start="523:66" pos:end="523:69">size</name> <operator pos:start="523:71" pos:end="523:71">&gt;</operator> <literal type="number" pos:start="523:73" pos:end="523:73">0</literal></expr>)</condition> <block pos:start="523:76" pos:end="541:13">{<block_content pos:start="525:17" pos:end="539:17">

                <if_stmt pos:start="525:17" pos:end="539:17"><if pos:start="525:17" pos:end="535:17">if <condition pos:start="525:20" pos:end="525:77">(<expr pos:start="525:21" pos:end="525:76"><name pos:start="525:21" pos:end="525:35"><name pos:start="525:21" pos:end="525:23">tis</name><operator pos:start="525:24" pos:end="525:25">-&gt;</operator><name pos:start="525:26" pos:end="525:28">loc</name><index pos:start="525:29" pos:end="525:35">[<expr pos:start="525:30" pos:end="525:34"><name pos:start="525:30" pos:end="525:34">locty</name></expr>]</index></name><operator pos:start="525:36" pos:end="525:36">.</operator><name pos:start="525:37" pos:end="525:44">w_offset</name> <operator pos:start="525:46" pos:end="525:46">&lt;</operator> <name pos:start="525:48" pos:end="525:62"><name pos:start="525:48" pos:end="525:50">tis</name><operator pos:start="525:51" pos:end="525:52">-&gt;</operator><name pos:start="525:53" pos:end="525:55">loc</name><index pos:start="525:56" pos:end="525:62">[<expr pos:start="525:57" pos:end="525:61"><name pos:start="525:57" pos:end="525:61">locty</name></expr>]</index></name><operator pos:start="525:63" pos:end="525:63">.</operator><name pos:start="525:64" pos:end="525:76"><name pos:start="525:64" pos:end="525:71">w_buffer</name><operator pos:start="525:72" pos:end="525:72">.</operator><name pos:start="525:73" pos:end="525:76">size</name></name></expr>)</condition> <block pos:start="525:79" pos:end="535:17">{<block_content pos:start="527:21" pos:end="533:27">

                    <expr_stmt pos:start="527:21" pos:end="529:74"><expr pos:start="527:21" pos:end="529:73"><name pos:start="527:21" pos:end="527:35"><name pos:start="527:21" pos:end="527:23">tis</name><operator pos:start="527:24" pos:end="527:25">-&gt;</operator><name pos:start="527:26" pos:end="527:28">loc</name><index pos:start="527:29" pos:end="527:35">[<expr pos:start="527:30" pos:end="527:34"><name pos:start="527:30" pos:end="527:34">locty</name></expr>]</index></name><operator pos:start="527:36" pos:end="527:36">.</operator><name pos:start="527:37" pos:end="529:58"><name pos:start="527:37" pos:end="527:44">w_buffer</name><operator pos:start="527:45" pos:end="527:45">.</operator>

                        <name pos:start="529:25" pos:end="529:30">buffer</name><index pos:start="529:31" pos:end="529:58">[<expr pos:start="529:32" pos:end="529:57"><name pos:start="529:32" pos:end="529:46"><name pos:start="529:32" pos:end="529:34">tis</name><operator pos:start="529:35" pos:end="529:36">-&gt;</operator><name pos:start="529:37" pos:end="529:39">loc</name><index pos:start="529:40" pos:end="529:46">[<expr pos:start="529:41" pos:end="529:45"><name pos:start="529:41" pos:end="529:45">locty</name></expr>]</index></name><operator pos:start="529:47" pos:end="529:47">.</operator><name pos:start="529:48" pos:end="529:55">w_offset</name><operator pos:start="529:56" pos:end="529:57">++</operator></expr>]</index></name> <operator pos:start="529:60" pos:end="529:60">=</operator> <operator pos:start="529:62" pos:end="529:62">(</operator><name pos:start="529:63" pos:end="529:69">uint8_t</name><operator pos:start="529:70" pos:end="529:70">)</operator><name pos:start="529:71" pos:end="529:73">val</name></expr>;</expr_stmt>

                    <expr_stmt pos:start="531:21" pos:end="531:30"><expr pos:start="531:21" pos:end="531:29"><name pos:start="531:21" pos:end="531:23">val</name> <operator pos:start="531:25" pos:end="531:27">&gt;&gt;=</operator> <literal type="number" pos:start="531:29" pos:end="531:29">8</literal></expr>;</expr_stmt>

                    <expr_stmt pos:start="533:21" pos:end="533:27"><expr pos:start="533:21" pos:end="533:26"><name pos:start="533:21" pos:end="533:24">size</name><operator pos:start="533:25" pos:end="533:26">--</operator></expr>;</expr_stmt>

                </block_content>}</block></if> <else pos:start="535:19" pos:end="539:17">else <block pos:start="535:24" pos:end="539:17">{<block_content pos:start="537:21" pos:end="537:60">

                    <expr_stmt pos:start="537:21" pos:end="537:60"><expr pos:start="537:21" pos:end="537:59"><name pos:start="537:21" pos:end="537:35"><name pos:start="537:21" pos:end="537:23">tis</name><operator pos:start="537:24" pos:end="537:25">-&gt;</operator><name pos:start="537:26" pos:end="537:28">loc</name><index pos:start="537:29" pos:end="537:35">[<expr pos:start="537:30" pos:end="537:34"><name pos:start="537:30" pos:end="537:34">locty</name></expr>]</index></name><operator pos:start="537:36" pos:end="537:36">.</operator><name pos:start="537:37" pos:end="537:39">sts</name> <operator pos:start="537:41" pos:end="537:41">=</operator> <name pos:start="537:43" pos:end="537:59">TPM_TIS_STS_VALID</name></expr>;</expr_stmt>

                </block_content>}</block></else></if_stmt>

            </block_content>}</block></while>



            <comment type="block" pos:start="545:13" pos:end="545:43">/* check for complete packet */</comment>

            <if_stmt pos:start="547:13" pos:end="585:13"><if pos:start="547:13" pos:end="585:13">if <condition pos:start="547:16" pos:end="549:59">(<expr pos:start="547:17" pos:end="549:58"><name pos:start="547:17" pos:end="547:31"><name pos:start="547:17" pos:end="547:19">tis</name><operator pos:start="547:20" pos:end="547:21">-&gt;</operator><name pos:start="547:22" pos:end="547:24">loc</name><index pos:start="547:25" pos:end="547:31">[<expr pos:start="547:26" pos:end="547:30"><name pos:start="547:26" pos:end="547:30">locty</name></expr>]</index></name><operator pos:start="547:32" pos:end="547:32">.</operator><name pos:start="547:33" pos:end="547:40">w_offset</name> <operator pos:start="547:42" pos:end="547:42">&gt;</operator> <literal type="number" pos:start="547:44" pos:end="547:44">5</literal> <operator pos:start="547:46" pos:end="547:47">&amp;&amp;</operator>

                <operator pos:start="549:17" pos:end="549:17">(</operator><name pos:start="549:18" pos:end="549:32"><name pos:start="549:18" pos:end="549:20">tis</name><operator pos:start="549:21" pos:end="549:22">-&gt;</operator><name pos:start="549:23" pos:end="549:25">loc</name><index pos:start="549:26" pos:end="549:32">[<expr pos:start="549:27" pos:end="549:31"><name pos:start="549:27" pos:end="549:31">locty</name></expr>]</index></name><operator pos:start="549:33" pos:end="549:33">.</operator><name pos:start="549:34" pos:end="549:36">sts</name> <operator pos:start="549:38" pos:end="549:38">&amp;</operator> <name pos:start="549:40" pos:end="549:57">TPM_TIS_STS_EXPECT</name><operator pos:start="549:58" pos:end="549:58">)</operator></expr>)</condition> <block pos:start="549:61" pos:end="585:13">{<block_content pos:start="555:17" pos:end="584:0">

                <comment type="block" pos:start="551:17" pos:end="551:72">/* we have a packet length - see if we have all of it */</comment>

<cpp:ifdef pos:start="553:1" pos:end="553:20">#<cpp:directive pos:start="553:2" pos:end="553:6">ifdef</cpp:directive> <name pos:start="553:8" pos:end="553:20">RAISE_STS_IRQ</name></cpp:ifdef>

                <decl_stmt pos:start="555:17" pos:end="558:0"><decl pos:start="555:17" pos:end="555:73"><type pos:start="555:17" pos:end="555:20"><name pos:start="555:17" pos:end="555:20">bool</name></type> <name pos:start="555:22" pos:end="555:28">needIrq</name> <init pos:start="555:30" pos:end="555:73">= <expr pos:start="555:32" pos:end="555:73"><operator pos:start="555:32" pos:end="555:32">!</operator><operator pos:start="555:33" pos:end="555:33">(</operator><name pos:start="555:34" pos:end="555:48"><name pos:start="555:34" pos:end="555:36">tis</name><operator pos:start="555:37" pos:end="555:38">-&gt;</operator><name pos:start="555:39" pos:end="555:41">loc</name><index pos:start="555:42" pos:end="555:48">[<expr pos:start="555:43" pos:end="555:47"><name pos:start="555:43" pos:end="555:47">locty</name></expr>]</index></name><operator pos:start="555:49" pos:end="555:49">.</operator><name pos:start="555:50" pos:end="555:52">sts</name> <operator pos:start="555:54" pos:end="555:54">&amp;</operator> <name pos:start="555:56" pos:end="555:72">TPM_TIS_STS_VALID</name><operator pos:start="555:73" pos:end="555:73">)</operator></expr></init></decl>;</decl_stmt>

<cpp:endif pos:start="557:1" pos:end="557:6">#<cpp:directive pos:start="557:2" pos:end="557:6">endif</cpp:directive></cpp:endif>

                <expr_stmt pos:start="559:17" pos:end="559:78"><expr pos:start="559:17" pos:end="559:77"><name pos:start="559:17" pos:end="559:19">len</name> <operator pos:start="559:21" pos:end="559:21">=</operator> <call pos:start="559:23" pos:end="559:77"><name pos:start="559:23" pos:end="559:50">tpm_tis_get_size_from_buffer</name><argument_list pos:start="559:51" pos:end="559:77">(<argument pos:start="559:52" pos:end="559:76"><expr pos:start="559:52" pos:end="559:76"><operator pos:start="559:52" pos:end="559:52">&amp;</operator><name pos:start="559:53" pos:end="559:67"><name pos:start="559:53" pos:end="559:55">tis</name><operator pos:start="559:56" pos:end="559:57">-&gt;</operator><name pos:start="559:58" pos:end="559:60">loc</name><index pos:start="559:61" pos:end="559:67">[<expr pos:start="559:62" pos:end="559:66"><name pos:start="559:62" pos:end="559:66">locty</name></expr>]</index></name><operator pos:start="559:68" pos:end="559:68">.</operator><name pos:start="559:69" pos:end="559:76">w_buffer</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <if_stmt pos:start="561:17" pos:end="576:0"><if pos:start="561:17" pos:end="567:17">if <condition pos:start="561:20" pos:end="561:51">(<expr pos:start="561:21" pos:end="561:50"><name pos:start="561:21" pos:end="561:23">len</name> <operator pos:start="561:25" pos:end="561:25">&gt;</operator> <name pos:start="561:27" pos:end="561:41"><name pos:start="561:27" pos:end="561:29">tis</name><operator pos:start="561:30" pos:end="561:31">-&gt;</operator><name pos:start="561:32" pos:end="561:34">loc</name><index pos:start="561:35" pos:end="561:41">[<expr pos:start="561:36" pos:end="561:40"><name pos:start="561:36" pos:end="561:40">locty</name></expr>]</index></name><operator pos:start="561:42" pos:end="561:42">.</operator><name pos:start="561:43" pos:end="561:50">w_offset</name></expr>)</condition> <block pos:start="561:53" pos:end="567:17">{<block_content pos:start="563:21" pos:end="565:60">

                    <expr_stmt pos:start="563:21" pos:end="565:60"><expr pos:start="563:21" pos:end="565:59"><name pos:start="563:21" pos:end="563:35"><name pos:start="563:21" pos:end="563:23">tis</name><operator pos:start="563:24" pos:end="563:25">-&gt;</operator><name pos:start="563:26" pos:end="563:28">loc</name><index pos:start="563:29" pos:end="563:35">[<expr pos:start="563:30" pos:end="563:34"><name pos:start="563:30" pos:end="563:34">locty</name></expr>]</index></name><operator pos:start="563:36" pos:end="563:36">.</operator><name pos:start="563:37" pos:end="563:39">sts</name> <operator pos:start="563:41" pos:end="563:41">=</operator> <name pos:start="563:43" pos:end="563:60">TPM_TIS_STS_EXPECT</name> <operator pos:start="563:62" pos:end="563:62">|</operator>

                                          <name pos:start="565:43" pos:end="565:59">TPM_TIS_STS_VALID</name></expr>;</expr_stmt>

                </block_content>}</block></if> <else pos:start="567:19" pos:end="576:0">else <block pos:start="567:24" pos:end="576:0">{<block_content pos:start="571:21" pos:end="571:60">

                    <comment type="block" pos:start="569:21" pos:end="569:41">/* packet complete */</comment>

                    <expr_stmt pos:start="571:21" pos:end="571:60"><expr pos:start="571:21" pos:end="571:59"><name pos:start="571:21" pos:end="571:35"><name pos:start="571:21" pos:end="571:23">tis</name><operator pos:start="571:24" pos:end="571:25">-&gt;</operator><name pos:start="571:26" pos:end="571:28">loc</name><index pos:start="571:29" pos:end="571:35">[<expr pos:start="571:30" pos:end="571:34"><name pos:start="571:30" pos:end="571:34">locty</name></expr>]</index></name><operator pos:start="571:36" pos:end="571:36">.</operator><name pos:start="571:37" pos:end="571:39">sts</name> <operator pos:start="571:41" pos:end="571:41">=</operator> <name pos:start="571:43" pos:end="571:59">TPM_TIS_STS_VALID</name></expr>;</expr_stmt>

                </block_content>}</block></else></if_stmt>

<cpp:ifdef pos:start="575:1" pos:end="575:20">#<cpp:directive pos:start="575:2" pos:end="575:6">ifdef</cpp:directive> <name pos:start="575:8" pos:end="575:20">RAISE_STS_IRQ</name></cpp:ifdef>

                <if_stmt pos:start="577:17" pos:end="584:0"><if pos:start="577:17" pos:end="584:0">if <condition pos:start="577:20" pos:end="577:28">(<expr pos:start="577:21" pos:end="577:27"><name pos:start="577:21" pos:end="577:27">needIrq</name></expr>)</condition> <block pos:start="577:30" pos:end="584:0">{<block_content pos:start="579:21" pos:end="579:71">

                    <expr_stmt pos:start="579:21" pos:end="579:71"><expr pos:start="579:21" pos:end="579:70"><call pos:start="579:21" pos:end="579:70"><name pos:start="579:21" pos:end="579:37">tpm_tis_raise_irq</name><argument_list pos:start="579:38" pos:end="579:70">(<argument pos:start="579:39" pos:end="579:39"><expr pos:start="579:39" pos:end="579:39"><name pos:start="579:39" pos:end="579:39">s</name></expr></argument>, <argument pos:start="579:42" pos:end="579:46"><expr pos:start="579:42" pos:end="579:46"><name pos:start="579:42" pos:end="579:46">locty</name></expr></argument>, <argument pos:start="579:49" pos:end="579:69"><expr pos:start="579:49" pos:end="579:69"><name pos:start="579:49" pos:end="579:69">TPM_TIS_INT_STS_VALID</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                </block_content>}</block></if></if_stmt>

<cpp:endif pos:start="583:1" pos:end="583:6">#<cpp:directive pos:start="583:2" pos:end="583:6">endif</cpp:directive></cpp:endif>

            </block_content>}</block></if></if_stmt>

        </block_content>}</block></else></if_stmt>

        <break pos:start="589:9" pos:end="589:14">break;</break>

    </block_content>}</block></switch>

</block_content>}</block></function>
</unit>
