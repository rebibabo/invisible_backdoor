<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/1/25683.c" pos:tabs="8"><function pos:start="1:1" pos:end="93:1"><type pos:start="1:1" pos:end="1:10"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:10">int</name></type> <name pos:start="1:12" pos:end="1:27">rtp_parse_mp4_au</name><parameter_list pos:start="1:28" pos:end="1:69">(<parameter pos:start="1:29" pos:end="1:48"><decl pos:start="1:29" pos:end="1:48"><type pos:start="1:29" pos:end="1:48"><name pos:start="1:29" pos:end="1:42">PayloadContext</name> <modifier pos:start="1:44" pos:end="1:44">*</modifier></type><name pos:start="1:45" pos:end="1:48">data</name></decl></parameter>, <parameter pos:start="1:51" pos:end="1:68"><decl pos:start="1:51" pos:end="1:68"><type pos:start="1:51" pos:end="1:68"><specifier pos:start="1:51" pos:end="1:55">const</specifier> <name pos:start="1:57" pos:end="1:63">uint8_t</name> <modifier pos:start="1:65" pos:end="1:65">*</modifier></type><name pos:start="1:66" pos:end="1:68">buf</name></decl></parameter>)</parameter_list>

<block pos:start="3:1" pos:end="93:1">{<block_content pos:start="5:5" pos:end="91:13">

    <decl_stmt pos:start="5:5" pos:end="5:45"><decl pos:start="5:5" pos:end="5:25"><type pos:start="5:5" pos:end="5:7"><name pos:start="5:5" pos:end="5:7">int</name></type> <name pos:start="5:9" pos:end="5:25">au_headers_length</name></decl>, <decl pos:start="5:28" pos:end="5:41"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:28" pos:end="5:41">au_header_size</name></decl>, <decl pos:start="5:44" pos:end="5:44"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:44" pos:end="5:44">i</name></decl>;</decl_stmt>

    <decl_stmt pos:start="7:5" pos:end="7:32"><decl pos:start="7:5" pos:end="7:31"><type pos:start="7:5" pos:end="7:17"><name pos:start="7:5" pos:end="7:17">GetBitContext</name></type> <name pos:start="7:19" pos:end="7:31">getbitcontext</name></decl>;</decl_stmt>



    <comment type="block" pos:start="11:5" pos:end="13:24">/* decode the first 2 bytes where the AUHeader sections are stored

       length in bits */</comment>

    <expr_stmt pos:start="15:5" pos:end="15:37"><expr pos:start="15:5" pos:end="15:36"><name pos:start="15:5" pos:end="15:21">au_headers_length</name> <operator pos:start="15:23" pos:end="15:23">=</operator> <call pos:start="15:25" pos:end="15:36"><name pos:start="15:25" pos:end="15:31">AV_RB16</name><argument_list pos:start="15:32" pos:end="15:36">(<argument pos:start="15:33" pos:end="15:35"><expr pos:start="15:33" pos:end="15:35"><name pos:start="15:33" pos:end="15:35">buf</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <if_stmt pos:start="19:5" pos:end="21:16"><if pos:start="19:5" pos:end="21:16">if <condition pos:start="19:8" pos:end="19:50">(<expr pos:start="19:9" pos:end="19:49"><name pos:start="19:9" pos:end="19:25">au_headers_length</name> <operator pos:start="19:27" pos:end="19:27">&gt;</operator> <name pos:start="19:29" pos:end="19:49">RTP_MAX_PACKET_LENGTH</name></expr>)</condition><block type="pseudo" pos:start="21:7" pos:end="21:16"><block_content pos:start="21:7" pos:end="21:16">

      <return pos:start="21:7" pos:end="21:16">return <expr pos:start="21:14" pos:end="21:15"><operator pos:start="21:14" pos:end="21:14">-</operator><literal type="number" pos:start="21:15" pos:end="21:15">1</literal></expr>;</return></block_content></block></if></if_stmt>



    <expr_stmt pos:start="25:5" pos:end="25:64"><expr pos:start="25:5" pos:end="25:63"><name pos:start="25:5" pos:end="25:33"><name pos:start="25:5" pos:end="25:8">data</name><operator pos:start="25:9" pos:end="25:10">-&gt;</operator><name pos:start="25:11" pos:end="25:33">au_headers_length_bytes</name></name> <operator pos:start="25:35" pos:end="25:35">=</operator> <operator pos:start="25:37" pos:end="25:37">(</operator><name pos:start="25:38" pos:end="25:54">au_headers_length</name> <operator pos:start="25:56" pos:end="25:56">+</operator> <literal type="number" pos:start="25:58" pos:end="25:58">7</literal><operator pos:start="25:59" pos:end="25:59">)</operator> <operator pos:start="25:61" pos:end="25:61">/</operator> <literal type="number" pos:start="25:63" pos:end="25:63">8</literal></expr>;</expr_stmt>



    <comment type="block" pos:start="29:5" pos:end="29:50">/* skip AU headers length section (2 bytes) */</comment>

    <expr_stmt pos:start="31:5" pos:end="31:13"><expr pos:start="31:5" pos:end="31:12"><name pos:start="31:5" pos:end="31:7">buf</name> <operator pos:start="31:9" pos:end="31:10">+=</operator> <literal type="number" pos:start="31:12" pos:end="31:12">2</literal></expr>;</expr_stmt>



    <expr_stmt pos:start="35:5" pos:end="35:74"><expr pos:start="35:5" pos:end="35:73"><call pos:start="35:5" pos:end="35:73"><name pos:start="35:5" pos:end="35:17">init_get_bits</name><argument_list pos:start="35:18" pos:end="35:73">(<argument pos:start="35:19" pos:end="35:32"><expr pos:start="35:19" pos:end="35:32"><operator pos:start="35:19" pos:end="35:19">&amp;</operator><name pos:start="35:20" pos:end="35:32">getbitcontext</name></expr></argument>, <argument pos:start="35:35" pos:end="35:37"><expr pos:start="35:35" pos:end="35:37"><name pos:start="35:35" pos:end="35:37">buf</name></expr></argument>, <argument pos:start="35:40" pos:end="35:72"><expr pos:start="35:40" pos:end="35:72"><name pos:start="35:40" pos:end="35:68"><name pos:start="35:40" pos:end="35:43">data</name><operator pos:start="35:44" pos:end="35:45">-&gt;</operator><name pos:start="35:46" pos:end="35:68">au_headers_length_bytes</name></name> <operator pos:start="35:70" pos:end="35:70">*</operator> <literal type="number" pos:start="35:72" pos:end="35:72">8</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <comment type="block" pos:start="39:5" pos:end="39:83">/* XXX: Wrong if optionnal additional sections are present (cts, dts etc...) */</comment>

    <expr_stmt pos:start="41:5" pos:end="41:58"><expr pos:start="41:5" pos:end="41:57"><name pos:start="41:5" pos:end="41:18">au_header_size</name> <operator pos:start="41:20" pos:end="41:20">=</operator> <name pos:start="41:22" pos:end="41:37"><name pos:start="41:22" pos:end="41:25">data</name><operator pos:start="41:26" pos:end="41:27">-&gt;</operator><name pos:start="41:28" pos:end="41:37">sizelength</name></name> <operator pos:start="41:39" pos:end="41:39">+</operator> <name pos:start="41:41" pos:end="41:57"><name pos:start="41:41" pos:end="41:44">data</name><operator pos:start="41:45" pos:end="41:46">-&gt;</operator><name pos:start="41:47" pos:end="41:57">indexlength</name></name></expr>;</expr_stmt>

    <if_stmt pos:start="43:5" pos:end="45:18"><if pos:start="43:5" pos:end="45:18">if <condition pos:start="43:8" pos:end="43:73">(<expr pos:start="43:9" pos:end="43:72"><name pos:start="43:9" pos:end="43:22">au_header_size</name> <operator pos:start="43:24" pos:end="43:25">&lt;=</operator> <literal type="number" pos:start="43:27" pos:end="43:27">0</literal> <operator pos:start="43:29" pos:end="43:30">||</operator> <operator pos:start="43:32" pos:end="43:32">(</operator><name pos:start="43:33" pos:end="43:49">au_headers_length</name> <operator pos:start="43:51" pos:end="43:51">%</operator> <name pos:start="43:53" pos:end="43:66">au_header_size</name> <operator pos:start="43:68" pos:end="43:69">!=</operator> <literal type="number" pos:start="43:71" pos:end="43:71">0</literal><operator pos:start="43:72" pos:end="43:72">)</operator></expr>)</condition><block type="pseudo" pos:start="45:9" pos:end="45:18"><block_content pos:start="45:9" pos:end="45:18">

        <return pos:start="45:9" pos:end="45:18">return <expr pos:start="45:16" pos:end="45:17"><operator pos:start="45:16" pos:end="45:16">-</operator><literal type="number" pos:start="45:17" pos:end="45:17">1</literal></expr>;</return></block_content></block></if></if_stmt>



    <expr_stmt pos:start="49:5" pos:end="49:61"><expr pos:start="49:5" pos:end="49:60"><name pos:start="49:5" pos:end="49:23"><name pos:start="49:5" pos:end="49:8">data</name><operator pos:start="49:9" pos:end="49:10">-&gt;</operator><name pos:start="49:11" pos:end="49:23">nb_au_headers</name></name> <operator pos:start="49:25" pos:end="49:25">=</operator> <name pos:start="49:27" pos:end="49:43">au_headers_length</name> <operator pos:start="49:45" pos:end="49:45">/</operator> <name pos:start="49:47" pos:end="49:60">au_header_size</name></expr>;</expr_stmt>

    <if_stmt pos:start="51:5" pos:end="63:5"><if pos:start="51:5" pos:end="63:5">if <condition pos:start="51:8" pos:end="51:78">(<expr pos:start="51:9" pos:end="51:77"><operator pos:start="51:9" pos:end="51:9">!</operator><name pos:start="51:10" pos:end="51:25"><name pos:start="51:10" pos:end="51:13">data</name><operator pos:start="51:14" pos:end="51:15">-&gt;</operator><name pos:start="51:16" pos:end="51:25">au_headers</name></name> <operator pos:start="51:27" pos:end="51:28">||</operator> <name pos:start="51:30" pos:end="51:55"><name pos:start="51:30" pos:end="51:33">data</name><operator pos:start="51:34" pos:end="51:35">-&gt;</operator><name pos:start="51:36" pos:end="51:55">au_headers_allocated</name></name> <operator pos:start="51:57" pos:end="51:57">&lt;</operator> <name pos:start="51:59" pos:end="51:77"><name pos:start="51:59" pos:end="51:62">data</name><operator pos:start="51:63" pos:end="51:64">-&gt;</operator><name pos:start="51:65" pos:end="51:77">nb_au_headers</name></name></expr>)</condition> <block pos:start="51:80" pos:end="63:5">{<block_content pos:start="53:9" pos:end="61:57">

        <expr_stmt pos:start="53:9" pos:end="53:34"><expr pos:start="53:9" pos:end="53:33"><call pos:start="53:9" pos:end="53:33"><name pos:start="53:9" pos:end="53:15">av_free</name><argument_list pos:start="53:16" pos:end="53:33">(<argument pos:start="53:17" pos:end="53:32"><expr pos:start="53:17" pos:end="53:32"><name pos:start="53:17" pos:end="53:32"><name pos:start="53:17" pos:end="53:20">data</name><operator pos:start="53:21" pos:end="53:22">-&gt;</operator><name pos:start="53:23" pos:end="53:32">au_headers</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="55:9" pos:end="55:85"><expr pos:start="55:9" pos:end="55:84"><name pos:start="55:9" pos:end="55:24"><name pos:start="55:9" pos:end="55:12">data</name><operator pos:start="55:13" pos:end="55:14">-&gt;</operator><name pos:start="55:15" pos:end="55:24">au_headers</name></name> <operator pos:start="55:26" pos:end="55:26">=</operator> <call pos:start="55:28" pos:end="55:84"><name pos:start="55:28" pos:end="55:36">av_malloc</name><argument_list pos:start="55:37" pos:end="55:84">(<argument pos:start="55:38" pos:end="55:83"><expr pos:start="55:38" pos:end="55:83"><sizeof pos:start="55:38" pos:end="55:61">sizeof<argument_list pos:start="55:44" pos:end="55:61">(<argument pos:start="55:45" pos:end="55:60"><expr pos:start="55:45" pos:end="55:60">struct <name pos:start="55:52" pos:end="55:60">AUHeaders</name></expr></argument>)</argument_list></sizeof> <operator pos:start="55:63" pos:end="55:63">*</operator> <name pos:start="55:65" pos:end="55:83"><name pos:start="55:65" pos:end="55:68">data</name><operator pos:start="55:69" pos:end="55:70">-&gt;</operator><name pos:start="55:71" pos:end="55:83">nb_au_headers</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <if_stmt pos:start="57:9" pos:end="59:35"><if pos:start="57:9" pos:end="59:35">if <condition pos:start="57:12" pos:end="57:30">(<expr pos:start="57:13" pos:end="57:29"><operator pos:start="57:13" pos:end="57:13">!</operator><name pos:start="57:14" pos:end="57:29"><name pos:start="57:14" pos:end="57:17">data</name><operator pos:start="57:18" pos:end="57:19">-&gt;</operator><name pos:start="57:20" pos:end="57:29">au_headers</name></name></expr>)</condition><block type="pseudo" pos:start="59:13" pos:end="59:35"><block_content pos:start="59:13" pos:end="59:35">

            <return pos:start="59:13" pos:end="59:35">return <expr pos:start="59:20" pos:end="59:34"><call pos:start="59:20" pos:end="59:34"><name pos:start="59:20" pos:end="59:26">AVERROR</name><argument_list pos:start="59:27" pos:end="59:34">(<argument pos:start="59:28" pos:end="59:33"><expr pos:start="59:28" pos:end="59:33"><name pos:start="59:28" pos:end="59:33">ENOMEM</name></expr></argument>)</argument_list></call></expr>;</return></block_content></block></if></if_stmt>

        <expr_stmt pos:start="61:9" pos:end="61:57"><expr pos:start="61:9" pos:end="61:56"><name pos:start="61:9" pos:end="61:34"><name pos:start="61:9" pos:end="61:12">data</name><operator pos:start="61:13" pos:end="61:14">-&gt;</operator><name pos:start="61:15" pos:end="61:34">au_headers_allocated</name></name> <operator pos:start="61:36" pos:end="61:36">=</operator> <name pos:start="61:38" pos:end="61:56"><name pos:start="61:38" pos:end="61:41">data</name><operator pos:start="61:42" pos:end="61:43">-&gt;</operator><name pos:start="61:44" pos:end="61:56">nb_au_headers</name></name></expr>;</expr_stmt>

    </block_content>}</block></if></if_stmt>



    <comment type="block" pos:start="67:5" pos:end="71:63">/* XXX: We handle multiple AU Section as only one (need to fix this for interleaving)

       In my test, the FAAD decoder does not behave correctly when sending each AU one by one

       but does when sending the whole as one big packet...  */</comment>

    <expr_stmt pos:start="73:5" pos:end="73:33"><expr pos:start="73:5" pos:end="73:32"><name pos:start="73:5" pos:end="73:23"><name pos:start="73:5" pos:end="73:8">data</name><operator pos:start="73:9" pos:end="73:10">-&gt;</operator><name pos:start="73:11" pos:end="73:20">au_headers</name><index pos:start="73:21" pos:end="73:23">[<expr pos:start="73:22" pos:end="73:22"><literal type="number" pos:start="73:22" pos:end="73:22">0</literal></expr>]</index></name><operator pos:start="73:24" pos:end="73:24">.</operator><name pos:start="73:25" pos:end="73:28">size</name> <operator pos:start="73:30" pos:end="73:30">=</operator> <literal type="number" pos:start="73:32" pos:end="73:32">0</literal></expr>;</expr_stmt>

    <expr_stmt pos:start="75:5" pos:end="75:34"><expr pos:start="75:5" pos:end="75:33"><name pos:start="75:5" pos:end="75:23"><name pos:start="75:5" pos:end="75:8">data</name><operator pos:start="75:9" pos:end="75:10">-&gt;</operator><name pos:start="75:11" pos:end="75:20">au_headers</name><index pos:start="75:21" pos:end="75:23">[<expr pos:start="75:22" pos:end="75:22"><literal type="number" pos:start="75:22" pos:end="75:22">0</literal></expr>]</index></name><operator pos:start="75:24" pos:end="75:24">.</operator><name pos:start="75:25" pos:end="75:29">index</name> <operator pos:start="75:31" pos:end="75:31">=</operator> <literal type="number" pos:start="75:33" pos:end="75:33">0</literal></expr>;</expr_stmt>

    <for pos:start="77:5" pos:end="83:5">for <control pos:start="77:9" pos:end="77:45">(<init pos:start="77:10" pos:end="77:15"><expr pos:start="77:10" pos:end="77:14"><name pos:start="77:10" pos:end="77:10">i</name> <operator pos:start="77:12" pos:end="77:12">=</operator> <literal type="number" pos:start="77:14" pos:end="77:14">0</literal></expr>;</init> <condition pos:start="77:17" pos:end="77:40"><expr pos:start="77:17" pos:end="77:39"><name pos:start="77:17" pos:end="77:17">i</name> <operator pos:start="77:19" pos:end="77:19">&lt;</operator> <name pos:start="77:21" pos:end="77:39"><name pos:start="77:21" pos:end="77:24">data</name><operator pos:start="77:25" pos:end="77:26">-&gt;</operator><name pos:start="77:27" pos:end="77:39">nb_au_headers</name></name></expr>;</condition> <incr pos:start="77:42" pos:end="77:44"><expr pos:start="77:42" pos:end="77:44"><operator pos:start="77:42" pos:end="77:43">++</operator><name pos:start="77:44" pos:end="77:44">i</name></expr></incr>)</control> <block pos:start="77:47" pos:end="83:5">{<block_content pos:start="79:9" pos:end="81:85">

        <expr_stmt pos:start="79:9" pos:end="79:84"><expr pos:start="79:9" pos:end="79:83"><name pos:start="79:9" pos:end="79:27"><name pos:start="79:9" pos:end="79:12">data</name><operator pos:start="79:13" pos:end="79:14">-&gt;</operator><name pos:start="79:15" pos:end="79:24">au_headers</name><index pos:start="79:25" pos:end="79:27">[<expr pos:start="79:26" pos:end="79:26"><literal type="number" pos:start="79:26" pos:end="79:26">0</literal></expr>]</index></name><operator pos:start="79:28" pos:end="79:28">.</operator><name pos:start="79:29" pos:end="79:32">size</name> <operator pos:start="79:34" pos:end="79:35">+=</operator> <call pos:start="79:37" pos:end="79:83"><name pos:start="79:37" pos:end="79:49">get_bits_long</name><argument_list pos:start="79:50" pos:end="79:83">(<argument pos:start="79:51" pos:end="79:64"><expr pos:start="79:51" pos:end="79:64"><operator pos:start="79:51" pos:end="79:51">&amp;</operator><name pos:start="79:52" pos:end="79:64">getbitcontext</name></expr></argument>, <argument pos:start="79:67" pos:end="79:82"><expr pos:start="79:67" pos:end="79:82"><name pos:start="79:67" pos:end="79:82"><name pos:start="79:67" pos:end="79:70">data</name><operator pos:start="79:71" pos:end="79:72">-&gt;</operator><name pos:start="79:73" pos:end="79:82">sizelength</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="81:9" pos:end="81:85"><expr pos:start="81:9" pos:end="81:84"><name pos:start="81:9" pos:end="81:27"><name pos:start="81:9" pos:end="81:12">data</name><operator pos:start="81:13" pos:end="81:14">-&gt;</operator><name pos:start="81:15" pos:end="81:24">au_headers</name><index pos:start="81:25" pos:end="81:27">[<expr pos:start="81:26" pos:end="81:26"><literal type="number" pos:start="81:26" pos:end="81:26">0</literal></expr>]</index></name><operator pos:start="81:28" pos:end="81:28">.</operator><name pos:start="81:29" pos:end="81:33">index</name> <operator pos:start="81:35" pos:end="81:35">=</operator> <call pos:start="81:37" pos:end="81:84"><name pos:start="81:37" pos:end="81:49">get_bits_long</name><argument_list pos:start="81:50" pos:end="81:84">(<argument pos:start="81:51" pos:end="81:64"><expr pos:start="81:51" pos:end="81:64"><operator pos:start="81:51" pos:end="81:51">&amp;</operator><name pos:start="81:52" pos:end="81:64">getbitcontext</name></expr></argument>, <argument pos:start="81:67" pos:end="81:83"><expr pos:start="81:67" pos:end="81:83"><name pos:start="81:67" pos:end="81:83"><name pos:start="81:67" pos:end="81:70">data</name><operator pos:start="81:71" pos:end="81:72">-&gt;</operator><name pos:start="81:73" pos:end="81:83">indexlength</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    </block_content>}</block></for>



    <expr_stmt pos:start="87:5" pos:end="87:28"><expr pos:start="87:5" pos:end="87:27"><name pos:start="87:5" pos:end="87:23"><name pos:start="87:5" pos:end="87:8">data</name><operator pos:start="87:9" pos:end="87:10">-&gt;</operator><name pos:start="87:11" pos:end="87:23">nb_au_headers</name></name> <operator pos:start="87:25" pos:end="87:25">=</operator> <literal type="number" pos:start="87:27" pos:end="87:27">1</literal></expr>;</expr_stmt>



    <return pos:start="91:5" pos:end="91:13">return <expr pos:start="91:12" pos:end="91:12"><literal type="number" pos:start="91:12" pos:end="91:12">0</literal></expr>;</return>

</block_content>}</block></function>
</unit>
