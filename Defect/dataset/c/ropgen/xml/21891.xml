<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/1/21891.c" pos:tabs="8"><function pos:start="1:1" pos:end="59:1"><type pos:start="1:1" pos:end="1:11"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:11">void</name></type> <name pos:start="1:13" pos:end="1:33">net_tx_pkt_do_sw_csum</name><parameter_list pos:start="1:34" pos:end="1:55">(<parameter pos:start="1:35" pos:end="1:54"><decl pos:start="1:35" pos:end="1:54"><type pos:start="1:35" pos:end="1:54"><name pos:start="1:35" pos:end="1:49"><name pos:start="1:35" pos:end="1:40">struct</name> <name pos:start="1:42" pos:end="1:49">NetTxPkt</name></name> <modifier pos:start="1:51" pos:end="1:51">*</modifier></type><name pos:start="1:52" pos:end="1:54">pkt</name></decl></parameter>)</parameter_list>

<block pos:start="3:1" pos:end="59:1">{<block_content pos:start="5:5" pos:end="57:64">

    <decl_stmt pos:start="5:5" pos:end="5:57"><decl pos:start="5:5" pos:end="5:56"><type pos:start="5:5" pos:end="5:18"><name pos:start="5:5" pos:end="5:16"><name pos:start="5:5" pos:end="5:10">struct</name> <name pos:start="5:12" pos:end="5:16">iovec</name></name> <modifier pos:start="5:18" pos:end="5:18">*</modifier></type><name pos:start="5:19" pos:end="5:21">iov</name> <init pos:start="5:23" pos:end="5:56">= <expr pos:start="5:25" pos:end="5:56"><operator pos:start="5:25" pos:end="5:25">&amp;</operator><name pos:start="5:26" pos:end="5:56"><name pos:start="5:26" pos:end="5:28">pkt</name><operator pos:start="5:29" pos:end="5:30">-&gt;</operator><name pos:start="5:31" pos:end="5:33">vec</name><index pos:start="5:34" pos:end="5:56">[<expr pos:start="5:35" pos:end="5:55"><name pos:start="5:35" pos:end="5:55">NET_TX_PKT_L2HDR_FRAG</name></expr>]</index></name></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="7:5" pos:end="7:23"><decl pos:start="7:5" pos:end="7:22"><type pos:start="7:5" pos:end="7:12"><name pos:start="7:5" pos:end="7:12">uint32_t</name></type> <name pos:start="7:14" pos:end="7:22">csum_cntr</name></decl>;</decl_stmt>

    <decl_stmt pos:start="9:5" pos:end="9:22"><decl pos:start="9:5" pos:end="9:21"><type pos:start="9:5" pos:end="9:12"><name pos:start="9:5" pos:end="9:12">uint16_t</name></type> <name pos:start="9:14" pos:end="9:17">csum</name> <init pos:start="9:19" pos:end="9:21">= <expr pos:start="9:21" pos:end="9:21"><literal type="number" pos:start="9:21" pos:end="9:21">0</literal></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="11:5" pos:end="11:17"><decl pos:start="11:5" pos:end="11:16"><type pos:start="11:5" pos:end="11:12"><name pos:start="11:5" pos:end="11:12">uint32_t</name></type> <name pos:start="11:14" pos:end="11:16">cso</name></decl>;</decl_stmt>

    <comment type="block" pos:start="13:5" pos:end="13:35">/* num of iovec without vhdr */</comment>

    <decl_stmt pos:start="15:5" pos:end="15:73"><decl pos:start="15:5" pos:end="15:72"><type pos:start="15:5" pos:end="15:12"><name pos:start="15:5" pos:end="15:12">uint32_t</name></type> <name pos:start="15:14" pos:end="15:20">iov_len</name> <init pos:start="15:22" pos:end="15:72">= <expr pos:start="15:24" pos:end="15:72"><name pos:start="15:24" pos:end="15:41"><name pos:start="15:24" pos:end="15:26">pkt</name><operator pos:start="15:27" pos:end="15:28">-&gt;</operator><name pos:start="15:29" pos:end="15:41">payload_frags</name></name> <operator pos:start="15:43" pos:end="15:43">+</operator> <name pos:start="15:45" pos:end="15:68">NET_TX_PKT_PL_START_FRAG</name> <operator pos:start="15:70" pos:end="15:70">-</operator> <literal type="number" pos:start="15:72" pos:end="15:72">1</literal></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="17:5" pos:end="17:17"><decl pos:start="17:5" pos:end="17:16"><type pos:start="17:5" pos:end="17:12"><name pos:start="17:5" pos:end="17:12">uint16_t</name></type> <name pos:start="17:14" pos:end="17:16">csl</name></decl>;</decl_stmt>

    <decl_stmt pos:start="19:5" pos:end="19:28"><decl pos:start="19:5" pos:end="19:27"><type pos:start="19:5" pos:end="19:22"><name pos:start="19:5" pos:end="19:20"><name pos:start="19:5" pos:end="19:10">struct</name> <name pos:start="19:12" pos:end="19:20">ip_header</name></name> <modifier pos:start="19:22" pos:end="19:22">*</modifier></type><name pos:start="19:23" pos:end="19:27">iphdr</name></decl>;</decl_stmt>

    <decl_stmt pos:start="21:5" pos:end="21:78"><decl pos:start="21:5" pos:end="21:77"><type pos:start="21:5" pos:end="21:10"><name pos:start="21:5" pos:end="21:10">size_t</name></type> <name pos:start="21:12" pos:end="21:22">csum_offset</name> <init pos:start="21:24" pos:end="21:77">= <expr pos:start="21:26" pos:end="21:77"><name pos:start="21:26" pos:end="21:49"><name pos:start="21:26" pos:end="21:28">pkt</name><operator pos:start="21:29" pos:end="21:30">-&gt;</operator><name pos:start="21:31" pos:end="21:38">virt_hdr</name><operator pos:start="21:39" pos:end="21:39">.</operator><name pos:start="21:40" pos:end="21:49">csum_start</name></name> <operator pos:start="21:51" pos:end="21:51">+</operator> <name pos:start="21:53" pos:end="21:77"><name pos:start="21:53" pos:end="21:55">pkt</name><operator pos:start="21:56" pos:end="21:57">-&gt;</operator><name pos:start="21:58" pos:end="21:65">virt_hdr</name><operator pos:start="21:66" pos:end="21:66">.</operator><name pos:start="21:67" pos:end="21:77">csum_offset</name></name></expr></init></decl>;</decl_stmt>



    <comment type="block" pos:start="25:5" pos:end="25:36">/* Put zero to checksum field */</comment>

    <expr_stmt pos:start="27:5" pos:end="27:64"><expr pos:start="27:5" pos:end="27:63"><call pos:start="27:5" pos:end="27:63"><name pos:start="27:5" pos:end="27:16">iov_from_buf</name><argument_list pos:start="27:17" pos:end="27:63">(<argument pos:start="27:18" pos:end="27:20"><expr pos:start="27:18" pos:end="27:20"><name pos:start="27:18" pos:end="27:20">iov</name></expr></argument>, <argument pos:start="27:23" pos:end="27:29"><expr pos:start="27:23" pos:end="27:29"><name pos:start="27:23" pos:end="27:29">iov_len</name></expr></argument>, <argument pos:start="27:32" pos:end="27:42"><expr pos:start="27:32" pos:end="27:42"><name pos:start="27:32" pos:end="27:42">csum_offset</name></expr></argument>, <argument pos:start="27:45" pos:end="27:49"><expr pos:start="27:45" pos:end="27:49"><operator pos:start="27:45" pos:end="27:45">&amp;</operator><name pos:start="27:46" pos:end="27:49">csum</name></expr></argument>, <argument pos:start="27:52" pos:end="27:62"><expr pos:start="27:52" pos:end="27:62"><sizeof pos:start="27:52" pos:end="27:62">sizeof <name pos:start="27:59" pos:end="27:62">csum</name></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <comment type="block" pos:start="31:5" pos:end="31:39">/* Calculate L4 TCP/UDP checksum */</comment>

    <expr_stmt pos:start="33:5" pos:end="33:27"><expr pos:start="33:5" pos:end="33:26"><name pos:start="33:5" pos:end="33:7">csl</name> <operator pos:start="33:9" pos:end="33:9">=</operator> <name pos:start="33:11" pos:end="33:26"><name pos:start="33:11" pos:end="33:13">pkt</name><operator pos:start="33:14" pos:end="33:15">-&gt;</operator><name pos:start="33:16" pos:end="33:26">payload_len</name></name></expr>;</expr_stmt>



    <comment type="block" pos:start="37:5" pos:end="37:35">/* add pseudo header to csum */</comment>

    <expr_stmt pos:start="39:5" pos:end="39:53"><expr pos:start="39:5" pos:end="39:52"><name pos:start="39:5" pos:end="39:9">iphdr</name> <operator pos:start="39:11" pos:end="39:11">=</operator> <name pos:start="39:13" pos:end="39:43"><name pos:start="39:13" pos:end="39:15">pkt</name><operator pos:start="39:16" pos:end="39:17">-&gt;</operator><name pos:start="39:18" pos:end="39:20">vec</name><index pos:start="39:21" pos:end="39:43">[<expr pos:start="39:22" pos:end="39:42"><name pos:start="39:22" pos:end="39:42">NET_TX_PKT_L3HDR_FRAG</name></expr>]</index></name><operator pos:start="39:44" pos:end="39:44">.</operator><name pos:start="39:45" pos:end="39:52">iov_base</name></expr>;</expr_stmt>

    <expr_stmt pos:start="41:5" pos:end="41:63"><expr pos:start="41:5" pos:end="41:62"><name pos:start="41:5" pos:end="41:13">csum_cntr</name> <operator pos:start="41:15" pos:end="41:15">=</operator> <call pos:start="41:17" pos:end="41:62"><name pos:start="41:17" pos:end="41:44">eth_calc_ip4_pseudo_hdr_csum</name><argument_list pos:start="41:45" pos:end="41:62">(<argument pos:start="41:46" pos:end="41:50"><expr pos:start="41:46" pos:end="41:50"><name pos:start="41:46" pos:end="41:50">iphdr</name></expr></argument>, <argument pos:start="41:53" pos:end="41:55"><expr pos:start="41:53" pos:end="41:55"><name pos:start="41:53" pos:end="41:55">csl</name></expr></argument>, <argument pos:start="41:58" pos:end="41:61"><expr pos:start="41:58" pos:end="41:61"><operator pos:start="41:58" pos:end="41:58">&amp;</operator><name pos:start="41:59" pos:end="41:61">cso</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <comment type="block" pos:start="45:5" pos:end="45:23">/* data checksum */</comment>

    <expr_stmt pos:start="47:5" pos:end="49:79"><expr pos:start="47:5" pos:end="49:78"><name pos:start="47:5" pos:end="47:13">csum_cntr</name> <operator pos:start="47:15" pos:end="47:16">+=</operator>

        <call pos:start="49:9" pos:end="49:78"><name pos:start="49:9" pos:end="49:28">net_checksum_add_iov</name><argument_list pos:start="49:29" pos:end="49:78">(<argument pos:start="49:30" pos:end="49:32"><expr pos:start="49:30" pos:end="49:32"><name pos:start="49:30" pos:end="49:32">iov</name></expr></argument>, <argument pos:start="49:35" pos:end="49:41"><expr pos:start="49:35" pos:end="49:41"><name pos:start="49:35" pos:end="49:41">iov_len</name></expr></argument>, <argument pos:start="49:44" pos:end="49:67"><expr pos:start="49:44" pos:end="49:67"><name pos:start="49:44" pos:end="49:67"><name pos:start="49:44" pos:end="49:46">pkt</name><operator pos:start="49:47" pos:end="49:48">-&gt;</operator><name pos:start="49:49" pos:end="49:56">virt_hdr</name><operator pos:start="49:57" pos:end="49:57">.</operator><name pos:start="49:58" pos:end="49:67">csum_start</name></name></expr></argument>, <argument pos:start="49:70" pos:end="49:72"><expr pos:start="49:70" pos:end="49:72"><name pos:start="49:70" pos:end="49:72">csl</name></expr></argument>, <argument pos:start="49:75" pos:end="49:77"><expr pos:start="49:75" pos:end="49:77"><name pos:start="49:75" pos:end="49:77">cso</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <comment type="block" pos:start="53:5" pos:end="53:51">/* Put the checksum obtained into the packet */</comment>

    <expr_stmt pos:start="55:5" pos:end="55:55"><expr pos:start="55:5" pos:end="55:54"><name pos:start="55:5" pos:end="55:8">csum</name> <operator pos:start="55:10" pos:end="55:10">=</operator> <call pos:start="55:12" pos:end="55:54"><name pos:start="55:12" pos:end="55:22">cpu_to_be16</name><argument_list pos:start="55:23" pos:end="55:54">(<argument pos:start="55:24" pos:end="55:53"><expr pos:start="55:24" pos:end="55:53"><call pos:start="55:24" pos:end="55:53"><name pos:start="55:24" pos:end="55:42">net_checksum_finish</name><argument_list pos:start="55:43" pos:end="55:53">(<argument pos:start="55:44" pos:end="55:52"><expr pos:start="55:44" pos:end="55:52"><name pos:start="55:44" pos:end="55:52">csum_cntr</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="57:5" pos:end="57:64"><expr pos:start="57:5" pos:end="57:63"><call pos:start="57:5" pos:end="57:63"><name pos:start="57:5" pos:end="57:16">iov_from_buf</name><argument_list pos:start="57:17" pos:end="57:63">(<argument pos:start="57:18" pos:end="57:20"><expr pos:start="57:18" pos:end="57:20"><name pos:start="57:18" pos:end="57:20">iov</name></expr></argument>, <argument pos:start="57:23" pos:end="57:29"><expr pos:start="57:23" pos:end="57:29"><name pos:start="57:23" pos:end="57:29">iov_len</name></expr></argument>, <argument pos:start="57:32" pos:end="57:42"><expr pos:start="57:32" pos:end="57:42"><name pos:start="57:32" pos:end="57:42">csum_offset</name></expr></argument>, <argument pos:start="57:45" pos:end="57:49"><expr pos:start="57:45" pos:end="57:49"><operator pos:start="57:45" pos:end="57:45">&amp;</operator><name pos:start="57:46" pos:end="57:49">csum</name></expr></argument>, <argument pos:start="57:52" pos:end="57:62"><expr pos:start="57:52" pos:end="57:62"><sizeof pos:start="57:52" pos:end="57:62">sizeof <name pos:start="57:59" pos:end="57:62">csum</name></sizeof></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>
</unit>
