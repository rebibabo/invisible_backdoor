<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/0/5113.c" pos:tabs="8"><function pos:start="1:1" pos:end="55:1"><type pos:start="1:1" pos:end="1:20"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:20">IOMMUTLBEntry</name></type> <name pos:start="1:22" pos:end="1:46">spapr_tce_translate_iommu</name><parameter_list pos:start="1:47" pos:end="3:61">(<parameter pos:start="1:48" pos:end="1:66"><decl pos:start="1:48" pos:end="1:66"><type pos:start="1:48" pos:end="1:66"><name pos:start="1:48" pos:end="1:59">MemoryRegion</name> <modifier pos:start="1:61" pos:end="1:61">*</modifier></type><name pos:start="1:62" pos:end="1:66">iommu</name></decl></parameter>, <parameter pos:start="1:69" pos:end="1:79"><decl pos:start="1:69" pos:end="1:79"><type pos:start="1:69" pos:end="1:79"><name pos:start="1:69" pos:end="1:74">hwaddr</name></type> <name pos:start="1:76" pos:end="1:79">addr</name></decl></parameter>,

                                               <parameter pos:start="3:48" pos:end="3:60"><decl pos:start="3:48" pos:end="3:60"><type pos:start="3:48" pos:end="3:60"><name pos:start="3:48" pos:end="3:51">bool</name></type> <name pos:start="3:53" pos:end="3:60">is_write</name></decl></parameter>)</parameter_list>

<block pos:start="5:1" pos:end="55:1">{<block_content pos:start="7:5" pos:end="53:15">

    <decl_stmt pos:start="7:5" pos:end="7:68"><decl pos:start="7:5" pos:end="7:67"><type pos:start="7:5" pos:end="7:19"><name pos:start="7:5" pos:end="7:17">sPAPRTCETable</name> <modifier pos:start="7:19" pos:end="7:19">*</modifier></type><name pos:start="7:20" pos:end="7:23">tcet</name> <init pos:start="7:25" pos:end="7:67">= <expr pos:start="7:27" pos:end="7:67"><call pos:start="7:27" pos:end="7:67"><name pos:start="7:27" pos:end="7:38">container_of</name><argument_list pos:start="7:39" pos:end="7:67">(<argument pos:start="7:40" pos:end="7:44"><expr pos:start="7:40" pos:end="7:44"><name pos:start="7:40" pos:end="7:44">iommu</name></expr></argument>, <argument pos:start="7:47" pos:end="7:59"><expr pos:start="7:47" pos:end="7:59"><name pos:start="7:47" pos:end="7:59">sPAPRTCETable</name></expr></argument>, <argument pos:start="7:62" pos:end="7:66"><expr pos:start="7:62" pos:end="7:66"><name pos:start="7:62" pos:end="7:66">iommu</name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>

    <decl_stmt pos:start="9:5" pos:end="9:17"><decl pos:start="9:5" pos:end="9:16"><type pos:start="9:5" pos:end="9:12"><name pos:start="9:5" pos:end="9:12">uint64_t</name></type> <name pos:start="9:14" pos:end="9:16">tce</name></decl>;</decl_stmt>

    <decl_stmt pos:start="11:5" pos:end="23:6"><decl pos:start="11:5" pos:end="23:5"><type pos:start="11:5" pos:end="11:17"><name pos:start="11:5" pos:end="11:17">IOMMUTLBEntry</name></type> <name pos:start="11:19" pos:end="11:21">ret</name> <init pos:start="11:23" pos:end="23:5">= <expr pos:start="11:25" pos:end="23:5"><block pos:start="11:25" pos:end="23:5">{

        <expr pos:start="13:9" pos:end="13:42"><operator pos:start="13:9" pos:end="13:9">.</operator><name pos:start="13:10" pos:end="13:18">target_as</name> <operator pos:start="13:20" pos:end="13:20">=</operator> <operator pos:start="13:22" pos:end="13:22">&amp;</operator><name pos:start="13:23" pos:end="13:42">address_space_memory</name></expr>,

        <expr pos:start="15:9" pos:end="15:17"><operator pos:start="15:9" pos:end="15:9">.</operator><name pos:start="15:10" pos:end="15:13">iova</name> <operator pos:start="15:15" pos:end="15:15">=</operator> <literal type="number" pos:start="15:17" pos:end="15:17">0</literal></expr>,

        <expr pos:start="17:9" pos:end="17:28"><operator pos:start="17:9" pos:end="17:9">.</operator><name pos:start="17:10" pos:end="17:24">translated_addr</name> <operator pos:start="17:26" pos:end="17:26">=</operator> <literal type="number" pos:start="17:28" pos:end="17:28">0</literal></expr>,

        <expr pos:start="19:9" pos:end="19:31"><operator pos:start="19:9" pos:end="19:9">.</operator><name pos:start="19:10" pos:end="19:18">addr_mask</name> <operator pos:start="19:20" pos:end="19:20">=</operator> <operator pos:start="19:22" pos:end="19:22">~</operator><operator pos:start="19:23" pos:end="19:23">(</operator><name pos:start="19:24" pos:end="19:29">hwaddr</name><operator pos:start="19:30" pos:end="19:30">)</operator><literal type="number" pos:start="19:31" pos:end="19:31">0</literal></expr>,

        <expr pos:start="21:9" pos:end="21:26"><operator pos:start="21:9" pos:end="21:9">.</operator><name pos:start="21:10" pos:end="21:13">perm</name> <operator pos:start="21:15" pos:end="21:15">=</operator> <name pos:start="21:17" pos:end="21:26">IOMMU_NONE</name></expr>,

    }</block></expr></init></decl>;</decl_stmt>



    <if_stmt pos:start="27:5" pos:end="45:5"><if pos:start="27:5" pos:end="45:5">if <condition pos:start="27:8" pos:end="27:52">(<expr pos:start="27:9" pos:end="27:51"><operator pos:start="27:9" pos:end="27:9">(</operator><name pos:start="27:10" pos:end="27:13">addr</name> <operator pos:start="27:15" pos:end="27:16">&gt;&gt;</operator> <name pos:start="27:18" pos:end="27:33"><name pos:start="27:18" pos:end="27:21">tcet</name><operator pos:start="27:22" pos:end="27:23">-&gt;</operator><name pos:start="27:24" pos:end="27:33">page_shift</name></name><operator pos:start="27:34" pos:end="27:34">)</operator> <operator pos:start="27:36" pos:end="27:36">&lt;</operator> <name pos:start="27:38" pos:end="27:51"><name pos:start="27:38" pos:end="27:41">tcet</name><operator pos:start="27:42" pos:end="27:43">-&gt;</operator><name pos:start="27:44" pos:end="27:51">nb_table</name></name></expr>)</condition> <block pos:start="27:54" pos:end="45:5">{<block_content pos:start="31:9" pos:end="43:53">

        <comment type="block" pos:start="29:9" pos:end="29:38">/* Check if we are in bound */</comment>

        <decl_stmt pos:start="31:9" pos:end="31:61"><decl pos:start="31:9" pos:end="31:60"><type pos:start="31:9" pos:end="31:14"><name pos:start="31:9" pos:end="31:14">hwaddr</name></type> <name pos:start="31:16" pos:end="31:24">page_mask</name> <init pos:start="31:26" pos:end="31:60">= <expr pos:start="31:28" pos:end="31:60"><call pos:start="31:28" pos:end="31:60"><name pos:start="31:28" pos:end="31:42">IOMMU_PAGE_MASK</name><argument_list pos:start="31:43" pos:end="31:60">(<argument pos:start="31:44" pos:end="31:59"><expr pos:start="31:44" pos:end="31:59"><name pos:start="31:44" pos:end="31:59"><name pos:start="31:44" pos:end="31:47">tcet</name><operator pos:start="31:48" pos:end="31:49">-&gt;</operator><name pos:start="31:50" pos:end="31:59">page_shift</name></name></expr></argument>)</argument_list></call></expr></init></decl>;</decl_stmt>



        <expr_stmt pos:start="35:9" pos:end="35:52"><expr pos:start="35:9" pos:end="35:51"><name pos:start="35:9" pos:end="35:11">tce</name> <operator pos:start="35:13" pos:end="35:13">=</operator> <name pos:start="35:15" pos:end="35:51"><name pos:start="35:15" pos:end="35:18">tcet</name><operator pos:start="35:19" pos:end="35:20">-&gt;</operator><name pos:start="35:21" pos:end="35:25">table</name><index pos:start="35:26" pos:end="35:51">[<expr pos:start="35:27" pos:end="35:50"><name pos:start="35:27" pos:end="35:30">addr</name> <operator pos:start="35:32" pos:end="35:33">&gt;&gt;</operator> <name pos:start="35:35" pos:end="35:50"><name pos:start="35:35" pos:end="35:38">tcet</name><operator pos:start="35:39" pos:end="35:40">-&gt;</operator><name pos:start="35:41" pos:end="35:50">page_shift</name></name></expr>]</index></name></expr>;</expr_stmt>

        <expr_stmt pos:start="37:9" pos:end="37:36"><expr pos:start="37:9" pos:end="37:35"><name pos:start="37:9" pos:end="37:16"><name pos:start="37:9" pos:end="37:11">ret</name><operator pos:start="37:12" pos:end="37:12">.</operator><name pos:start="37:13" pos:end="37:16">iova</name></name> <operator pos:start="37:18" pos:end="37:18">=</operator> <name pos:start="37:20" pos:end="37:23">addr</name> <operator pos:start="37:25" pos:end="37:25">&amp;</operator> <name pos:start="37:27" pos:end="37:35">page_mask</name></expr>;</expr_stmt>

        <expr_stmt pos:start="39:9" pos:end="39:46"><expr pos:start="39:9" pos:end="39:45"><name pos:start="39:9" pos:end="39:27"><name pos:start="39:9" pos:end="39:11">ret</name><operator pos:start="39:12" pos:end="39:12">.</operator><name pos:start="39:13" pos:end="39:27">translated_addr</name></name> <operator pos:start="39:29" pos:end="39:29">=</operator> <name pos:start="39:31" pos:end="39:33">tce</name> <operator pos:start="39:35" pos:end="39:35">&amp;</operator> <name pos:start="39:37" pos:end="39:45">page_mask</name></expr>;</expr_stmt>

        <expr_stmt pos:start="41:9" pos:end="41:35"><expr pos:start="41:9" pos:end="41:34"><name pos:start="41:9" pos:end="41:21"><name pos:start="41:9" pos:end="41:11">ret</name><operator pos:start="41:12" pos:end="41:12">.</operator><name pos:start="41:13" pos:end="41:21">addr_mask</name></name> <operator pos:start="41:23" pos:end="41:23">=</operator> <operator pos:start="41:25" pos:end="41:25">~</operator><name pos:start="41:26" pos:end="41:34">page_mask</name></expr>;</expr_stmt>

        <expr_stmt pos:start="43:9" pos:end="43:53"><expr pos:start="43:9" pos:end="43:52"><name pos:start="43:9" pos:end="43:16"><name pos:start="43:9" pos:end="43:11">ret</name><operator pos:start="43:12" pos:end="43:12">.</operator><name pos:start="43:13" pos:end="43:16">perm</name></name> <operator pos:start="43:18" pos:end="43:18">=</operator> <call pos:start="43:20" pos:end="43:52"><name pos:start="43:20" pos:end="43:47">spapr_tce_iommu_access_flags</name><argument_list pos:start="43:48" pos:end="43:52">(<argument pos:start="43:49" pos:end="43:51"><expr pos:start="43:49" pos:end="43:51"><name pos:start="43:49" pos:end="43:51">tce</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    </block_content>}</block></if></if_stmt>

    <expr_stmt pos:start="47:5" pos:end="49:43"><expr pos:start="47:5" pos:end="49:42"><call pos:start="47:5" pos:end="49:42"><name pos:start="47:5" pos:end="47:27">trace_spapr_iommu_xlate</name><argument_list pos:start="47:28" pos:end="49:42">(<argument pos:start="47:29" pos:end="47:39"><expr pos:start="47:29" pos:end="47:39"><name pos:start="47:29" pos:end="47:39"><name pos:start="47:29" pos:end="47:32">tcet</name><operator pos:start="47:33" pos:end="47:34">-&gt;</operator><name pos:start="47:35" pos:end="47:39">liobn</name></name></expr></argument>, <argument pos:start="47:42" pos:end="47:45"><expr pos:start="47:42" pos:end="47:45"><name pos:start="47:42" pos:end="47:45">addr</name></expr></argument>, <argument pos:start="47:48" pos:end="47:55"><expr pos:start="47:48" pos:end="47:55"><name pos:start="47:48" pos:end="47:55"><name pos:start="47:48" pos:end="47:50">ret</name><operator pos:start="47:51" pos:end="47:51">.</operator><name pos:start="47:52" pos:end="47:55">iova</name></name></expr></argument>, <argument pos:start="47:58" pos:end="47:65"><expr pos:start="47:58" pos:end="47:65"><name pos:start="47:58" pos:end="47:65"><name pos:start="47:58" pos:end="47:60">ret</name><operator pos:start="47:61" pos:end="47:61">.</operator><name pos:start="47:62" pos:end="47:65">perm</name></name></expr></argument>,

                            <argument pos:start="49:29" pos:end="49:41"><expr pos:start="49:29" pos:end="49:41"><name pos:start="49:29" pos:end="49:41"><name pos:start="49:29" pos:end="49:31">ret</name><operator pos:start="49:32" pos:end="49:32">.</operator><name pos:start="49:33" pos:end="49:41">addr_mask</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



    <return pos:start="53:5" pos:end="53:15">return <expr pos:start="53:12" pos:end="53:14"><name pos:start="53:12" pos:end="53:14">ret</name></expr>;</return>

</block_content>}</block></function>
</unit>
