<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:cpp="http://www.srcML.org/srcML/cpp" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/1/14096.c" pos:tabs="8"><function pos:start="1:1" pos:end="291:1"><type pos:start="1:1" pos:end="1:10"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:10">int</name></type> <name pos:start="1:12" pos:end="1:19">rd_frame</name><parameter_list pos:start="1:20" pos:end="1:114">(<parameter pos:start="1:21" pos:end="1:40"><decl pos:start="1:21" pos:end="1:40"><type pos:start="1:21" pos:end="1:40"><name pos:start="1:21" pos:end="1:37">CinepakEncContext</name> <modifier pos:start="1:39" pos:end="1:39">*</modifier></type><name pos:start="1:40" pos:end="1:40">s</name></decl></parameter>, <parameter pos:start="1:43" pos:end="1:62"><decl pos:start="1:43" pos:end="1:62"><type pos:start="1:43" pos:end="1:62"><specifier pos:start="1:43" pos:end="1:47">const</specifier> <name pos:start="1:49" pos:end="1:55">AVFrame</name> <modifier pos:start="1:57" pos:end="1:57">*</modifier></type><name pos:start="1:58" pos:end="1:62">frame</name></decl></parameter>, <parameter pos:start="1:65" pos:end="1:79"><decl pos:start="1:65" pos:end="1:79"><type pos:start="1:65" pos:end="1:79"><name pos:start="1:65" pos:end="1:67">int</name></type> <name pos:start="1:69" pos:end="1:79">isakeyframe</name></decl></parameter>, <parameter pos:start="1:82" pos:end="1:99"><decl pos:start="1:82" pos:end="1:99"><type pos:start="1:82" pos:end="1:99"><name pos:start="1:82" pos:end="1:89">unsigned</name> <name pos:start="1:91" pos:end="1:94">char</name> <modifier pos:start="1:96" pos:end="1:96">*</modifier></type><name pos:start="1:97" pos:end="1:99">buf</name></decl></parameter>, <parameter pos:start="1:102" pos:end="1:113"><decl pos:start="1:102" pos:end="1:113"><type pos:start="1:102" pos:end="1:113"><name pos:start="1:102" pos:end="1:104">int</name></type> <name pos:start="1:106" pos:end="1:113">buf_size</name></decl></parameter>)</parameter_list>

<block pos:start="3:1" pos:end="291:1">{<block_content pos:start="5:5" pos:end="289:21">

    <decl_stmt pos:start="5:5" pos:end="5:67"><decl pos:start="5:5" pos:end="5:18"><type pos:start="5:5" pos:end="5:7"><name pos:start="5:5" pos:end="5:7">int</name></type> <name pos:start="5:9" pos:end="5:18">num_strips</name></decl>, <decl pos:start="5:21" pos:end="5:25"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:21" pos:end="5:25">strip</name></decl>, <decl pos:start="5:28" pos:end="5:28"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:28" pos:end="5:28">i</name></decl>, <decl pos:start="5:31" pos:end="5:31"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:31" pos:end="5:31">y</name></decl>, <decl pos:start="5:34" pos:end="5:38"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:34" pos:end="5:38">nexty</name></decl>, <decl pos:start="5:41" pos:end="5:44"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:41" pos:end="5:44">size</name></decl>, <decl pos:start="5:47" pos:end="5:55"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:47" pos:end="5:55">temp_size</name></decl>, <decl pos:start="5:58" pos:end="5:66"><type ref="prev" pos:start="5:5" pos:end="5:7"/><name pos:start="5:58" pos:end="5:66">best_size</name></decl>;</decl_stmt>

    <decl_stmt pos:start="7:5" pos:end="7:44"><decl pos:start="7:5" pos:end="7:23"><type pos:start="7:5" pos:end="7:13"><name pos:start="7:5" pos:end="7:13">AVPicture</name></type> <name pos:start="7:15" pos:end="7:23">last_pict</name></decl>, <decl pos:start="7:26" pos:end="7:29"><type ref="prev" pos:start="7:5" pos:end="7:13"/><name pos:start="7:26" pos:end="7:29">pict</name></decl>, <decl pos:start="7:32" pos:end="7:43"><type ref="prev" pos:start="7:5" pos:end="7:13"/><name pos:start="7:32" pos:end="7:43">scratch_pict</name></decl>;</decl_stmt>

    <decl_stmt pos:start="9:5" pos:end="12:0"><decl pos:start="9:5" pos:end="9:26"><type pos:start="9:5" pos:end="9:11"><name pos:start="9:5" pos:end="9:11">int64_t</name></type> <name pos:start="9:13" pos:end="9:22">best_score</name> <init pos:start="9:24" pos:end="9:26">= <expr pos:start="9:26" pos:end="9:26"><literal type="number" pos:start="9:26" pos:end="9:26">0</literal></expr></init></decl>, <decl pos:start="9:29" pos:end="9:33"><type ref="prev" pos:start="9:5" pos:end="9:11"/><name pos:start="9:29" pos:end="9:33">score</name></decl>, <decl pos:start="9:36" pos:end="9:45"><type ref="prev" pos:start="9:5" pos:end="9:11"/><name pos:start="9:36" pos:end="9:45">score_temp</name></decl>;</decl_stmt>

<cpp:ifdef pos:start="11:1" pos:end="11:26">#<cpp:directive pos:start="11:2" pos:end="11:6">ifdef</cpp:directive> <name pos:start="11:8" pos:end="11:26">CINEPAK_REPORT_SERR</name></cpp:ifdef>

    <decl_stmt pos:start="13:5" pos:end="16:0"><decl pos:start="13:5" pos:end="13:25"><type pos:start="13:5" pos:end="13:11"><name pos:start="13:5" pos:end="13:11">int64_t</name></type> <name pos:start="13:13" pos:end="13:21">best_serr</name> <init pos:start="13:23" pos:end="13:25">= <expr pos:start="13:25" pos:end="13:25"><literal type="number" pos:start="13:25" pos:end="13:25">0</literal></expr></init></decl>, <decl pos:start="13:28" pos:end="13:31"><type ref="prev" pos:start="13:5" pos:end="13:11"/><name pos:start="13:28" pos:end="13:31">serr</name></decl>, <decl pos:start="13:34" pos:end="13:42"><type ref="prev" pos:start="13:5" pos:end="13:11"/><name pos:start="13:34" pos:end="13:42">serr_temp</name></decl>;</decl_stmt>

<cpp:endif pos:start="15:1" pos:end="15:6">#<cpp:directive pos:start="15:2" pos:end="15:6">endif</cpp:directive></cpp:endif>



    <decl_stmt pos:start="19:5" pos:end="19:21"><decl pos:start="19:5" pos:end="19:20"><type pos:start="19:5" pos:end="19:7"><name pos:start="19:5" pos:end="19:7">int</name></type> <name pos:start="19:9" pos:end="19:20">best_nstrips</name></decl>;</decl_stmt>



    <if_stmt pos:start="23:5" pos:end="105:5"><if pos:start="23:5" pos:end="105:5">if<condition pos:start="23:7" pos:end="23:38">(<expr pos:start="23:8" pos:end="23:37"><name pos:start="23:8" pos:end="23:17"><name pos:start="23:8" pos:end="23:8">s</name><operator pos:start="23:9" pos:end="23:10">-&gt;</operator><name pos:start="23:11" pos:end="23:17">pix_fmt</name></name> <operator pos:start="23:19" pos:end="23:20">==</operator> <name pos:start="23:22" pos:end="23:37">AV_PIX_FMT_RGB24</name></expr>)</condition> <block pos:start="23:40" pos:end="105:5">{<block_content pos:start="25:9" pos:end="103:9">

        <decl_stmt pos:start="25:9" pos:end="25:14"><decl pos:start="25:9" pos:end="25:13"><type pos:start="25:9" pos:end="25:11"><name pos:start="25:9" pos:end="25:11">int</name></type> <name pos:start="25:13" pos:end="25:13">x</name></decl>;</decl_stmt>

<comment type="line" pos:start="27:1" pos:end="27:60">// build a copy of the given frame in the correct colorspace</comment>

        <for pos:start="29:9" pos:end="103:9">for<control pos:start="29:12" pos:end="29:36">(<init pos:start="29:13" pos:end="29:18"><expr pos:start="29:13" pos:end="29:17"><name pos:start="29:13" pos:end="29:13">y</name> <operator pos:start="29:15" pos:end="29:15">=</operator> <literal type="number" pos:start="29:17" pos:end="29:17">0</literal></expr>;</init> <condition pos:start="29:20" pos:end="29:28"><expr pos:start="29:20" pos:end="29:27"><name pos:start="29:20" pos:end="29:20">y</name> <operator pos:start="29:22" pos:end="29:22">&lt;</operator> <name pos:start="29:24" pos:end="29:27"><name pos:start="29:24" pos:end="29:24">s</name><operator pos:start="29:25" pos:end="29:26">-&gt;</operator><name pos:start="29:27" pos:end="29:27">h</name></name></expr>;</condition> <incr pos:start="29:30" pos:end="29:35"><expr pos:start="29:30" pos:end="29:35"><name pos:start="29:30" pos:end="29:30">y</name> <operator pos:start="29:32" pos:end="29:33">+=</operator> <literal type="number" pos:start="29:35" pos:end="29:35">2</literal></expr></incr>)</control> <block pos:start="29:38" pos:end="103:9">{<block_content pos:start="31:13" pos:end="101:13">

            <for pos:start="31:13" pos:end="101:13">for<control pos:start="31:16" pos:end="31:40">(<init pos:start="31:17" pos:end="31:22"><expr pos:start="31:17" pos:end="31:21"><name pos:start="31:17" pos:end="31:17">x</name> <operator pos:start="31:19" pos:end="31:19">=</operator> <literal type="number" pos:start="31:21" pos:end="31:21">0</literal></expr>;</init> <condition pos:start="31:24" pos:end="31:32"><expr pos:start="31:24" pos:end="31:31"><name pos:start="31:24" pos:end="31:24">x</name> <operator pos:start="31:26" pos:end="31:26">&lt;</operator> <name pos:start="31:28" pos:end="31:31"><name pos:start="31:28" pos:end="31:28">s</name><operator pos:start="31:29" pos:end="31:30">-&gt;</operator><name pos:start="31:31" pos:end="31:31">w</name></name></expr>;</condition> <incr pos:start="31:34" pos:end="31:39"><expr pos:start="31:34" pos:end="31:39"><name pos:start="31:34" pos:end="31:34">x</name> <operator pos:start="31:36" pos:end="31:37">+=</operator> <literal type="number" pos:start="31:39" pos:end="31:39">2</literal></expr></incr>)</control> <block pos:start="31:42" pos:end="101:13">{<block_content pos:start="33:17" pos:end="99:51">

                <decl_stmt pos:start="33:17" pos:end="33:31"><decl pos:start="33:17" pos:end="33:30"><type pos:start="33:17" pos:end="33:25"><name pos:start="33:17" pos:end="33:23">uint8_t</name> <modifier pos:start="33:25" pos:end="33:25">*</modifier></type><name pos:start="33:26" pos:end="33:30"><name pos:start="33:26" pos:end="33:27">ir</name><index pos:start="33:28" pos:end="33:30">[<expr pos:start="33:29" pos:end="33:29"><literal type="number" pos:start="33:29" pos:end="33:29">2</literal></expr>]</index></name></decl>;</decl_stmt> <decl_stmt pos:start="33:33" pos:end="33:60"><decl pos:start="33:33" pos:end="33:41"><type pos:start="33:33" pos:end="33:39"><name pos:start="33:33" pos:end="33:39">int32_t</name></type> <name pos:start="33:41" pos:end="33:41">r</name></decl>, <decl pos:start="33:44" pos:end="33:44"><type ref="prev" pos:start="33:33" pos:end="33:39"/><name pos:start="33:44" pos:end="33:44">g</name></decl>, <decl pos:start="33:47" pos:end="33:47"><type ref="prev" pos:start="33:33" pos:end="33:39"/><name pos:start="33:47" pos:end="33:47">b</name></decl>, <decl pos:start="33:50" pos:end="33:51"><type ref="prev" pos:start="33:33" pos:end="33:39"/><name pos:start="33:50" pos:end="33:51">rr</name></decl>, <decl pos:start="33:54" pos:end="33:55"><type ref="prev" pos:start="33:33" pos:end="33:39"/><name pos:start="33:54" pos:end="33:55">gg</name></decl>, <decl pos:start="33:58" pos:end="33:59"><type ref="prev" pos:start="33:33" pos:end="33:39"/><name pos:start="33:58" pos:end="33:59">bb</name></decl>;</decl_stmt>

                <expr_stmt pos:start="35:17" pos:end="35:96"><expr pos:start="35:17" pos:end="35:95"><name pos:start="35:17" pos:end="35:21"><name pos:start="35:17" pos:end="35:18">ir</name><index pos:start="35:19" pos:end="35:21">[<expr pos:start="35:20" pos:end="35:20"><literal type="number" pos:start="35:20" pos:end="35:20">0</literal></expr>]</index></name> <operator pos:start="35:23" pos:end="35:23">=</operator> <operator pos:start="35:25" pos:end="35:25">(</operator><operator pos:start="35:26" pos:end="35:26">(</operator><name pos:start="35:27" pos:end="35:35">AVPicture</name><operator pos:start="35:36" pos:end="35:36">*</operator><operator pos:start="35:37" pos:end="35:37">)</operator><name pos:start="35:38" pos:end="35:42">frame</name><operator pos:start="35:43" pos:end="35:43">)</operator><operator pos:start="35:44" pos:end="35:45">-&gt;</operator><name pos:start="35:46" pos:end="35:52"><name pos:start="35:46" pos:end="35:49">data</name><index pos:start="35:50" pos:end="35:52">[<expr pos:start="35:51" pos:end="35:51"><literal type="number" pos:start="35:51" pos:end="35:51">0</literal></expr>]</index></name> <operator pos:start="35:54" pos:end="35:54">+</operator> <name pos:start="35:56" pos:end="35:56">x</name><operator pos:start="35:57" pos:end="35:57">*</operator><literal type="number" pos:start="35:58" pos:end="35:60">3</literal> <operator pos:start="35:60" pos:end="35:60">+</operator> <name pos:start="35:62" pos:end="35:62">y</name><operator pos:start="35:63" pos:end="35:63">*</operator><operator pos:start="35:64" pos:end="35:64">(</operator><operator pos:start="35:65" pos:end="35:65">(</operator><name pos:start="35:66" pos:end="35:74">AVPicture</name><operator pos:start="35:75" pos:end="35:75">*</operator><operator pos:start="35:76" pos:end="35:76">)</operator><name pos:start="35:77" pos:end="35:81">frame</name><operator pos:start="35:82" pos:end="35:82">)</operator><operator pos:start="35:83" pos:end="35:84">-&gt;</operator><name pos:start="35:85" pos:end="35:95"><name pos:start="35:85" pos:end="35:92">linesize</name><index pos:start="35:93" pos:end="35:95">[<expr pos:start="35:94" pos:end="35:94"><literal type="number" pos:start="35:94" pos:end="35:94">0</literal></expr>]</index></name></expr>;</expr_stmt>

                <expr_stmt pos:start="37:17" pos:end="37:65"><expr pos:start="37:17" pos:end="37:64"><name pos:start="37:17" pos:end="37:21"><name pos:start="37:17" pos:end="37:18">ir</name><index pos:start="37:19" pos:end="37:21">[<expr pos:start="37:20" pos:end="37:20"><literal type="number" pos:start="37:20" pos:end="37:20">1</literal></expr>]</index></name> <operator pos:start="37:23" pos:end="37:23">=</operator> <name pos:start="37:25" pos:end="37:29"><name pos:start="37:25" pos:end="37:26">ir</name><index pos:start="37:27" pos:end="37:29">[<expr pos:start="37:28" pos:end="37:28"><literal type="number" pos:start="37:28" pos:end="37:28">0</literal></expr>]</index></name> <operator pos:start="37:31" pos:end="37:31">+</operator> <operator pos:start="37:33" pos:end="37:33">(</operator><operator pos:start="37:34" pos:end="37:34">(</operator><name pos:start="37:35" pos:end="37:43">AVPicture</name><operator pos:start="37:44" pos:end="37:44">*</operator><operator pos:start="37:45" pos:end="37:45">)</operator><name pos:start="37:46" pos:end="37:50">frame</name><operator pos:start="37:51" pos:end="37:51">)</operator><operator pos:start="37:52" pos:end="37:53">-&gt;</operator><name pos:start="37:54" pos:end="37:64"><name pos:start="37:54" pos:end="37:61">linesize</name><index pos:start="37:62" pos:end="37:64">[<expr pos:start="37:63" pos:end="37:63"><literal type="number" pos:start="37:63" pos:end="37:63">0</literal></expr>]</index></name></expr>;</expr_stmt>

                <expr_stmt pos:start="39:17" pos:end="39:84"><expr pos:start="39:17" pos:end="39:83"><call pos:start="39:17" pos:end="39:83"><name pos:start="39:17" pos:end="39:31">get_sub_picture</name><argument_list pos:start="39:32" pos:end="39:83">(<argument pos:start="39:33" pos:end="39:33"><expr pos:start="39:33" pos:end="39:33"><name pos:start="39:33" pos:end="39:33">s</name></expr></argument>, <argument pos:start="39:36" pos:end="39:36"><expr pos:start="39:36" pos:end="39:36"><name pos:start="39:36" pos:end="39:36">x</name></expr></argument>, <argument pos:start="39:39" pos:end="39:39"><expr pos:start="39:39" pos:end="39:39"><name pos:start="39:39" pos:end="39:39">y</name></expr></argument>, <argument pos:start="39:42" pos:end="39:67"><expr pos:start="39:42" pos:end="39:67"><operator pos:start="39:42" pos:end="39:42">(</operator><name pos:start="39:43" pos:end="39:51">AVPicture</name><operator pos:start="39:52" pos:end="39:52">*</operator><operator pos:start="39:53" pos:end="39:53">)</operator><name pos:start="39:54" pos:end="39:67"><name pos:start="39:54" pos:end="39:54">s</name><operator pos:start="39:55" pos:end="39:56">-&gt;</operator><name pos:start="39:57" pos:end="39:67">input_frame</name></name></expr></argument>, <argument pos:start="39:70" pos:end="39:82"><expr pos:start="39:70" pos:end="39:82"><operator pos:start="39:70" pos:end="39:70">&amp;</operator><name pos:start="39:71" pos:end="39:82">scratch_pict</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <expr_stmt pos:start="41:17" pos:end="41:30"><expr pos:start="41:17" pos:end="41:29"><name pos:start="41:17" pos:end="41:17">r</name> <operator pos:start="41:19" pos:end="41:19">=</operator> <name pos:start="41:21" pos:end="41:21">g</name> <operator pos:start="41:23" pos:end="41:23">=</operator> <name pos:start="41:25" pos:end="41:25">b</name> <operator pos:start="41:27" pos:end="41:27">=</operator> <literal type="number" pos:start="41:29" pos:end="41:29">0</literal></expr>;</expr_stmt>

                <for pos:start="43:17" pos:end="71:17">for<control pos:start="43:20" pos:end="43:34">(<init pos:start="43:21" pos:end="43:24"><expr pos:start="43:21" pos:end="43:23"><name pos:start="43:21" pos:end="43:21">i</name><operator pos:start="43:22" pos:end="43:22">=</operator><literal type="number" pos:start="43:23" pos:end="43:23">0</literal></expr>;</init> <condition pos:start="43:26" pos:end="43:29"><expr pos:start="43:26" pos:end="43:28"><name pos:start="43:26" pos:end="43:26">i</name><operator pos:start="43:27" pos:end="43:27">&lt;</operator><literal type="number" pos:start="43:28" pos:end="43:28">4</literal></expr>;</condition> <incr pos:start="43:31" pos:end="43:33"><expr pos:start="43:31" pos:end="43:33"><operator pos:start="43:31" pos:end="43:32">++</operator><name pos:start="43:33" pos:end="43:33">i</name></expr></incr>)</control> <block pos:start="43:36" pos:end="71:17">{<block_content pos:start="45:21" pos:end="69:80">

                    <decl_stmt pos:start="45:21" pos:end="45:31"><decl pos:start="45:21" pos:end="45:26"><type pos:start="45:21" pos:end="45:23"><name pos:start="45:21" pos:end="45:23">int</name></type> <name pos:start="45:25" pos:end="45:26">i1</name></decl>, <decl pos:start="45:29" pos:end="45:30"><type ref="prev" pos:start="45:21" pos:end="45:23"/><name pos:start="45:29" pos:end="45:30">i2</name></decl>;</decl_stmt>

                    <expr_stmt pos:start="47:21" pos:end="47:31"><expr pos:start="47:21" pos:end="47:30"><name pos:start="47:21" pos:end="47:22">i1</name> <operator pos:start="47:24" pos:end="47:24">=</operator> <operator pos:start="47:26" pos:end="47:26">(</operator><name pos:start="47:27" pos:end="47:27">i</name><operator pos:start="47:28" pos:end="47:28">&amp;</operator><literal type="number" pos:start="47:29" pos:end="47:29">1</literal><operator pos:start="47:30" pos:end="47:30">)</operator></expr>;</expr_stmt> <expr_stmt pos:start="47:33" pos:end="47:44"><expr pos:start="47:33" pos:end="47:43"><name pos:start="47:33" pos:end="47:34">i2</name> <operator pos:start="47:36" pos:end="47:36">=</operator> <operator pos:start="47:38" pos:end="47:38">(</operator><name pos:start="47:39" pos:end="47:39">i</name><operator pos:start="47:40" pos:end="47:41">&gt;=</operator><literal type="number" pos:start="47:42" pos:end="47:42">2</literal><operator pos:start="47:43" pos:end="47:43">)</operator></expr>;</expr_stmt>

                    <expr_stmt pos:start="49:21" pos:end="49:40"><expr pos:start="49:21" pos:end="49:39"><name pos:start="49:21" pos:end="49:22">rr</name> <operator pos:start="49:24" pos:end="49:24">=</operator> <name pos:start="49:26" pos:end="49:39"><name pos:start="49:26" pos:end="49:27">ir</name><index pos:start="49:28" pos:end="49:31">[<expr pos:start="49:29" pos:end="49:30"><name pos:start="49:29" pos:end="49:30">i2</name></expr>]</index><index pos:start="49:32" pos:end="49:39">[<expr pos:start="49:33" pos:end="49:38"><name pos:start="49:33" pos:end="49:34">i1</name><operator pos:start="49:35" pos:end="49:35">*</operator><literal type="number" pos:start="49:36" pos:end="49:37">3</literal><operator pos:start="49:37" pos:end="49:37">+</operator><literal type="number" pos:start="49:38" pos:end="49:38">0</literal></expr>]</index></name></expr>;</expr_stmt>

                    <expr_stmt pos:start="51:21" pos:end="51:40"><expr pos:start="51:21" pos:end="51:39"><name pos:start="51:21" pos:end="51:22">gg</name> <operator pos:start="51:24" pos:end="51:24">=</operator> <name pos:start="51:26" pos:end="51:39"><name pos:start="51:26" pos:end="51:27">ir</name><index pos:start="51:28" pos:end="51:31">[<expr pos:start="51:29" pos:end="51:30"><name pos:start="51:29" pos:end="51:30">i2</name></expr>]</index><index pos:start="51:32" pos:end="51:39">[<expr pos:start="51:33" pos:end="51:38"><name pos:start="51:33" pos:end="51:34">i1</name><operator pos:start="51:35" pos:end="51:35">*</operator><literal type="number" pos:start="51:36" pos:end="51:37">3</literal><operator pos:start="51:37" pos:end="51:37">+</operator><literal type="number" pos:start="51:38" pos:end="51:38">1</literal></expr>]</index></name></expr>;</expr_stmt>

                    <expr_stmt pos:start="53:21" pos:end="53:40"><expr pos:start="53:21" pos:end="53:39"><name pos:start="53:21" pos:end="53:22">bb</name> <operator pos:start="53:24" pos:end="53:24">=</operator> <name pos:start="53:26" pos:end="53:39"><name pos:start="53:26" pos:end="53:27">ir</name><index pos:start="53:28" pos:end="53:31">[<expr pos:start="53:29" pos:end="53:30"><name pos:start="53:29" pos:end="53:30">i2</name></expr>]</index><index pos:start="53:32" pos:end="53:39">[<expr pos:start="53:33" pos:end="53:38"><name pos:start="53:33" pos:end="53:34">i1</name><operator pos:start="53:35" pos:end="53:35">*</operator><literal type="number" pos:start="53:36" pos:end="53:37">3</literal><operator pos:start="53:37" pos:end="53:37">+</operator><literal type="number" pos:start="53:38" pos:end="53:38">2</literal></expr>]</index></name></expr>;</expr_stmt>

                    <expr_stmt pos:start="55:21" pos:end="55:28"><expr pos:start="55:21" pos:end="55:27"><name pos:start="55:21" pos:end="55:21">r</name> <operator pos:start="55:23" pos:end="55:24">+=</operator> <name pos:start="55:26" pos:end="55:27">rr</name></expr>;</expr_stmt> <expr_stmt pos:start="55:30" pos:end="55:37"><expr pos:start="55:30" pos:end="55:36"><name pos:start="55:30" pos:end="55:30">g</name> <operator pos:start="55:32" pos:end="55:33">+=</operator> <name pos:start="55:35" pos:end="55:36">gg</name></expr>;</expr_stmt> <expr_stmt pos:start="55:39" pos:end="55:46"><expr pos:start="55:39" pos:end="55:45"><name pos:start="55:39" pos:end="55:39">b</name> <operator pos:start="55:41" pos:end="55:42">+=</operator> <name pos:start="55:44" pos:end="55:45">bb</name></expr>;</expr_stmt>

<comment type="line" pos:start="57:1" pos:end="57:75">// using fixed point arithmetic for portable repeatability, scaling by 2^23</comment>

<comment type="line" pos:start="59:1" pos:end="59:6">// "Y"</comment>

<comment type="line" pos:start="61:1" pos:end="61:61">//                    rr = 0.2857*rr + 0.5714*gg + 0.1429*bb;</comment>

                    <expr_stmt pos:start="63:21" pos:end="63:70"><expr pos:start="63:21" pos:end="63:69"><name pos:start="63:21" pos:end="63:22">rr</name> <operator pos:start="63:24" pos:end="63:24">=</operator> <operator pos:start="63:26" pos:end="63:26">(</operator><literal type="number" pos:start="63:27" pos:end="63:33">2396625</literal><operator pos:start="63:34" pos:end="63:34">*</operator><name pos:start="63:35" pos:end="63:36">rr</name> <operator pos:start="63:38" pos:end="63:38">+</operator> <literal type="number" pos:start="63:40" pos:end="63:46">4793251</literal><operator pos:start="63:47" pos:end="63:47">*</operator><name pos:start="63:48" pos:end="63:49">gg</name> <operator pos:start="63:51" pos:end="63:51">+</operator> <literal type="number" pos:start="63:53" pos:end="63:59">1198732</literal><operator pos:start="63:60" pos:end="63:60">*</operator><name pos:start="63:61" pos:end="63:62">bb</name><operator pos:start="63:63" pos:end="63:63">)</operator> <operator pos:start="63:65" pos:end="63:66">&gt;&gt;</operator> <literal type="number" pos:start="63:68" pos:end="63:69">23</literal></expr>;</expr_stmt>

                    <if_stmt pos:start="65:21" pos:end="67:48"><if pos:start="65:21" pos:end="65:48">if<condition pos:start="65:23" pos:end="65:38">(      <expr pos:start="65:30" pos:end="65:37"><name pos:start="65:30" pos:end="65:31">rr</name> <operator pos:start="65:33" pos:end="65:33">&lt;</operator>   <literal type="number" pos:start="65:37" pos:end="65:37">0</literal></expr>)</condition><block type="pseudo" pos:start="65:40" pos:end="65:48"><block_content pos:start="65:40" pos:end="65:48"> <expr_stmt pos:start="65:40" pos:end="65:48"><expr pos:start="65:40" pos:end="65:47"><name pos:start="65:40" pos:end="65:41">rr</name> <operator pos:start="65:43" pos:end="65:43">=</operator>   <literal type="number" pos:start="65:47" pos:end="65:47">0</literal></expr>;</expr_stmt></block_content></block></if>

                    <if type="elseif" pos:start="67:21" pos:end="67:48">else if <condition pos:start="67:29" pos:end="67:38">(<expr pos:start="67:30" pos:end="67:37"><name pos:start="67:30" pos:end="67:31">rr</name> <operator pos:start="67:33" pos:end="67:33">&gt;</operator> <literal type="number" pos:start="67:35" pos:end="67:37">255</literal></expr>)</condition><block type="pseudo" pos:start="67:40" pos:end="67:48"><block_content pos:start="67:40" pos:end="67:48"> <expr_stmt pos:start="67:40" pos:end="67:48"><expr pos:start="67:40" pos:end="67:47"><name pos:start="67:40" pos:end="67:41">rr</name> <operator pos:start="67:43" pos:end="67:43">=</operator> <literal type="number" pos:start="67:45" pos:end="67:47">255</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>

                    <expr_stmt pos:start="69:21" pos:end="69:80"><expr pos:start="69:21" pos:end="69:79"><name pos:start="69:21" pos:end="69:74"><name pos:start="69:21" pos:end="69:32">scratch_pict</name><operator pos:start="69:33" pos:end="69:33">.</operator><name pos:start="69:34" pos:end="69:37">data</name><index pos:start="69:38" pos:end="69:40">[<expr pos:start="69:39" pos:end="69:39"><literal type="number" pos:start="69:39" pos:end="69:39">0</literal></expr>]</index><index pos:start="69:41" pos:end="69:74">[<expr pos:start="69:42" pos:end="69:73"><name pos:start="69:42" pos:end="69:43">i1</name> <operator pos:start="69:45" pos:end="69:45">+</operator> <name pos:start="69:47" pos:end="69:48">i2</name><operator pos:start="69:49" pos:end="69:49">*</operator><name pos:start="69:50" pos:end="69:73"><name pos:start="69:50" pos:end="69:61">scratch_pict</name><operator pos:start="69:62" pos:end="69:62">.</operator><name pos:start="69:63" pos:end="69:70">linesize</name><index pos:start="69:71" pos:end="69:73">[<expr pos:start="69:72" pos:end="69:72"><literal type="number" pos:start="69:72" pos:end="69:72">0</literal></expr>]</index></name></expr>]</index></name> <operator pos:start="69:76" pos:end="69:76">=</operator> <name pos:start="69:78" pos:end="69:79">rr</name></expr>;</expr_stmt>

                </block_content>}</block></for>

<comment type="line" pos:start="73:1" pos:end="73:40">// let us scale down as late as possible</comment>

<comment type="line" pos:start="75:1" pos:end="75:41">//                r /= 4; g /= 4; b /= 4;</comment>

<comment type="line" pos:start="77:1" pos:end="77:6">// "U"</comment>

<comment type="line" pos:start="79:1" pos:end="79:55">//                rr = -0.1429*r - 0.2857*g + 0.4286*b;</comment>

                <expr_stmt pos:start="81:17" pos:end="81:61"><expr pos:start="81:17" pos:end="81:60"><name pos:start="81:17" pos:end="81:18">rr</name> <operator pos:start="81:20" pos:end="81:20">=</operator> <operator pos:start="81:22" pos:end="81:22">(</operator><operator pos:start="81:23" pos:end="81:23">-</operator><literal type="number" pos:start="81:24" pos:end="81:29">299683</literal><operator pos:start="81:30" pos:end="81:30">*</operator><name pos:start="81:31" pos:end="81:31">r</name> <operator pos:start="81:33" pos:end="81:33">-</operator> <literal type="number" pos:start="81:35" pos:end="81:40">599156</literal><operator pos:start="81:41" pos:end="81:41">*</operator><name pos:start="81:42" pos:end="81:42">g</name> <operator pos:start="81:44" pos:end="81:44">+</operator> <literal type="number" pos:start="81:46" pos:end="81:51">898839</literal><operator pos:start="81:52" pos:end="81:52">*</operator><name pos:start="81:53" pos:end="81:53">b</name><operator pos:start="81:54" pos:end="81:54">)</operator> <operator pos:start="81:56" pos:end="81:57">&gt;&gt;</operator> <literal type="number" pos:start="81:59" pos:end="81:60">23</literal></expr>;</expr_stmt>

                <if_stmt pos:start="83:17" pos:end="85:46"><if pos:start="83:17" pos:end="83:46">if<condition pos:start="83:19" pos:end="83:35">(      <expr pos:start="83:26" pos:end="83:34"><name pos:start="83:26" pos:end="83:27">rr</name> <operator pos:start="83:29" pos:end="83:29">&lt;</operator> <operator pos:start="83:31" pos:end="83:31">-</operator><literal type="number" pos:start="83:32" pos:end="83:34">128</literal></expr>)</condition><block type="pseudo" pos:start="83:37" pos:end="83:46"><block_content pos:start="83:37" pos:end="83:46"> <expr_stmt pos:start="83:37" pos:end="83:46"><expr pos:start="83:37" pos:end="83:45"><name pos:start="83:37" pos:end="83:38">rr</name> <operator pos:start="83:40" pos:end="83:40">=</operator> <operator pos:start="83:42" pos:end="83:42">-</operator><literal type="number" pos:start="83:43" pos:end="83:45">128</literal></expr>;</expr_stmt></block_content></block></if>

                <if type="elseif" pos:start="85:17" pos:end="85:46">else if <condition pos:start="85:25" pos:end="85:35">(<expr pos:start="85:26" pos:end="85:34"><name pos:start="85:26" pos:end="85:27">rr</name> <operator pos:start="85:29" pos:end="85:29">&gt;</operator>  <literal type="number" pos:start="85:32" pos:end="85:34">127</literal></expr>)</condition><block type="pseudo" pos:start="85:37" pos:end="85:46"><block_content pos:start="85:37" pos:end="85:46"> <expr_stmt pos:start="85:37" pos:end="85:46"><expr pos:start="85:37" pos:end="85:45"><name pos:start="85:37" pos:end="85:38">rr</name> <operator pos:start="85:40" pos:end="85:40">=</operator>  <literal type="number" pos:start="85:43" pos:end="85:45">127</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>

                <expr_stmt pos:start="87:17" pos:end="87:51"><expr pos:start="87:17" pos:end="87:50"><name pos:start="87:17" pos:end="87:39"><name pos:start="87:17" pos:end="87:28">scratch_pict</name><operator pos:start="87:29" pos:end="87:29">.</operator><name pos:start="87:30" pos:end="87:33">data</name><index pos:start="87:34" pos:end="87:36">[<expr pos:start="87:35" pos:end="87:35"><literal type="number" pos:start="87:35" pos:end="87:35">1</literal></expr>]</index><index pos:start="87:37" pos:end="87:39">[<expr pos:start="87:38" pos:end="87:38"><literal type="number" pos:start="87:38" pos:end="87:38">0</literal></expr>]</index></name> <operator pos:start="87:41" pos:end="87:41">=</operator> <name pos:start="87:43" pos:end="87:44">rr</name> <operator pos:start="87:46" pos:end="87:46">+</operator> <literal type="number" pos:start="87:48" pos:end="87:50">128</literal></expr>;</expr_stmt> <comment type="line" pos:start="87:53" pos:end="87:78">// quantize needs unsigned</comment>

<comment type="line" pos:start="89:1" pos:end="89:6">// "V"</comment>

<comment type="line" pos:start="91:1" pos:end="91:54">//                rr = 0.3571*r - 0.2857*g - 0.0714*b;</comment>

                <expr_stmt pos:start="93:17" pos:end="93:60"><expr pos:start="93:17" pos:end="93:59"><name pos:start="93:17" pos:end="93:18">rr</name> <operator pos:start="93:20" pos:end="93:20">=</operator> <operator pos:start="93:22" pos:end="93:22">(</operator><literal type="number" pos:start="93:23" pos:end="93:28">748893</literal><operator pos:start="93:29" pos:end="93:29">*</operator><name pos:start="93:30" pos:end="93:30">r</name> <operator pos:start="93:32" pos:end="93:32">-</operator> <literal type="number" pos:start="93:34" pos:end="93:39">599156</literal><operator pos:start="93:40" pos:end="93:40">*</operator><name pos:start="93:41" pos:end="93:41">g</name> <operator pos:start="93:43" pos:end="93:43">-</operator> <literal type="number" pos:start="93:45" pos:end="93:50">149737</literal><operator pos:start="93:51" pos:end="93:51">*</operator><name pos:start="93:52" pos:end="93:52">b</name><operator pos:start="93:53" pos:end="93:53">)</operator> <operator pos:start="93:55" pos:end="93:56">&gt;&gt;</operator> <literal type="number" pos:start="93:58" pos:end="93:59">23</literal></expr>;</expr_stmt>

                <if_stmt pos:start="95:17" pos:end="97:46"><if pos:start="95:17" pos:end="95:46">if<condition pos:start="95:19" pos:end="95:35">(      <expr pos:start="95:26" pos:end="95:34"><name pos:start="95:26" pos:end="95:27">rr</name> <operator pos:start="95:29" pos:end="95:29">&lt;</operator> <operator pos:start="95:31" pos:end="95:31">-</operator><literal type="number" pos:start="95:32" pos:end="95:34">128</literal></expr>)</condition><block type="pseudo" pos:start="95:37" pos:end="95:46"><block_content pos:start="95:37" pos:end="95:46"> <expr_stmt pos:start="95:37" pos:end="95:46"><expr pos:start="95:37" pos:end="95:45"><name pos:start="95:37" pos:end="95:38">rr</name> <operator pos:start="95:40" pos:end="95:40">=</operator> <operator pos:start="95:42" pos:end="95:42">-</operator><literal type="number" pos:start="95:43" pos:end="95:45">128</literal></expr>;</expr_stmt></block_content></block></if>

                <if type="elseif" pos:start="97:17" pos:end="97:46">else if <condition pos:start="97:25" pos:end="97:35">(<expr pos:start="97:26" pos:end="97:34"><name pos:start="97:26" pos:end="97:27">rr</name> <operator pos:start="97:29" pos:end="97:29">&gt;</operator>  <literal type="number" pos:start="97:32" pos:end="97:34">127</literal></expr>)</condition><block type="pseudo" pos:start="97:37" pos:end="97:46"><block_content pos:start="97:37" pos:end="97:46"> <expr_stmt pos:start="97:37" pos:end="97:46"><expr pos:start="97:37" pos:end="97:45"><name pos:start="97:37" pos:end="97:38">rr</name> <operator pos:start="97:40" pos:end="97:40">=</operator>  <literal type="number" pos:start="97:43" pos:end="97:45">127</literal></expr>;</expr_stmt></block_content></block></if></if_stmt>

                <expr_stmt pos:start="99:17" pos:end="99:51"><expr pos:start="99:17" pos:end="99:50"><name pos:start="99:17" pos:end="99:39"><name pos:start="99:17" pos:end="99:28">scratch_pict</name><operator pos:start="99:29" pos:end="99:29">.</operator><name pos:start="99:30" pos:end="99:33">data</name><index pos:start="99:34" pos:end="99:36">[<expr pos:start="99:35" pos:end="99:35"><literal type="number" pos:start="99:35" pos:end="99:35">2</literal></expr>]</index><index pos:start="99:37" pos:end="99:39">[<expr pos:start="99:38" pos:end="99:38"><literal type="number" pos:start="99:38" pos:end="99:38">0</literal></expr>]</index></name> <operator pos:start="99:41" pos:end="99:41">=</operator> <name pos:start="99:43" pos:end="99:44">rr</name> <operator pos:start="99:46" pos:end="99:46">+</operator> <literal type="number" pos:start="99:48" pos:end="99:50">128</literal></expr>;</expr_stmt> <comment type="line" pos:start="99:53" pos:end="99:78">// quantize needs unsigned</comment>

            </block_content>}</block></for>

        </block_content>}</block></for>

    </block_content>}</block></if></if_stmt>



    <comment type="line" pos:start="109:5" pos:end="109:74">//would be nice but quite certainly incompatible with vintage players:</comment>

    <comment type="line" pos:start="111:5" pos:end="111:66">// support encoding zero strips (meaning skip the whole frame)</comment>

    <for pos:start="113:5" pos:end="239:5">for<control pos:start="113:8" pos:end="113:110">(<init pos:start="113:9" pos:end="113:35"><expr pos:start="113:9" pos:end="113:34"><name pos:start="113:9" pos:end="113:18">num_strips</name> <operator pos:start="113:20" pos:end="113:20">=</operator> <name pos:start="113:22" pos:end="113:34"><name pos:start="113:22" pos:end="113:22">s</name><operator pos:start="113:23" pos:end="113:24">-&gt;</operator><name pos:start="113:25" pos:end="113:34">min_strips</name></name></expr>;</init> <condition pos:start="113:37" pos:end="113:96"><expr pos:start="113:37" pos:end="113:95"><name pos:start="113:37" pos:end="113:46">num_strips</name> <operator pos:start="113:48" pos:end="113:49">&lt;=</operator> <name pos:start="113:51" pos:end="113:63"><name pos:start="113:51" pos:end="113:51">s</name><operator pos:start="113:52" pos:end="113:53">-&gt;</operator><name pos:start="113:54" pos:end="113:63">max_strips</name></name> <operator pos:start="113:65" pos:end="113:66">&amp;&amp;</operator> <name pos:start="113:68" pos:end="113:77">num_strips</name> <operator pos:start="113:79" pos:end="113:80">&lt;=</operator> <name pos:start="113:82" pos:end="113:85"><name pos:start="113:82" pos:end="113:82">s</name><operator pos:start="113:83" pos:end="113:84">-&gt;</operator><name pos:start="113:85" pos:end="113:85">h</name></name> <operator pos:start="113:87" pos:end="113:87">/</operator> <name pos:start="113:89" pos:end="113:95">MB_SIZE</name></expr>;</condition> <incr pos:start="113:98" pos:end="113:109"><expr pos:start="113:98" pos:end="113:109"><name pos:start="113:98" pos:end="113:107">num_strips</name><operator pos:start="113:108" pos:end="113:109">++</operator></expr></incr>)</control> <block pos:start="113:112" pos:end="239:5">{<block_content pos:start="115:9" pos:end="237:18">

        <expr_stmt pos:start="115:9" pos:end="115:18"><expr pos:start="115:9" pos:end="115:17"><name pos:start="115:9" pos:end="115:13">score</name> <operator pos:start="115:15" pos:end="115:15">=</operator> <literal type="number" pos:start="115:17" pos:end="115:17">0</literal></expr>;</expr_stmt>

        <expr_stmt pos:start="117:9" pos:end="120:0"><expr pos:start="117:9" pos:end="117:16"><name pos:start="117:9" pos:end="117:12">size</name> <operator pos:start="117:14" pos:end="117:14">=</operator> <literal type="number" pos:start="117:16" pos:end="117:16">0</literal></expr>;</expr_stmt>

<cpp:ifdef pos:start="119:1" pos:end="119:26">#<cpp:directive pos:start="119:2" pos:end="119:6">ifdef</cpp:directive> <name pos:start="119:8" pos:end="119:26">CINEPAK_REPORT_SERR</name></cpp:ifdef>

        <expr_stmt pos:start="121:9" pos:end="124:0"><expr pos:start="121:9" pos:end="121:16"><name pos:start="121:9" pos:end="121:12">serr</name> <operator pos:start="121:14" pos:end="121:14">=</operator> <literal type="number" pos:start="121:16" pos:end="121:16">0</literal></expr>;</expr_stmt>

<cpp:endif pos:start="123:1" pos:end="123:6">#<cpp:directive pos:start="123:2" pos:end="123:6">endif</cpp:directive></cpp:endif>



        <for pos:start="127:9" pos:end="197:9">for<control pos:start="127:12" pos:end="127:59">(<init pos:start="127:13" pos:end="127:29"><expr pos:start="127:13" pos:end="127:17"><name pos:start="127:13" pos:end="127:13">y</name> <operator pos:start="127:15" pos:end="127:15">=</operator> <literal type="number" pos:start="127:17" pos:end="127:17">0</literal></expr><operator pos:start="127:18" pos:end="127:18">,</operator> <expr pos:start="127:20" pos:end="127:28"><name pos:start="127:20" pos:end="127:24">strip</name> <operator pos:start="127:26" pos:end="127:26">=</operator> <literal type="number" pos:start="127:28" pos:end="127:28">1</literal></expr>;</init> <condition pos:start="127:31" pos:end="127:39"><expr pos:start="127:31" pos:end="127:38"><name pos:start="127:31" pos:end="127:31">y</name> <operator pos:start="127:33" pos:end="127:33">&lt;</operator> <name pos:start="127:35" pos:end="127:38"><name pos:start="127:35" pos:end="127:35">s</name><operator pos:start="127:36" pos:end="127:37">-&gt;</operator><name pos:start="127:38" pos:end="127:38">h</name></name></expr>;</condition> <incr pos:start="127:41" pos:end="127:58"><expr pos:start="127:41" pos:end="127:47"><name pos:start="127:41" pos:end="127:45">strip</name><operator pos:start="127:46" pos:end="127:47">++</operator></expr><operator pos:start="127:48" pos:end="127:48">,</operator> <expr pos:start="127:50" pos:end="127:58"><name pos:start="127:50" pos:end="127:50">y</name> <operator pos:start="127:52" pos:end="127:52">=</operator> <name pos:start="127:54" pos:end="127:58">nexty</name></expr></incr>)</control> <block pos:start="127:61" pos:end="197:9">{<block_content pos:start="129:13" pos:end="191:30">

            <decl_stmt pos:start="129:13" pos:end="129:29"><decl pos:start="129:13" pos:end="129:28"><type pos:start="129:13" pos:end="129:15"><name pos:start="129:13" pos:end="129:15">int</name></type> <name pos:start="129:17" pos:end="129:28">strip_height</name></decl>;</decl_stmt>



            <expr_stmt pos:start="133:13" pos:end="133:46"><expr pos:start="133:13" pos:end="133:45"><name pos:start="133:13" pos:end="133:17">nexty</name> <operator pos:start="133:19" pos:end="133:19">=</operator> <name pos:start="133:21" pos:end="133:25">strip</name> <operator pos:start="133:27" pos:end="133:27">*</operator> <name pos:start="133:29" pos:end="133:32"><name pos:start="133:29" pos:end="133:29">s</name><operator pos:start="133:30" pos:end="133:31">-&gt;</operator><name pos:start="133:32" pos:end="133:32">h</name></name> <operator pos:start="133:34" pos:end="133:34">/</operator> <name pos:start="133:36" pos:end="133:45">num_strips</name></expr>;</expr_stmt> <comment type="line" pos:start="133:48" pos:end="133:57">// &lt;= s-&gt;h</comment>

            <comment type="line" pos:start="135:13" pos:end="135:68">//make nexty the next multiple of 4 if not already there</comment>

            <if_stmt pos:start="137:13" pos:end="139:41"><if pos:start="137:13" pos:end="139:41">if<condition pos:start="137:15" pos:end="137:25">(<expr pos:start="137:16" pos:end="137:24"><name pos:start="137:16" pos:end="137:20">nexty</name> <operator pos:start="137:22" pos:end="137:22">&amp;</operator> <literal type="number" pos:start="137:24" pos:end="137:24">3</literal></expr>)</condition><block type="pseudo" pos:start="139:17" pos:end="139:41"><block_content pos:start="139:17" pos:end="139:41">

                <expr_stmt pos:start="139:17" pos:end="139:41"><expr pos:start="139:17" pos:end="139:40"><name pos:start="139:17" pos:end="139:21">nexty</name> <operator pos:start="139:23" pos:end="139:24">+=</operator> <literal type="number" pos:start="139:26" pos:end="139:28">4</literal> <operator pos:start="139:28" pos:end="139:28">-</operator> <operator pos:start="139:30" pos:end="139:30">(</operator><name pos:start="139:31" pos:end="139:35">nexty</name> <operator pos:start="139:37" pos:end="139:37">&amp;</operator> <literal type="number" pos:start="139:39" pos:end="139:39">3</literal><operator pos:start="139:40" pos:end="139:40">)</operator></expr>;</expr_stmt></block_content></block></if></if_stmt>



            <expr_stmt pos:start="143:13" pos:end="143:37"><expr pos:start="143:13" pos:end="143:36"><name pos:start="143:13" pos:end="143:24">strip_height</name> <operator pos:start="143:26" pos:end="143:26">=</operator> <name pos:start="143:28" pos:end="143:32">nexty</name> <operator pos:start="143:34" pos:end="143:34">-</operator> <name pos:start="143:36" pos:end="143:36">y</name></expr>;</expr_stmt>

            <if_stmt pos:start="145:13" pos:end="151:13"><if pos:start="145:13" pos:end="151:13">if<condition pos:start="145:15" pos:end="145:33">(<expr pos:start="145:16" pos:end="145:32"><name pos:start="145:16" pos:end="145:27">strip_height</name> <operator pos:start="145:29" pos:end="145:30">&lt;=</operator> <literal type="number" pos:start="145:32" pos:end="145:32">0</literal></expr>)</condition> <block pos:start="145:35" pos:end="151:13">{<block_content pos:start="147:17" pos:end="149:25"> <comment type="line" pos:start="145:37" pos:end="145:60">// can this ever happen?</comment>

                <expr_stmt pos:start="147:17" pos:end="147:106"><expr pos:start="147:17" pos:end="147:105"><call pos:start="147:17" pos:end="147:105"><name pos:start="147:17" pos:end="147:22">av_log</name><argument_list pos:start="147:23" pos:end="147:105">(<argument pos:start="147:24" pos:end="147:31"><expr pos:start="147:24" pos:end="147:31"><name pos:start="147:24" pos:end="147:31"><name pos:start="147:24" pos:end="147:24">s</name><operator pos:start="147:25" pos:end="147:26">-&gt;</operator><name pos:start="147:27" pos:end="147:31">avctx</name></name></expr></argument>, <argument pos:start="147:34" pos:end="147:44"><expr pos:start="147:34" pos:end="147:44"><name pos:start="147:34" pos:end="147:44">AV_LOG_INFO</name></expr></argument>, <argument pos:start="147:47" pos:end="147:85"><expr pos:start="147:47" pos:end="147:85"><literal type="string" pos:start="147:47" pos:end="147:85">"skipping zero height strip %i of %i\n"</literal></expr></argument>, <argument pos:start="147:88" pos:end="147:92"><expr pos:start="147:88" pos:end="147:92"><name pos:start="147:88" pos:end="147:92">strip</name></expr></argument>, <argument pos:start="147:95" pos:end="147:104"><expr pos:start="147:95" pos:end="147:104"><name pos:start="147:95" pos:end="147:104">num_strips</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

                <continue pos:start="149:17" pos:end="149:25">continue;</continue>

            </block_content>}</block></if></if_stmt>



            <if_stmt pos:start="155:13" pos:end="161:80"><if pos:start="155:13" pos:end="157:79">if<condition pos:start="155:15" pos:end="155:46">(<expr pos:start="155:16" pos:end="155:45"><name pos:start="155:16" pos:end="155:25"><name pos:start="155:16" pos:end="155:16">s</name><operator pos:start="155:17" pos:end="155:18">-&gt;</operator><name pos:start="155:19" pos:end="155:25">pix_fmt</name></name> <operator pos:start="155:27" pos:end="155:28">==</operator> <name pos:start="155:30" pos:end="155:45">AV_PIX_FMT_RGB24</name></expr>)</condition><block type="pseudo" pos:start="157:17" pos:end="157:79"><block_content pos:start="157:17" pos:end="157:79">

                <expr_stmt pos:start="157:17" pos:end="157:79"><expr pos:start="157:17" pos:end="157:78"><call pos:start="157:17" pos:end="157:78"><name pos:start="157:17" pos:end="157:31">get_sub_picture</name><argument_list pos:start="157:32" pos:end="157:78">(<argument pos:start="157:33" pos:end="157:33"><expr pos:start="157:33" pos:end="157:33"><name pos:start="157:33" pos:end="157:33">s</name></expr></argument>, <argument pos:start="157:36" pos:end="157:36"><expr pos:start="157:36" pos:end="157:36"><literal type="number" pos:start="157:36" pos:end="157:36">0</literal></expr></argument>, <argument pos:start="157:39" pos:end="157:39"><expr pos:start="157:39" pos:end="157:39"><name pos:start="157:39" pos:end="157:39">y</name></expr></argument>, <argument pos:start="157:42" pos:end="157:67"><expr pos:start="157:42" pos:end="157:67"><operator pos:start="157:42" pos:end="157:42">(</operator><name pos:start="157:43" pos:end="157:51">AVPicture</name><operator pos:start="157:52" pos:end="157:52">*</operator><operator pos:start="157:53" pos:end="157:53">)</operator><name pos:start="157:54" pos:end="157:67"><name pos:start="157:54" pos:end="157:54">s</name><operator pos:start="157:55" pos:end="157:56">-&gt;</operator><name pos:start="157:57" pos:end="157:67">input_frame</name></name></expr></argument>,    <argument pos:start="157:73" pos:end="157:77"><expr pos:start="157:73" pos:end="157:77"><operator pos:start="157:73" pos:end="157:73">&amp;</operator><name pos:start="157:74" pos:end="157:77">pict</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></if>

            <else pos:start="159:13" pos:end="161:80">else<block type="pseudo" pos:start="161:17" pos:end="161:80"><block_content pos:start="161:17" pos:end="161:80">

                <expr_stmt pos:start="161:17" pos:end="161:80"><expr pos:start="161:17" pos:end="161:79"><call pos:start="161:17" pos:end="161:79"><name pos:start="161:17" pos:end="161:31">get_sub_picture</name><argument_list pos:start="161:32" pos:end="161:79">(<argument pos:start="161:33" pos:end="161:33"><expr pos:start="161:33" pos:end="161:33"><name pos:start="161:33" pos:end="161:33">s</name></expr></argument>, <argument pos:start="161:36" pos:end="161:36"><expr pos:start="161:36" pos:end="161:36"><literal type="number" pos:start="161:36" pos:end="161:36">0</literal></expr></argument>, <argument pos:start="161:39" pos:end="161:39"><expr pos:start="161:39" pos:end="161:39"><name pos:start="161:39" pos:end="161:39">y</name></expr></argument>, <argument pos:start="161:42" pos:end="161:58"><expr pos:start="161:42" pos:end="161:58"><operator pos:start="161:42" pos:end="161:42">(</operator><name pos:start="161:43" pos:end="161:51">AVPicture</name><operator pos:start="161:52" pos:end="161:52">*</operator><operator pos:start="161:53" pos:end="161:53">)</operator><name pos:start="161:54" pos:end="161:58">frame</name></expr></argument>,              <argument pos:start="161:74" pos:end="161:78"><expr pos:start="161:74" pos:end="161:78"><operator pos:start="161:74" pos:end="161:74">&amp;</operator><name pos:start="161:75" pos:end="161:78">pict</name></expr></argument>)</argument_list></call></expr>;</expr_stmt></block_content></block></else></if_stmt>

            <expr_stmt pos:start="163:13" pos:end="163:79"><expr pos:start="163:13" pos:end="163:78"><call pos:start="163:13" pos:end="163:78"><name pos:start="163:13" pos:end="163:27">get_sub_picture</name><argument_list pos:start="163:28" pos:end="163:78">(<argument pos:start="163:29" pos:end="163:29"><expr pos:start="163:29" pos:end="163:29"><name pos:start="163:29" pos:end="163:29">s</name></expr></argument>, <argument pos:start="163:32" pos:end="163:32"><expr pos:start="163:32" pos:end="163:32"><literal type="number" pos:start="163:32" pos:end="163:32">0</literal></expr></argument>, <argument pos:start="163:35" pos:end="163:35"><expr pos:start="163:35" pos:end="163:35"><name pos:start="163:35" pos:end="163:35">y</name></expr></argument>, <argument pos:start="163:38" pos:end="163:62"><expr pos:start="163:38" pos:end="163:62"><operator pos:start="163:38" pos:end="163:38">(</operator><name pos:start="163:39" pos:end="163:47">AVPicture</name><operator pos:start="163:48" pos:end="163:48">*</operator><operator pos:start="163:49" pos:end="163:49">)</operator><name pos:start="163:50" pos:end="163:62"><name pos:start="163:50" pos:end="163:50">s</name><operator pos:start="163:51" pos:end="163:52">-&gt;</operator><name pos:start="163:53" pos:end="163:62">last_frame</name></name></expr></argument>,    <argument pos:start="163:68" pos:end="163:77"><expr pos:start="163:68" pos:end="163:77"><operator pos:start="163:68" pos:end="163:68">&amp;</operator><name pos:start="163:69" pos:end="163:77">last_pict</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt pos:start="165:13" pos:end="165:82"><expr pos:start="165:13" pos:end="165:81"><call pos:start="165:13" pos:end="165:81"><name pos:start="165:13" pos:end="165:27">get_sub_picture</name><argument_list pos:start="165:28" pos:end="165:81">(<argument pos:start="165:29" pos:end="165:29"><expr pos:start="165:29" pos:end="165:29"><name pos:start="165:29" pos:end="165:29">s</name></expr></argument>, <argument pos:start="165:32" pos:end="165:32"><expr pos:start="165:32" pos:end="165:32"><literal type="number" pos:start="165:32" pos:end="165:32">0</literal></expr></argument>, <argument pos:start="165:35" pos:end="165:35"><expr pos:start="165:35" pos:end="165:35"><name pos:start="165:35" pos:end="165:35">y</name></expr></argument>, <argument pos:start="165:38" pos:end="165:65"><expr pos:start="165:38" pos:end="165:65"><operator pos:start="165:38" pos:end="165:38">(</operator><name pos:start="165:39" pos:end="165:47">AVPicture</name><operator pos:start="165:48" pos:end="165:48">*</operator><operator pos:start="165:49" pos:end="165:49">)</operator><name pos:start="165:50" pos:end="165:65"><name pos:start="165:50" pos:end="165:50">s</name><operator pos:start="165:51" pos:end="165:52">-&gt;</operator><name pos:start="165:53" pos:end="165:65">scratch_frame</name></name></expr></argument>, <argument pos:start="165:68" pos:end="165:80"><expr pos:start="165:68" pos:end="165:80"><operator pos:start="165:68" pos:end="165:68">&amp;</operator><name pos:start="165:69" pos:end="165:80">scratch_pict</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>



            <if_stmt pos:start="169:13" pos:end="179:33"><if pos:start="169:13" pos:end="179:33">if<condition pos:start="169:15" pos:end="177:7">(<expr pos:start="169:16" pos:end="177:6"><operator pos:start="169:16" pos:end="169:16">(</operator><name pos:start="169:17" pos:end="169:25">temp_size</name> <operator pos:start="169:27" pos:end="169:27">=</operator> <call pos:start="169:29" pos:end="177:1"><name pos:start="169:29" pos:end="169:36">rd_strip</name><argument_list pos:start="169:37" pos:end="177:1">(<argument pos:start="169:38" pos:end="169:38"><expr pos:start="169:38" pos:end="169:38"><name pos:start="169:38" pos:end="169:38">s</name></expr></argument>, <argument pos:start="169:41" pos:end="169:41"><expr pos:start="169:41" pos:end="169:41"><name pos:start="169:41" pos:end="169:41">y</name></expr></argument>, <argument pos:start="169:44" pos:end="169:55"><expr pos:start="169:44" pos:end="169:55"><name pos:start="169:44" pos:end="169:55">strip_height</name></expr></argument>, <argument pos:start="169:58" pos:end="169:68"><expr pos:start="169:58" pos:end="169:68"><name pos:start="169:58" pos:end="169:68">isakeyframe</name></expr></argument>, <argument pos:start="169:71" pos:end="169:80"><expr pos:start="169:71" pos:end="169:80"><operator pos:start="169:71" pos:end="169:71">&amp;</operator><name pos:start="169:72" pos:end="169:80">last_pict</name></expr></argument>, <argument pos:start="169:83" pos:end="169:87"><expr pos:start="169:83" pos:end="169:87"><operator pos:start="169:83" pos:end="169:83">&amp;</operator><name pos:start="169:84" pos:end="169:87">pict</name></expr></argument>, <argument pos:start="169:90" pos:end="169:102"><expr pos:start="169:90" pos:end="169:102"><operator pos:start="169:90" pos:end="169:90">&amp;</operator><name pos:start="169:91" pos:end="169:102">scratch_pict</name></expr></argument>, <argument pos:start="169:105" pos:end="169:142"><expr pos:start="169:105" pos:end="169:142"><name pos:start="169:105" pos:end="169:116"><name pos:start="169:105" pos:end="169:105">s</name><operator pos:start="169:106" pos:end="169:107">-&gt;</operator><name pos:start="169:108" pos:end="169:116">frame_buf</name></name> <operator pos:start="169:118" pos:end="169:118">+</operator> <name pos:start="169:120" pos:end="169:123">size</name> <operator pos:start="169:125" pos:end="169:125">+</operator> <name pos:start="169:127" pos:end="169:142">CVID_HEADER_SIZE</name></expr></argument>, <argument pos:start="169:145" pos:end="172:0"><expr pos:start="169:145" pos:end="172:0"><operator pos:start="169:145" pos:end="169:145">&amp;</operator><name pos:start="169:146" pos:end="172:0">score_temp</name></expr></argument>

<cpp:ifdef pos:start="171:1" pos:end="171:26">#<cpp:directive pos:start="171:2" pos:end="171:6">ifdef</cpp:directive> <name pos:start="171:8" pos:end="171:26">CINEPAK_REPORT_SERR</name></cpp:ifdef>

, <argument pos:start="173:3" pos:end="176:0"><expr pos:start="173:3" pos:end="176:0"><operator pos:start="173:3" pos:end="173:3">&amp;</operator><name pos:start="173:4" pos:end="176:0">serr_temp</name></expr></argument>

<cpp:endif pos:start="175:1" pos:end="175:6">#<cpp:directive pos:start="175:2" pos:end="175:6">endif</cpp:directive></cpp:endif>

)</argument_list></call><operator pos:start="177:2" pos:end="177:2">)</operator> <operator pos:start="177:4" pos:end="177:4">&lt;</operator> <literal type="number" pos:start="177:6" pos:end="177:6">0</literal></expr>)</condition><block type="pseudo" pos:start="179:17" pos:end="179:33"><block_content pos:start="179:17" pos:end="179:33">

                <return pos:start="179:17" pos:end="179:33">return <expr pos:start="179:24" pos:end="179:32"><name pos:start="179:24" pos:end="179:32">temp_size</name></expr>;</return></block_content></block></if></if_stmt>



            <expr_stmt pos:start="183:13" pos:end="186:0"><expr pos:start="183:13" pos:end="183:31"><name pos:start="183:13" pos:end="183:17">score</name> <operator pos:start="183:19" pos:end="183:20">+=</operator> <name pos:start="183:22" pos:end="183:31">score_temp</name></expr>;</expr_stmt>

<cpp:ifdef pos:start="185:1" pos:end="185:26">#<cpp:directive pos:start="185:2" pos:end="185:6">ifdef</cpp:directive> <name pos:start="185:8" pos:end="185:26">CINEPAK_REPORT_SERR</name></cpp:ifdef>

            <expr_stmt pos:start="187:13" pos:end="190:0"><expr pos:start="187:13" pos:end="187:29"><name pos:start="187:13" pos:end="187:16">serr</name> <operator pos:start="187:18" pos:end="187:19">+=</operator> <name pos:start="187:21" pos:end="187:29">serr_temp</name></expr>;</expr_stmt>

<cpp:endif pos:start="189:1" pos:end="189:6">#<cpp:directive pos:start="189:2" pos:end="189:6">endif</cpp:directive></cpp:endif>

            <expr_stmt pos:start="191:13" pos:end="191:30"><expr pos:start="191:13" pos:end="191:29"><name pos:start="191:13" pos:end="191:16">size</name> <operator pos:start="191:18" pos:end="191:19">+=</operator> <name pos:start="191:21" pos:end="191:29">temp_size</name></expr>;</expr_stmt>

            <comment type="line" pos:start="193:13" pos:end="193:92">//av_log(s-&gt;avctx, AV_LOG_INFO, "strip %d, isakeyframe=%d", strip, isakeyframe);</comment>

            <comment type="line" pos:start="195:13" pos:end="195:50">//av_log(s-&gt;avctx, AV_LOG_INFO, "\n");</comment>

        </block_content>}</block></for>



        <if_stmt pos:start="201:9" pos:end="229:9"><if pos:start="201:9" pos:end="229:9">if<condition pos:start="201:11" pos:end="201:49">(<expr pos:start="201:12" pos:end="201:48"><name pos:start="201:12" pos:end="201:21">best_score</name> <operator pos:start="201:23" pos:end="201:24">==</operator> <literal type="number" pos:start="201:26" pos:end="201:26">0</literal> <operator pos:start="201:28" pos:end="201:29">||</operator> <name pos:start="201:31" pos:end="201:35">score</name> <operator pos:start="201:37" pos:end="201:37">&lt;</operator> <name pos:start="201:39" pos:end="201:48">best_score</name></expr>)</condition> <block pos:start="201:51" pos:end="229:9">{<block_content pos:start="203:13" pos:end="227:38">

            <expr_stmt pos:start="203:13" pos:end="206:0"><expr pos:start="203:13" pos:end="203:30"><name pos:start="203:13" pos:end="203:22">best_score</name> <operator pos:start="203:24" pos:end="203:24">=</operator> <name pos:start="203:26" pos:end="203:30">score</name></expr>;</expr_stmt>

<cpp:ifdef pos:start="205:1" pos:end="205:26">#<cpp:directive pos:start="205:2" pos:end="205:6">ifdef</cpp:directive> <name pos:start="205:8" pos:end="205:26">CINEPAK_REPORT_SERR</name></cpp:ifdef>

            <expr_stmt pos:start="207:13" pos:end="210:0"><expr pos:start="207:13" pos:end="207:28"><name pos:start="207:13" pos:end="207:21">best_serr</name> <operator pos:start="207:23" pos:end="207:23">=</operator> <name pos:start="207:25" pos:end="207:28">serr</name></expr>;</expr_stmt>

<cpp:endif pos:start="209:1" pos:end="209:6">#<cpp:directive pos:start="209:2" pos:end="209:6">endif</cpp:directive></cpp:endif>

            <expr_stmt pos:start="211:13" pos:end="216:0"><expr pos:start="211:13" pos:end="211:96"><name pos:start="211:13" pos:end="211:21">best_size</name> <operator pos:start="211:23" pos:end="211:23">=</operator> <name pos:start="211:25" pos:end="211:28">size</name> <operator pos:start="211:30" pos:end="211:30">+</operator> <call pos:start="211:32" pos:end="211:96"><name pos:start="211:32" pos:end="211:48">write_cvid_header</name><argument_list pos:start="211:49" pos:end="211:96">(<argument pos:start="211:50" pos:end="211:50"><expr pos:start="211:50" pos:end="211:50"><name pos:start="211:50" pos:end="211:50">s</name></expr></argument>, <argument pos:start="211:53" pos:end="211:64"><expr pos:start="211:53" pos:end="211:64"><name pos:start="211:53" pos:end="211:64"><name pos:start="211:53" pos:end="211:53">s</name><operator pos:start="211:54" pos:end="211:55">-&gt;</operator><name pos:start="211:56" pos:end="211:64">frame_buf</name></name></expr></argument>, <argument pos:start="211:67" pos:end="211:76"><expr pos:start="211:67" pos:end="211:76"><name pos:start="211:67" pos:end="211:76">num_strips</name></expr></argument>, <argument pos:start="211:79" pos:end="211:82"><expr pos:start="211:79" pos:end="211:82"><name pos:start="211:79" pos:end="211:82">size</name></expr></argument>, <argument pos:start="211:85" pos:end="211:95"><expr pos:start="211:85" pos:end="211:95"><name pos:start="211:85" pos:end="211:95">isakeyframe</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <comment type="line" pos:start="213:13" pos:end="213:142">//av_log(s-&gt;avctx, AV_LOG_INFO, "best number of strips so far: %2i, %12lli, %i B\n", num_strips, (long long int)score, best_size);</comment>

<cpp:ifdef pos:start="215:1" pos:end="215:26">#<cpp:directive pos:start="215:2" pos:end="215:6">ifdef</cpp:directive> <name pos:start="215:8" pos:end="215:26">CINEPAK_REPORT_SERR</name></cpp:ifdef>

            <expr_stmt pos:start="217:13" pos:end="220:0"><expr pos:start="217:13" pos:end="217:138"><call pos:start="217:13" pos:end="217:138"><name pos:start="217:13" pos:end="217:18">av_log</name><argument_list pos:start="217:19" pos:end="217:138">(<argument pos:start="217:20" pos:end="217:27"><expr pos:start="217:20" pos:end="217:27"><name pos:start="217:20" pos:end="217:27"><name pos:start="217:20" pos:end="217:20">s</name><operator pos:start="217:21" pos:end="217:22">-&gt;</operator><name pos:start="217:23" pos:end="217:27">avctx</name></name></expr></argument>, <argument pos:start="217:30" pos:end="217:40"><expr pos:start="217:30" pos:end="217:40"><name pos:start="217:30" pos:end="217:40">AV_LOG_INFO</name></expr></argument>, <argument pos:start="217:43" pos:end="217:93"><expr pos:start="217:43" pos:end="217:93"><literal type="string" pos:start="217:43" pos:end="217:93">"best number of strips so far: %2i, %12lli, %i B\n"</literal></expr></argument>, <argument pos:start="217:96" pos:end="217:105"><expr pos:start="217:96" pos:end="217:105"><name pos:start="217:96" pos:end="217:105">num_strips</name></expr></argument>, <argument pos:start="217:108" pos:end="217:126"><expr pos:start="217:108" pos:end="217:126"><operator pos:start="217:108" pos:end="217:108">(</operator><name pos:start="217:109" pos:end="217:112">long</name> <name pos:start="217:114" pos:end="217:117">long</name> <name pos:start="217:119" pos:end="217:121">int</name><operator pos:start="217:122" pos:end="217:122">)</operator><name pos:start="217:123" pos:end="217:126">serr</name></expr></argument>, <argument pos:start="217:129" pos:end="217:137"><expr pos:start="217:129" pos:end="217:137"><name pos:start="217:129" pos:end="217:137">best_size</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

<cpp:endif pos:start="219:1" pos:end="219:6">#<cpp:directive pos:start="219:2" pos:end="219:6">endif</cpp:directive></cpp:endif>



            <expr_stmt pos:start="223:13" pos:end="223:63"><expr pos:start="223:13" pos:end="223:62"><call pos:start="223:13" pos:end="223:62"><name pos:start="223:13" pos:end="223:18">FFSWAP</name><argument_list pos:start="223:19" pos:end="223:62">(<argument pos:start="223:20" pos:end="223:28"><expr pos:start="223:20" pos:end="223:28"><name pos:start="223:20" pos:end="223:26">AVFrame</name> <operator pos:start="223:28" pos:end="223:28">*</operator></expr></argument>, <argument pos:start="223:31" pos:end="223:43"><expr pos:start="223:31" pos:end="223:43"><name pos:start="223:31" pos:end="223:43"><name pos:start="223:31" pos:end="223:31">s</name><operator pos:start="223:32" pos:end="223:33">-&gt;</operator><name pos:start="223:34" pos:end="223:43">best_frame</name></name></expr></argument>, <argument pos:start="223:46" pos:end="223:61"><expr pos:start="223:46" pos:end="223:61"><name pos:start="223:46" pos:end="223:61"><name pos:start="223:46" pos:end="223:46">s</name><operator pos:start="223:47" pos:end="223:48">-&gt;</operator><name pos:start="223:49" pos:end="223:61">scratch_frame</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt pos:start="225:13" pos:end="225:49"><expr pos:start="225:13" pos:end="225:48"><call pos:start="225:13" pos:end="225:48"><name pos:start="225:13" pos:end="225:18">memcpy</name><argument_list pos:start="225:19" pos:end="225:48">(<argument pos:start="225:20" pos:end="225:22"><expr pos:start="225:20" pos:end="225:22"><name pos:start="225:20" pos:end="225:22">buf</name></expr></argument>, <argument pos:start="225:25" pos:end="225:36"><expr pos:start="225:25" pos:end="225:36"><name pos:start="225:25" pos:end="225:36"><name pos:start="225:25" pos:end="225:25">s</name><operator pos:start="225:26" pos:end="225:27">-&gt;</operator><name pos:start="225:28" pos:end="225:36">frame_buf</name></name></expr></argument>, <argument pos:start="225:39" pos:end="225:47"><expr pos:start="225:39" pos:end="225:47"><name pos:start="225:39" pos:end="225:47">best_size</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt pos:start="227:13" pos:end="227:38"><expr pos:start="227:13" pos:end="227:37"><name pos:start="227:13" pos:end="227:24">best_nstrips</name> <operator pos:start="227:26" pos:end="227:26">=</operator> <name pos:start="227:28" pos:end="227:37">num_strips</name></expr>;</expr_stmt>

        </block_content>}</block></if></if_stmt>

<comment type="line" pos:start="231:1" pos:end="231:60">// avoid trying too many strip numbers without a real reason</comment>

<comment type="line" pos:start="233:1" pos:end="233:61">// (this makes the processing of the very first frame faster)</comment>

        <if_stmt pos:start="235:9" pos:end="237:18"><if pos:start="235:9" pos:end="237:18">if<condition pos:start="235:11" pos:end="235:41">(<expr pos:start="235:12" pos:end="235:40"><name pos:start="235:12" pos:end="235:21">num_strips</name> <operator pos:start="235:23" pos:end="235:23">-</operator> <name pos:start="235:25" pos:end="235:36">best_nstrips</name> <operator pos:start="235:38" pos:end="235:38">&gt;</operator> <literal type="number" pos:start="235:40" pos:end="235:40">4</literal></expr>)</condition><block type="pseudo" pos:start="237:13" pos:end="237:18"><block_content pos:start="237:13" pos:end="237:18">

            <break pos:start="237:13" pos:end="237:18">break;</break></block_content></block></if></if_stmt>

    </block_content>}</block></for>



<comment type="line" pos:start="243:1" pos:end="243:72">// let the number of strips slowly adapt to the changes in the contents,</comment>

<comment type="line" pos:start="245:1" pos:end="245:71">// compared to full bruteforcing every time this will occasionally lead</comment>

<comment type="line" pos:start="247:1" pos:end="247:77">// to some r/d performance loss but makes encoding up to several times faster</comment>

    <if_stmt pos:start="249:5" pos:end="285:5"><if pos:start="249:5" pos:end="271:5">if<condition pos:start="249:7" pos:end="249:36">(<expr pos:start="249:8" pos:end="249:35"><operator pos:start="249:8" pos:end="249:8">!</operator><name pos:start="249:9" pos:end="249:35"><name pos:start="249:9" pos:end="249:9">s</name><operator pos:start="249:10" pos:end="249:11">-&gt;</operator><name pos:start="249:12" pos:end="249:35">strip_number_delta_range</name></name></expr>)</condition> <block pos:start="249:38" pos:end="271:5">{<block_content pos:start="251:9" pos:end="269:46">

        <if_stmt pos:start="251:9" pos:end="263:9"><if pos:start="251:9" pos:end="259:9">if<condition pos:start="251:11" pos:end="251:41">(<expr pos:start="251:12" pos:end="251:40"><name pos:start="251:12" pos:end="251:23">best_nstrips</name> <operator pos:start="251:25" pos:end="251:26">==</operator> <name pos:start="251:28" pos:end="251:40"><name pos:start="251:28" pos:end="251:28">s</name><operator pos:start="251:29" pos:end="251:30">-&gt;</operator><name pos:start="251:31" pos:end="251:40">max_strips</name></name></expr>)</condition> <block pos:start="251:43" pos:end="259:9">{<block_content pos:start="253:13" pos:end="257:50"> <comment type="line" pos:start="251:45" pos:end="251:68">// let us try to step up</comment>

            <expr_stmt pos:start="253:13" pos:end="253:45"><expr pos:start="253:13" pos:end="253:44"><name pos:start="253:13" pos:end="253:25"><name pos:start="253:13" pos:end="253:13">s</name><operator pos:start="253:14" pos:end="253:15">-&gt;</operator><name pos:start="253:16" pos:end="253:25">max_strips</name></name> <operator pos:start="253:27" pos:end="253:27">=</operator> <name pos:start="253:29" pos:end="253:40">best_nstrips</name> <operator pos:start="253:42" pos:end="253:42">+</operator> <literal type="number" pos:start="253:44" pos:end="253:44">1</literal></expr>;</expr_stmt>

            <if_stmt pos:start="255:13" pos:end="257:50"><if pos:start="255:13" pos:end="257:50">if<condition pos:start="255:15" pos:end="255:50">(<expr pos:start="255:16" pos:end="255:49"><name pos:start="255:16" pos:end="255:28"><name pos:start="255:16" pos:end="255:16">s</name><operator pos:start="255:17" pos:end="255:18">-&gt;</operator><name pos:start="255:19" pos:end="255:28">max_strips</name></name> <operator pos:start="255:30" pos:end="255:31">&gt;=</operator> <name pos:start="255:33" pos:end="255:49"><name pos:start="255:33" pos:end="255:33">s</name><operator pos:start="255:34" pos:end="255:35">-&gt;</operator><name pos:start="255:36" pos:end="255:49">max_max_strips</name></name></expr>)</condition><block type="pseudo" pos:start="257:17" pos:end="257:50"><block_content pos:start="257:17" pos:end="257:50">

                <expr_stmt pos:start="257:17" pos:end="257:50"><expr pos:start="257:17" pos:end="257:49"><name pos:start="257:17" pos:end="257:29"><name pos:start="257:17" pos:end="257:17">s</name><operator pos:start="257:18" pos:end="257:19">-&gt;</operator><name pos:start="257:20" pos:end="257:29">max_strips</name></name> <operator pos:start="257:31" pos:end="257:31">=</operator> <name pos:start="257:33" pos:end="257:49"><name pos:start="257:33" pos:end="257:33">s</name><operator pos:start="257:34" pos:end="257:35">-&gt;</operator><name pos:start="257:36" pos:end="257:49">max_max_strips</name></name></expr>;</expr_stmt></block_content></block></if></if_stmt>

        </block_content>}</block></if> <else pos:start="259:11" pos:end="263:9">else <block pos:start="259:16" pos:end="263:9">{<block_content pos:start="261:13" pos:end="261:41"> <comment type="line" pos:start="259:18" pos:end="259:36">// try to step down</comment>

            <expr_stmt pos:start="261:13" pos:end="261:41"><expr pos:start="261:13" pos:end="261:40"><name pos:start="261:13" pos:end="261:25"><name pos:start="261:13" pos:end="261:13">s</name><operator pos:start="261:14" pos:end="261:15">-&gt;</operator><name pos:start="261:16" pos:end="261:25">max_strips</name></name> <operator pos:start="261:27" pos:end="261:27">=</operator> <name pos:start="261:29" pos:end="261:40">best_nstrips</name></expr>;</expr_stmt>

        </block_content>}</block></else></if_stmt>

        <expr_stmt pos:start="265:9" pos:end="265:42"><expr pos:start="265:9" pos:end="265:41"><name pos:start="265:9" pos:end="265:21"><name pos:start="265:9" pos:end="265:9">s</name><operator pos:start="265:10" pos:end="265:11">-&gt;</operator><name pos:start="265:12" pos:end="265:21">min_strips</name></name> <operator pos:start="265:23" pos:end="265:23">=</operator> <name pos:start="265:25" pos:end="265:37"><name pos:start="265:25" pos:end="265:25">s</name><operator pos:start="265:26" pos:end="265:27">-&gt;</operator><name pos:start="265:28" pos:end="265:37">max_strips</name></name> <operator pos:start="265:39" pos:end="265:39">-</operator> <literal type="number" pos:start="265:41" pos:end="265:41">1</literal></expr>;</expr_stmt>

        <if_stmt pos:start="267:9" pos:end="269:46"><if pos:start="267:9" pos:end="269:46">if<condition pos:start="267:11" pos:end="267:45">(<expr pos:start="267:12" pos:end="267:44"><name pos:start="267:12" pos:end="267:24"><name pos:start="267:12" pos:end="267:12">s</name><operator pos:start="267:13" pos:end="267:14">-&gt;</operator><name pos:start="267:15" pos:end="267:24">min_strips</name></name> <operator pos:start="267:26" pos:end="267:26">&lt;</operator> <name pos:start="267:28" pos:end="267:44"><name pos:start="267:28" pos:end="267:28">s</name><operator pos:start="267:29" pos:end="267:30">-&gt;</operator><name pos:start="267:31" pos:end="267:44">min_min_strips</name></name></expr>)</condition><block type="pseudo" pos:start="269:13" pos:end="269:46"><block_content pos:start="269:13" pos:end="269:46">

            <expr_stmt pos:start="269:13" pos:end="269:46"><expr pos:start="269:13" pos:end="269:45"><name pos:start="269:13" pos:end="269:25"><name pos:start="269:13" pos:end="269:13">s</name><operator pos:start="269:14" pos:end="269:15">-&gt;</operator><name pos:start="269:16" pos:end="269:25">min_strips</name></name> <operator pos:start="269:27" pos:end="269:27">=</operator> <name pos:start="269:29" pos:end="269:45"><name pos:start="269:29" pos:end="269:29">s</name><operator pos:start="269:30" pos:end="269:31">-&gt;</operator><name pos:start="269:32" pos:end="269:45">min_min_strips</name></name></expr>;</expr_stmt></block_content></block></if></if_stmt>

    </block_content>}</block></if> <else pos:start="271:7" pos:end="285:5">else <block pos:start="271:12" pos:end="285:5">{<block_content pos:start="273:9" pos:end="283:46">

        <expr_stmt pos:start="273:9" pos:end="273:67"><expr pos:start="273:9" pos:end="273:66"><name pos:start="273:9" pos:end="273:21"><name pos:start="273:9" pos:end="273:9">s</name><operator pos:start="273:10" pos:end="273:11">-&gt;</operator><name pos:start="273:12" pos:end="273:21">max_strips</name></name> <operator pos:start="273:23" pos:end="273:23">=</operator> <name pos:start="273:25" pos:end="273:36">best_nstrips</name> <operator pos:start="273:38" pos:end="273:38">+</operator> <name pos:start="273:40" pos:end="273:66"><name pos:start="273:40" pos:end="273:40">s</name><operator pos:start="273:41" pos:end="273:42">-&gt;</operator><name pos:start="273:43" pos:end="273:66">strip_number_delta_range</name></name></expr>;</expr_stmt>

        <if_stmt pos:start="275:9" pos:end="277:46"><if pos:start="275:9" pos:end="277:46">if<condition pos:start="275:11" pos:end="275:46">(<expr pos:start="275:12" pos:end="275:45"><name pos:start="275:12" pos:end="275:24"><name pos:start="275:12" pos:end="275:12">s</name><operator pos:start="275:13" pos:end="275:14">-&gt;</operator><name pos:start="275:15" pos:end="275:24">max_strips</name></name> <operator pos:start="275:26" pos:end="275:27">&gt;=</operator> <name pos:start="275:29" pos:end="275:45"><name pos:start="275:29" pos:end="275:29">s</name><operator pos:start="275:30" pos:end="275:31">-&gt;</operator><name pos:start="275:32" pos:end="275:45">max_max_strips</name></name></expr>)</condition><block type="pseudo" pos:start="277:13" pos:end="277:46"><block_content pos:start="277:13" pos:end="277:46">

            <expr_stmt pos:start="277:13" pos:end="277:46"><expr pos:start="277:13" pos:end="277:45"><name pos:start="277:13" pos:end="277:25"><name pos:start="277:13" pos:end="277:13">s</name><operator pos:start="277:14" pos:end="277:15">-&gt;</operator><name pos:start="277:16" pos:end="277:25">max_strips</name></name> <operator pos:start="277:27" pos:end="277:27">=</operator> <name pos:start="277:29" pos:end="277:45"><name pos:start="277:29" pos:end="277:29">s</name><operator pos:start="277:30" pos:end="277:31">-&gt;</operator><name pos:start="277:32" pos:end="277:45">max_max_strips</name></name></expr>;</expr_stmt></block_content></block></if></if_stmt>

        <expr_stmt pos:start="279:9" pos:end="279:67"><expr pos:start="279:9" pos:end="279:66"><name pos:start="279:9" pos:end="279:21"><name pos:start="279:9" pos:end="279:9">s</name><operator pos:start="279:10" pos:end="279:11">-&gt;</operator><name pos:start="279:12" pos:end="279:21">min_strips</name></name> <operator pos:start="279:23" pos:end="279:23">=</operator> <name pos:start="279:25" pos:end="279:36">best_nstrips</name> <operator pos:start="279:38" pos:end="279:38">-</operator> <name pos:start="279:40" pos:end="279:66"><name pos:start="279:40" pos:end="279:40">s</name><operator pos:start="279:41" pos:end="279:42">-&gt;</operator><name pos:start="279:43" pos:end="279:66">strip_number_delta_range</name></name></expr>;</expr_stmt>

        <if_stmt pos:start="281:9" pos:end="283:46"><if pos:start="281:9" pos:end="283:46">if<condition pos:start="281:11" pos:end="281:45">(<expr pos:start="281:12" pos:end="281:44"><name pos:start="281:12" pos:end="281:24"><name pos:start="281:12" pos:end="281:12">s</name><operator pos:start="281:13" pos:end="281:14">-&gt;</operator><name pos:start="281:15" pos:end="281:24">min_strips</name></name> <operator pos:start="281:26" pos:end="281:26">&lt;</operator> <name pos:start="281:28" pos:end="281:44"><name pos:start="281:28" pos:end="281:28">s</name><operator pos:start="281:29" pos:end="281:30">-&gt;</operator><name pos:start="281:31" pos:end="281:44">min_min_strips</name></name></expr>)</condition><block type="pseudo" pos:start="283:13" pos:end="283:46"><block_content pos:start="283:13" pos:end="283:46">

            <expr_stmt pos:start="283:13" pos:end="283:46"><expr pos:start="283:13" pos:end="283:45"><name pos:start="283:13" pos:end="283:25"><name pos:start="283:13" pos:end="283:13">s</name><operator pos:start="283:14" pos:end="283:15">-&gt;</operator><name pos:start="283:16" pos:end="283:25">min_strips</name></name> <operator pos:start="283:27" pos:end="283:27">=</operator> <name pos:start="283:29" pos:end="283:45"><name pos:start="283:29" pos:end="283:29">s</name><operator pos:start="283:30" pos:end="283:31">-&gt;</operator><name pos:start="283:32" pos:end="283:45">min_min_strips</name></name></expr>;</expr_stmt></block_content></block></if></if_stmt>

    </block_content>}</block></else></if_stmt>



    <return pos:start="289:5" pos:end="289:21">return <expr pos:start="289:12" pos:end="289:20"><name pos:start="289:12" pos:end="289:20">best_size</name></expr>;</return>

</block_content>}</block></function>
</unit>
