<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.srcML.org/srcML/src" xmlns:pos="http://www.srcML.org/srcML/position" revision="1.0.0" language="C" filename="dataset/ropgen/aug/1/1436.c" pos:tabs="8"><function pos:start="1:1" pos:end="215:1"><type pos:start="1:1" pos:end="1:11"><specifier pos:start="1:1" pos:end="1:6">static</specifier> <name pos:start="1:8" pos:end="1:11">void</name></type> <name pos:start="1:13" pos:end="1:33">fdctrl_start_transfer</name><parameter_list pos:start="1:34" pos:end="1:64">(<parameter pos:start="1:35" pos:end="1:48"><decl pos:start="1:35" pos:end="1:48"><type pos:start="1:35" pos:end="1:48"><name pos:start="1:35" pos:end="1:40">FDCtrl</name> <modifier pos:start="1:42" pos:end="1:42">*</modifier></type><name pos:start="1:43" pos:end="1:48">fdctrl</name></decl></parameter>, <parameter pos:start="1:51" pos:end="1:63"><decl pos:start="1:51" pos:end="1:63"><type pos:start="1:51" pos:end="1:63"><name pos:start="1:51" pos:end="1:53">int</name></type> <name pos:start="1:55" pos:end="1:63">direction</name></decl></parameter>)</parameter_list>

<block pos:start="3:1" pos:end="215:1">{<block_content pos:start="5:5" pos:end="213:29">

    <decl_stmt pos:start="5:5" pos:end="5:20"><decl pos:start="5:5" pos:end="5:19"><type pos:start="5:5" pos:end="5:12"><name pos:start="5:5" pos:end="5:10">FDrive</name> <modifier pos:start="5:12" pos:end="5:12">*</modifier></type><name pos:start="5:13" pos:end="5:19">cur_drv</name></decl>;</decl_stmt>

    <decl_stmt pos:start="7:5" pos:end="7:23"><decl pos:start="7:5" pos:end="7:14"><type pos:start="7:5" pos:end="7:11"><name pos:start="7:5" pos:end="7:11">uint8_t</name></type> <name pos:start="7:13" pos:end="7:14">kh</name></decl>, <decl pos:start="7:17" pos:end="7:18"><type ref="prev" pos:start="7:5" pos:end="7:11"/><name pos:start="7:17" pos:end="7:18">kt</name></decl>, <decl pos:start="7:21" pos:end="7:22"><type ref="prev" pos:start="7:5" pos:end="7:11"/><name pos:start="7:21" pos:end="7:22">ks</name></decl>;</decl_stmt>



    <expr_stmt pos:start="11:5" pos:end="11:58"><expr pos:start="11:5" pos:end="11:57"><call pos:start="11:5" pos:end="11:57"><name pos:start="11:5" pos:end="11:15">SET_CUR_DRV</name><argument_list pos:start="11:16" pos:end="11:57">(<argument pos:start="11:17" pos:end="11:22"><expr pos:start="11:17" pos:end="11:22"><name pos:start="11:17" pos:end="11:22">fdctrl</name></expr></argument>, <argument pos:start="11:25" pos:end="11:56"><expr pos:start="11:25" pos:end="11:56"><name pos:start="11:25" pos:end="11:39"><name pos:start="11:25" pos:end="11:30">fdctrl</name><operator pos:start="11:31" pos:end="11:32">-&gt;</operator><name pos:start="11:33" pos:end="11:36">fifo</name><index pos:start="11:37" pos:end="11:39">[<expr pos:start="11:38" pos:end="11:38"><literal type="number" pos:start="11:38" pos:end="11:38">1</literal></expr>]</index></name> <operator pos:start="11:41" pos:end="11:41">&amp;</operator> <name pos:start="11:43" pos:end="11:56">FD_DOR_SELMASK</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="13:5" pos:end="13:34"><expr pos:start="13:5" pos:end="13:33"><name pos:start="13:5" pos:end="13:11">cur_drv</name> <operator pos:start="13:13" pos:end="13:13">=</operator> <call pos:start="13:15" pos:end="13:33"><name pos:start="13:15" pos:end="13:25">get_cur_drv</name><argument_list pos:start="13:26" pos:end="13:33">(<argument pos:start="13:27" pos:end="13:32"><expr pos:start="13:27" pos:end="13:32"><name pos:start="13:27" pos:end="13:32">fdctrl</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="15:5" pos:end="15:25"><expr pos:start="15:5" pos:end="15:24"><name pos:start="15:5" pos:end="15:6">kt</name> <operator pos:start="15:8" pos:end="15:8">=</operator> <name pos:start="15:10" pos:end="15:24"><name pos:start="15:10" pos:end="15:15">fdctrl</name><operator pos:start="15:16" pos:end="15:17">-&gt;</operator><name pos:start="15:18" pos:end="15:21">fifo</name><index pos:start="15:22" pos:end="15:24">[<expr pos:start="15:23" pos:end="15:23"><literal type="number" pos:start="15:23" pos:end="15:23">2</literal></expr>]</index></name></expr>;</expr_stmt>

    <expr_stmt pos:start="17:5" pos:end="17:25"><expr pos:start="17:5" pos:end="17:24"><name pos:start="17:5" pos:end="17:6">kh</name> <operator pos:start="17:8" pos:end="17:8">=</operator> <name pos:start="17:10" pos:end="17:24"><name pos:start="17:10" pos:end="17:15">fdctrl</name><operator pos:start="17:16" pos:end="17:17">-&gt;</operator><name pos:start="17:18" pos:end="17:21">fifo</name><index pos:start="17:22" pos:end="17:24">[<expr pos:start="17:23" pos:end="17:23"><literal type="number" pos:start="17:23" pos:end="17:23">3</literal></expr>]</index></name></expr>;</expr_stmt>

    <expr_stmt pos:start="19:5" pos:end="19:25"><expr pos:start="19:5" pos:end="19:24"><name pos:start="19:5" pos:end="19:6">ks</name> <operator pos:start="19:8" pos:end="19:8">=</operator> <name pos:start="19:10" pos:end="19:24"><name pos:start="19:10" pos:end="19:15">fdctrl</name><operator pos:start="19:16" pos:end="19:17">-&gt;</operator><name pos:start="19:18" pos:end="19:21">fifo</name><index pos:start="19:22" pos:end="19:24">[<expr pos:start="19:23" pos:end="19:23"><literal type="number" pos:start="19:23" pos:end="19:23">4</literal></expr>]</index></name></expr>;</expr_stmt>

    <expr_stmt pos:start="21:5" pos:end="27:55"><expr pos:start="21:5" pos:end="27:54"><call pos:start="21:5" pos:end="27:54"><name pos:start="21:5" pos:end="21:18">FLOPPY_DPRINTF</name><argument_list pos:start="21:19" pos:end="27:54">(<argument pos:start="21:20" pos:end="21:61"><expr pos:start="21:20" pos:end="21:61"><literal type="string" pos:start="21:20" pos:end="21:61">"Start transfer at %d %d %02x %02x (%d)\n"</literal></expr></argument>,

                   <argument pos:start="23:20" pos:end="23:38"><expr pos:start="23:20" pos:end="23:38"><call pos:start="23:20" pos:end="23:38"><name pos:start="23:20" pos:end="23:30">GET_CUR_DRV</name><argument_list pos:start="23:31" pos:end="23:38">(<argument pos:start="23:32" pos:end="23:37"><expr pos:start="23:32" pos:end="23:37"><name pos:start="23:32" pos:end="23:37">fdctrl</name></expr></argument>)</argument_list></call></expr></argument>, <argument pos:start="23:41" pos:end="23:42"><expr pos:start="23:41" pos:end="23:42"><name pos:start="23:41" pos:end="23:42">kh</name></expr></argument>, <argument pos:start="23:45" pos:end="23:46"><expr pos:start="23:45" pos:end="23:46"><name pos:start="23:45" pos:end="23:46">kt</name></expr></argument>, <argument pos:start="23:49" pos:end="23:50"><expr pos:start="23:49" pos:end="23:50"><name pos:start="23:49" pos:end="23:50">ks</name></expr></argument>,

                   <argument pos:start="25:20" pos:end="27:53"><expr pos:start="25:20" pos:end="27:53"><call pos:start="25:20" pos:end="27:53"><name pos:start="25:20" pos:end="25:33">fd_sector_calc</name><argument_list pos:start="25:34" pos:end="27:53">(<argument pos:start="25:35" pos:end="25:36"><expr pos:start="25:35" pos:end="25:36"><name pos:start="25:35" pos:end="25:36">kh</name></expr></argument>, <argument pos:start="25:39" pos:end="25:40"><expr pos:start="25:39" pos:end="25:40"><name pos:start="25:39" pos:end="25:40">kt</name></expr></argument>, <argument pos:start="25:43" pos:end="25:44"><expr pos:start="25:43" pos:end="25:44"><name pos:start="25:43" pos:end="25:44">ks</name></expr></argument>, <argument pos:start="25:47" pos:end="25:64"><expr pos:start="25:47" pos:end="25:64"><name pos:start="25:47" pos:end="25:64"><name pos:start="25:47" pos:end="25:53">cur_drv</name><operator pos:start="25:54" pos:end="25:55">-&gt;</operator><name pos:start="25:56" pos:end="25:64">last_sect</name></name></expr></argument>,

                                  <argument pos:start="27:35" pos:end="27:52"><expr pos:start="27:35" pos:end="27:52"><call pos:start="27:35" pos:end="27:52"><name pos:start="27:35" pos:end="27:43">NUM_SIDES</name><argument_list pos:start="27:44" pos:end="27:52">(<argument pos:start="27:45" pos:end="27:51"><expr pos:start="27:45" pos:end="27:51"><name pos:start="27:45" pos:end="27:51">cur_drv</name></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <switch pos:start="29:5" pos:end="83:5">switch <condition pos:start="29:12" pos:end="29:73">(<expr pos:start="29:13" pos:end="29:72"><call pos:start="29:13" pos:end="29:72"><name pos:start="29:13" pos:end="29:19">fd_seek</name><argument_list pos:start="29:20" pos:end="29:72">(<argument pos:start="29:21" pos:end="29:27"><expr pos:start="29:21" pos:end="29:27"><name pos:start="29:21" pos:end="29:27">cur_drv</name></expr></argument>, <argument pos:start="29:30" pos:end="29:31"><expr pos:start="29:30" pos:end="29:31"><name pos:start="29:30" pos:end="29:31">kh</name></expr></argument>, <argument pos:start="29:34" pos:end="29:35"><expr pos:start="29:34" pos:end="29:35"><name pos:start="29:34" pos:end="29:35">kt</name></expr></argument>, <argument pos:start="29:38" pos:end="29:39"><expr pos:start="29:38" pos:end="29:39"><name pos:start="29:38" pos:end="29:39">ks</name></expr></argument>, <argument pos:start="29:42" pos:end="29:71"><expr pos:start="29:42" pos:end="29:71"><name pos:start="29:42" pos:end="29:55"><name pos:start="29:42" pos:end="29:47">fdctrl</name><operator pos:start="29:48" pos:end="29:49">-&gt;</operator><name pos:start="29:50" pos:end="29:55">config</name></name> <operator pos:start="29:57" pos:end="29:57">&amp;</operator> <name pos:start="29:59" pos:end="29:71">FD_CONFIG_EIS</name></expr></argument>)</argument_list></call></expr>)</condition> <block pos:start="29:75" pos:end="83:5">{<block_content pos:start="31:5" pos:end="81:14">

    <case pos:start="31:5" pos:end="31:11">case <expr pos:start="31:10" pos:end="31:10"><literal type="number" pos:start="31:10" pos:end="31:10">2</literal></expr>:</case>

        <comment type="block" pos:start="33:9" pos:end="33:26">/* sect too big */</comment>

        <expr_stmt pos:start="35:9" pos:end="35:65"><expr pos:start="35:9" pos:end="35:64"><call pos:start="35:9" pos:end="35:64"><name pos:start="35:9" pos:end="35:28">fdctrl_stop_transfer</name><argument_list pos:start="35:29" pos:end="35:64">(<argument pos:start="35:30" pos:end="35:35"><expr pos:start="35:30" pos:end="35:35"><name pos:start="35:30" pos:end="35:35">fdctrl</name></expr></argument>, <argument pos:start="35:38" pos:end="35:51"><expr pos:start="35:38" pos:end="35:51"><name pos:start="35:38" pos:end="35:51">FD_SR0_ABNTERM</name></expr></argument>, <argument pos:start="35:54" pos:end="35:57"><expr pos:start="35:54" pos:end="35:57"><literal type="number" pos:start="35:54" pos:end="35:57">0x00</literal></expr></argument>, <argument pos:start="35:60" pos:end="35:63"><expr pos:start="35:60" pos:end="35:63"><literal type="number" pos:start="35:60" pos:end="35:63">0x00</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="37:9" pos:end="37:29"><expr pos:start="37:9" pos:end="37:28"><name pos:start="37:9" pos:end="37:23"><name pos:start="37:9" pos:end="37:14">fdctrl</name><operator pos:start="37:15" pos:end="37:16">-&gt;</operator><name pos:start="37:17" pos:end="37:20">fifo</name><index pos:start="37:21" pos:end="37:23">[<expr pos:start="37:22" pos:end="37:22"><literal type="number" pos:start="37:22" pos:end="37:22">3</literal></expr>]</index></name> <operator pos:start="37:25" pos:end="37:25">=</operator> <name pos:start="37:27" pos:end="37:28">kt</name></expr>;</expr_stmt>

        <expr_stmt pos:start="39:9" pos:end="39:29"><expr pos:start="39:9" pos:end="39:28"><name pos:start="39:9" pos:end="39:23"><name pos:start="39:9" pos:end="39:14">fdctrl</name><operator pos:start="39:15" pos:end="39:16">-&gt;</operator><name pos:start="39:17" pos:end="39:20">fifo</name><index pos:start="39:21" pos:end="39:23">[<expr pos:start="39:22" pos:end="39:22"><literal type="number" pos:start="39:22" pos:end="39:22">4</literal></expr>]</index></name> <operator pos:start="39:25" pos:end="39:25">=</operator> <name pos:start="39:27" pos:end="39:28">kh</name></expr>;</expr_stmt>

        <expr_stmt pos:start="41:9" pos:end="41:29"><expr pos:start="41:9" pos:end="41:28"><name pos:start="41:9" pos:end="41:23"><name pos:start="41:9" pos:end="41:14">fdctrl</name><operator pos:start="41:15" pos:end="41:16">-&gt;</operator><name pos:start="41:17" pos:end="41:20">fifo</name><index pos:start="41:21" pos:end="41:23">[<expr pos:start="41:22" pos:end="41:22"><literal type="number" pos:start="41:22" pos:end="41:22">5</literal></expr>]</index></name> <operator pos:start="41:25" pos:end="41:25">=</operator> <name pos:start="41:27" pos:end="41:28">ks</name></expr>;</expr_stmt>

        <return pos:start="43:9" pos:end="43:15">return;</return>

    <case pos:start="45:5" pos:end="45:11">case <expr pos:start="45:10" pos:end="45:10"><literal type="number" pos:start="45:10" pos:end="45:10">3</literal></expr>:</case>

        <comment type="block" pos:start="47:9" pos:end="47:27">/* track too big */</comment>

        <expr_stmt pos:start="49:9" pos:end="49:70"><expr pos:start="49:9" pos:end="49:69"><call pos:start="49:9" pos:end="49:69"><name pos:start="49:9" pos:end="49:28">fdctrl_stop_transfer</name><argument_list pos:start="49:29" pos:end="49:69">(<argument pos:start="49:30" pos:end="49:35"><expr pos:start="49:30" pos:end="49:35"><name pos:start="49:30" pos:end="49:35">fdctrl</name></expr></argument>, <argument pos:start="49:38" pos:end="49:51"><expr pos:start="49:38" pos:end="49:51"><name pos:start="49:38" pos:end="49:51">FD_SR0_ABNTERM</name></expr></argument>, <argument pos:start="49:54" pos:end="49:62"><expr pos:start="49:54" pos:end="49:62"><name pos:start="49:54" pos:end="49:62">FD_SR1_EC</name></expr></argument>, <argument pos:start="49:65" pos:end="49:68"><expr pos:start="49:65" pos:end="49:68"><literal type="number" pos:start="49:65" pos:end="49:68">0x00</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="51:9" pos:end="51:29"><expr pos:start="51:9" pos:end="51:28"><name pos:start="51:9" pos:end="51:23"><name pos:start="51:9" pos:end="51:14">fdctrl</name><operator pos:start="51:15" pos:end="51:16">-&gt;</operator><name pos:start="51:17" pos:end="51:20">fifo</name><index pos:start="51:21" pos:end="51:23">[<expr pos:start="51:22" pos:end="51:22"><literal type="number" pos:start="51:22" pos:end="51:22">3</literal></expr>]</index></name> <operator pos:start="51:25" pos:end="51:25">=</operator> <name pos:start="51:27" pos:end="51:28">kt</name></expr>;</expr_stmt>

        <expr_stmt pos:start="53:9" pos:end="53:29"><expr pos:start="53:9" pos:end="53:28"><name pos:start="53:9" pos:end="53:23"><name pos:start="53:9" pos:end="53:14">fdctrl</name><operator pos:start="53:15" pos:end="53:16">-&gt;</operator><name pos:start="53:17" pos:end="53:20">fifo</name><index pos:start="53:21" pos:end="53:23">[<expr pos:start="53:22" pos:end="53:22"><literal type="number" pos:start="53:22" pos:end="53:22">4</literal></expr>]</index></name> <operator pos:start="53:25" pos:end="53:25">=</operator> <name pos:start="53:27" pos:end="53:28">kh</name></expr>;</expr_stmt>

        <expr_stmt pos:start="55:9" pos:end="55:29"><expr pos:start="55:9" pos:end="55:28"><name pos:start="55:9" pos:end="55:23"><name pos:start="55:9" pos:end="55:14">fdctrl</name><operator pos:start="55:15" pos:end="55:16">-&gt;</operator><name pos:start="55:17" pos:end="55:20">fifo</name><index pos:start="55:21" pos:end="55:23">[<expr pos:start="55:22" pos:end="55:22"><literal type="number" pos:start="55:22" pos:end="55:22">5</literal></expr>]</index></name> <operator pos:start="55:25" pos:end="55:25">=</operator> <name pos:start="55:27" pos:end="55:28">ks</name></expr>;</expr_stmt>

        <return pos:start="57:9" pos:end="57:15">return;</return>

    <case pos:start="59:5" pos:end="59:11">case <expr pos:start="59:10" pos:end="59:10"><literal type="number" pos:start="59:10" pos:end="59:10">4</literal></expr>:</case>

        <comment type="block" pos:start="61:9" pos:end="61:29">/* No seek enabled */</comment>

        <expr_stmt pos:start="63:9" pos:end="63:65"><expr pos:start="63:9" pos:end="63:64"><call pos:start="63:9" pos:end="63:64"><name pos:start="63:9" pos:end="63:28">fdctrl_stop_transfer</name><argument_list pos:start="63:29" pos:end="63:64">(<argument pos:start="63:30" pos:end="63:35"><expr pos:start="63:30" pos:end="63:35"><name pos:start="63:30" pos:end="63:35">fdctrl</name></expr></argument>, <argument pos:start="63:38" pos:end="63:51"><expr pos:start="63:38" pos:end="63:51"><name pos:start="63:38" pos:end="63:51">FD_SR0_ABNTERM</name></expr></argument>, <argument pos:start="63:54" pos:end="63:57"><expr pos:start="63:54" pos:end="63:57"><literal type="number" pos:start="63:54" pos:end="63:57">0x00</literal></expr></argument>, <argument pos:start="63:60" pos:end="63:63"><expr pos:start="63:60" pos:end="63:63"><literal type="number" pos:start="63:60" pos:end="63:63">0x00</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="65:9" pos:end="65:29"><expr pos:start="65:9" pos:end="65:28"><name pos:start="65:9" pos:end="65:23"><name pos:start="65:9" pos:end="65:14">fdctrl</name><operator pos:start="65:15" pos:end="65:16">-&gt;</operator><name pos:start="65:17" pos:end="65:20">fifo</name><index pos:start="65:21" pos:end="65:23">[<expr pos:start="65:22" pos:end="65:22"><literal type="number" pos:start="65:22" pos:end="65:22">3</literal></expr>]</index></name> <operator pos:start="65:25" pos:end="65:25">=</operator> <name pos:start="65:27" pos:end="65:28">kt</name></expr>;</expr_stmt>

        <expr_stmt pos:start="67:9" pos:end="67:29"><expr pos:start="67:9" pos:end="67:28"><name pos:start="67:9" pos:end="67:23"><name pos:start="67:9" pos:end="67:14">fdctrl</name><operator pos:start="67:15" pos:end="67:16">-&gt;</operator><name pos:start="67:17" pos:end="67:20">fifo</name><index pos:start="67:21" pos:end="67:23">[<expr pos:start="67:22" pos:end="67:22"><literal type="number" pos:start="67:22" pos:end="67:22">4</literal></expr>]</index></name> <operator pos:start="67:25" pos:end="67:25">=</operator> <name pos:start="67:27" pos:end="67:28">kh</name></expr>;</expr_stmt>

        <expr_stmt pos:start="69:9" pos:end="69:29"><expr pos:start="69:9" pos:end="69:28"><name pos:start="69:9" pos:end="69:23"><name pos:start="69:9" pos:end="69:14">fdctrl</name><operator pos:start="69:15" pos:end="69:16">-&gt;</operator><name pos:start="69:17" pos:end="69:20">fifo</name><index pos:start="69:21" pos:end="69:23">[<expr pos:start="69:22" pos:end="69:22"><literal type="number" pos:start="69:22" pos:end="69:22">5</literal></expr>]</index></name> <operator pos:start="69:25" pos:end="69:25">=</operator> <name pos:start="69:27" pos:end="69:28">ks</name></expr>;</expr_stmt>

        <return pos:start="71:9" pos:end="71:15">return;</return>

    <case pos:start="73:5" pos:end="73:11">case <expr pos:start="73:10" pos:end="73:10"><literal type="number" pos:start="73:10" pos:end="73:10">1</literal></expr>:</case>

        <expr_stmt pos:start="75:9" pos:end="75:39"><expr pos:start="75:9" pos:end="75:38"><name pos:start="75:9" pos:end="75:23"><name pos:start="75:9" pos:end="75:14">fdctrl</name><operator pos:start="75:15" pos:end="75:16">-&gt;</operator><name pos:start="75:17" pos:end="75:23">status0</name></name> <operator pos:start="75:25" pos:end="75:26">|=</operator> <name pos:start="75:28" pos:end="75:38">FD_SR0_SEEK</name></expr>;</expr_stmt>

        <break pos:start="77:9" pos:end="77:14">break;</break>

    <default pos:start="79:5" pos:end="79:12">default:</default>

        <break pos:start="81:9" pos:end="81:14">break;</break>

    </block_content>}</block></switch>



    <comment type="block" pos:start="87:5" pos:end="89:67">/* Check the data rate. If the programmed data rate does not match

     * the currently inserted medium, the operation has to fail. */</comment>

    <if_stmt pos:start="91:5" pos:end="109:5"><if pos:start="91:5" pos:end="109:5">if <condition pos:start="91:8" pos:end="93:64">(<expr pos:start="91:9" pos:end="93:63"><name pos:start="91:9" pos:end="91:32"><name pos:start="91:9" pos:end="91:14">fdctrl</name><operator pos:start="91:15" pos:end="91:16">-&gt;</operator><name pos:start="91:17" pos:end="91:32">check_media_rate</name></name> <operator pos:start="91:34" pos:end="91:35">&amp;&amp;</operator>

        <operator pos:start="93:9" pos:end="93:9">(</operator><name pos:start="93:10" pos:end="93:20"><name pos:start="93:10" pos:end="93:15">fdctrl</name><operator pos:start="93:16" pos:end="93:17">-&gt;</operator><name pos:start="93:18" pos:end="93:20">dsr</name></name> <operator pos:start="93:22" pos:end="93:22">&amp;</operator> <name pos:start="93:24" pos:end="93:39">FD_DSR_DRATEMASK</name><operator pos:start="93:40" pos:end="93:40">)</operator> <operator pos:start="93:42" pos:end="93:43">!=</operator> <name pos:start="93:45" pos:end="93:63"><name pos:start="93:45" pos:end="93:51">cur_drv</name><operator pos:start="93:52" pos:end="93:53">-&gt;</operator><name pos:start="93:54" pos:end="93:63">media_rate</name></name></expr>)</condition> <block pos:start="93:66" pos:end="109:5">{<block_content pos:start="95:9" pos:end="107:15">

        <expr_stmt pos:start="95:9" pos:end="97:76"><expr pos:start="95:9" pos:end="97:75"><call pos:start="95:9" pos:end="97:75"><name pos:start="95:9" pos:end="95:22">FLOPPY_DPRINTF</name><argument_list pos:start="95:23" pos:end="97:75">(<argument pos:start="95:24" pos:end="95:64"><expr pos:start="95:24" pos:end="95:64"><literal type="string" pos:start="95:24" pos:end="95:64">"data rate mismatch (fdc=%d, media=%d)\n"</literal></expr></argument>,

                       <argument pos:start="97:24" pos:end="97:53"><expr pos:start="97:24" pos:end="97:53"><name pos:start="97:24" pos:end="97:34"><name pos:start="97:24" pos:end="97:29">fdctrl</name><operator pos:start="97:30" pos:end="97:31">-&gt;</operator><name pos:start="97:32" pos:end="97:34">dsr</name></name> <operator pos:start="97:36" pos:end="97:36">&amp;</operator> <name pos:start="97:38" pos:end="97:53">FD_DSR_DRATEMASK</name></expr></argument>, <argument pos:start="97:56" pos:end="97:74"><expr pos:start="97:56" pos:end="97:74"><name pos:start="97:56" pos:end="97:74"><name pos:start="97:56" pos:end="97:62">cur_drv</name><operator pos:start="97:63" pos:end="97:64">-&gt;</operator><name pos:start="97:65" pos:end="97:74">media_rate</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="99:9" pos:end="99:70"><expr pos:start="99:9" pos:end="99:69"><call pos:start="99:9" pos:end="99:69"><name pos:start="99:9" pos:end="99:28">fdctrl_stop_transfer</name><argument_list pos:start="99:29" pos:end="99:69">(<argument pos:start="99:30" pos:end="99:35"><expr pos:start="99:30" pos:end="99:35"><name pos:start="99:30" pos:end="99:35">fdctrl</name></expr></argument>, <argument pos:start="99:38" pos:end="99:51"><expr pos:start="99:38" pos:end="99:51"><name pos:start="99:38" pos:end="99:51">FD_SR0_ABNTERM</name></expr></argument>, <argument pos:start="99:54" pos:end="99:62"><expr pos:start="99:54" pos:end="99:62"><name pos:start="99:54" pos:end="99:62">FD_SR1_MA</name></expr></argument>, <argument pos:start="99:65" pos:end="99:68"><expr pos:start="99:65" pos:end="99:68"><literal type="number" pos:start="99:65" pos:end="99:68">0x00</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="101:9" pos:end="101:29"><expr pos:start="101:9" pos:end="101:28"><name pos:start="101:9" pos:end="101:23"><name pos:start="101:9" pos:end="101:14">fdctrl</name><operator pos:start="101:15" pos:end="101:16">-&gt;</operator><name pos:start="101:17" pos:end="101:20">fifo</name><index pos:start="101:21" pos:end="101:23">[<expr pos:start="101:22" pos:end="101:22"><literal type="number" pos:start="101:22" pos:end="101:22">3</literal></expr>]</index></name> <operator pos:start="101:25" pos:end="101:25">=</operator> <name pos:start="101:27" pos:end="101:28">kt</name></expr>;</expr_stmt>

        <expr_stmt pos:start="103:9" pos:end="103:29"><expr pos:start="103:9" pos:end="103:28"><name pos:start="103:9" pos:end="103:23"><name pos:start="103:9" pos:end="103:14">fdctrl</name><operator pos:start="103:15" pos:end="103:16">-&gt;</operator><name pos:start="103:17" pos:end="103:20">fifo</name><index pos:start="103:21" pos:end="103:23">[<expr pos:start="103:22" pos:end="103:22"><literal type="number" pos:start="103:22" pos:end="103:22">4</literal></expr>]</index></name> <operator pos:start="103:25" pos:end="103:25">=</operator> <name pos:start="103:27" pos:end="103:28">kh</name></expr>;</expr_stmt>

        <expr_stmt pos:start="105:9" pos:end="105:29"><expr pos:start="105:9" pos:end="105:28"><name pos:start="105:9" pos:end="105:23"><name pos:start="105:9" pos:end="105:14">fdctrl</name><operator pos:start="105:15" pos:end="105:16">-&gt;</operator><name pos:start="105:17" pos:end="105:20">fifo</name><index pos:start="105:21" pos:end="105:23">[<expr pos:start="105:22" pos:end="105:22"><literal type="number" pos:start="105:22" pos:end="105:22">5</literal></expr>]</index></name> <operator pos:start="105:25" pos:end="105:25">=</operator> <name pos:start="105:27" pos:end="105:28">ks</name></expr>;</expr_stmt>

        <return pos:start="107:9" pos:end="107:15">return;</return>

    </block_content>}</block></if></if_stmt>



    <comment type="block" pos:start="113:5" pos:end="113:28">/* Set the FIFO state */</comment>

    <expr_stmt pos:start="115:5" pos:end="115:33"><expr pos:start="115:5" pos:end="115:32"><name pos:start="115:5" pos:end="115:20"><name pos:start="115:5" pos:end="115:10">fdctrl</name><operator pos:start="115:11" pos:end="115:12">-&gt;</operator><name pos:start="115:13" pos:end="115:20">data_dir</name></name> <operator pos:start="115:22" pos:end="115:22">=</operator> <name pos:start="115:24" pos:end="115:32">direction</name></expr>;</expr_stmt>

    <expr_stmt pos:start="117:5" pos:end="117:25"><expr pos:start="117:5" pos:end="117:24"><name pos:start="117:5" pos:end="117:20"><name pos:start="117:5" pos:end="117:10">fdctrl</name><operator pos:start="117:11" pos:end="117:12">-&gt;</operator><name pos:start="117:13" pos:end="117:20">data_pos</name></name> <operator pos:start="117:22" pos:end="117:22">=</operator> <literal type="number" pos:start="117:24" pos:end="117:24">0</literal></expr>;</expr_stmt>

    <expr_stmt pos:start="119:5" pos:end="119:34"><expr pos:start="119:5" pos:end="119:33"><name pos:start="119:5" pos:end="119:15"><name pos:start="119:5" pos:end="119:10">fdctrl</name><operator pos:start="119:11" pos:end="119:12">-&gt;</operator><name pos:start="119:13" pos:end="119:15">msr</name></name> <operator pos:start="119:17" pos:end="119:18">|=</operator> <name pos:start="119:20" pos:end="119:33">FD_MSR_CMDBUSY</name></expr>;</expr_stmt>

    <if_stmt pos:start="121:5" pos:end="127:46"><if pos:start="121:5" pos:end="123:45">if <condition pos:start="121:8" pos:end="121:31">(<expr pos:start="121:9" pos:end="121:30"><name pos:start="121:9" pos:end="121:23"><name pos:start="121:9" pos:end="121:14">fdctrl</name><operator pos:start="121:15" pos:end="121:16">-&gt;</operator><name pos:start="121:17" pos:end="121:20">fifo</name><index pos:start="121:21" pos:end="121:23">[<expr pos:start="121:22" pos:end="121:22"><literal type="number" pos:start="121:22" pos:end="121:22">0</literal></expr>]</index></name> <operator pos:start="121:25" pos:end="121:25">&amp;</operator> <literal type="number" pos:start="121:27" pos:end="121:30">0x80</literal></expr>)</condition><block type="pseudo" pos:start="123:9" pos:end="123:45"><block_content pos:start="123:9" pos:end="123:45">

        <expr_stmt pos:start="123:9" pos:end="123:45"><expr pos:start="123:9" pos:end="123:44"><name pos:start="123:9" pos:end="123:26"><name pos:start="123:9" pos:end="123:14">fdctrl</name><operator pos:start="123:15" pos:end="123:16">-&gt;</operator><name pos:start="123:17" pos:end="123:26">data_state</name></name> <operator pos:start="123:28" pos:end="123:29">|=</operator> <name pos:start="123:31" pos:end="123:44">FD_STATE_MULTI</name></expr>;</expr_stmt></block_content></block></if>

    <else pos:start="125:5" pos:end="127:46">else<block type="pseudo" pos:start="127:9" pos:end="127:46"><block_content pos:start="127:9" pos:end="127:46">

        <expr_stmt pos:start="127:9" pos:end="127:46"><expr pos:start="127:9" pos:end="127:45"><name pos:start="127:9" pos:end="127:26"><name pos:start="127:9" pos:end="127:14">fdctrl</name><operator pos:start="127:15" pos:end="127:16">-&gt;</operator><name pos:start="127:17" pos:end="127:26">data_state</name></name> <operator pos:start="127:28" pos:end="127:29">&amp;=</operator> <operator pos:start="127:31" pos:end="127:31">~</operator><name pos:start="127:32" pos:end="127:45">FD_STATE_MULTI</name></expr>;</expr_stmt></block_content></block></else></if_stmt>

    <if_stmt pos:start="129:5" pos:end="147:5"><if pos:start="129:5" pos:end="133:5">if <condition pos:start="129:8" pos:end="129:30">(<expr pos:start="129:9" pos:end="129:29"><name pos:start="129:9" pos:end="129:23"><name pos:start="129:9" pos:end="129:14">fdctrl</name><operator pos:start="129:15" pos:end="129:16">-&gt;</operator><name pos:start="129:17" pos:end="129:20">fifo</name><index pos:start="129:21" pos:end="129:23">[<expr pos:start="129:22" pos:end="129:22"><literal type="number" pos:start="129:22" pos:end="129:22">5</literal></expr>]</index></name> <operator pos:start="129:25" pos:end="129:26">==</operator> <literal type="number" pos:start="129:28" pos:end="129:29">00</literal></expr>)</condition> <block pos:start="129:32" pos:end="133:5">{<block_content pos:start="131:9" pos:end="131:43">

        <expr_stmt pos:start="131:9" pos:end="131:43"><expr pos:start="131:9" pos:end="131:42"><name pos:start="131:9" pos:end="131:24"><name pos:start="131:9" pos:end="131:14">fdctrl</name><operator pos:start="131:15" pos:end="131:16">-&gt;</operator><name pos:start="131:17" pos:end="131:24">data_len</name></name> <operator pos:start="131:26" pos:end="131:26">=</operator> <name pos:start="131:28" pos:end="131:42"><name pos:start="131:28" pos:end="131:33">fdctrl</name><operator pos:start="131:34" pos:end="131:35">-&gt;</operator><name pos:start="131:36" pos:end="131:39">fifo</name><index pos:start="131:40" pos:end="131:42">[<expr pos:start="131:41" pos:end="131:41"><literal type="number" pos:start="131:41" pos:end="131:41">8</literal></expr>]</index></name></expr>;</expr_stmt>

    </block_content>}</block></if> <else pos:start="133:7" pos:end="147:5">else <block pos:start="133:12" pos:end="147:5">{<block_content pos:start="135:9" pos:end="145:32">

        <decl_stmt pos:start="135:9" pos:end="135:16"><decl pos:start="135:9" pos:end="135:15"><type pos:start="135:9" pos:end="135:11"><name pos:start="135:9" pos:end="135:11">int</name></type> <name pos:start="135:13" pos:end="135:15">tmp</name></decl>;</decl_stmt>

        <expr_stmt pos:start="137:9" pos:end="137:78"><expr pos:start="137:9" pos:end="137:77"><name pos:start="137:9" pos:end="137:24"><name pos:start="137:9" pos:end="137:14">fdctrl</name><operator pos:start="137:15" pos:end="137:16">-&gt;</operator><name pos:start="137:17" pos:end="137:24">data_len</name></name> <operator pos:start="137:26" pos:end="137:26">=</operator> <literal type="number" pos:start="137:28" pos:end="137:30">128</literal> <operator pos:start="137:32" pos:end="137:33">&lt;&lt;</operator> <operator pos:start="137:35" pos:end="137:35">(</operator><ternary pos:start="137:36" pos:end="137:76"><condition pos:start="137:36" pos:end="137:56"><expr pos:start="137:36" pos:end="137:54"><name pos:start="137:36" pos:end="137:50"><name pos:start="137:36" pos:end="137:41">fdctrl</name><operator pos:start="137:42" pos:end="137:43">-&gt;</operator><name pos:start="137:44" pos:end="137:47">fifo</name><index pos:start="137:48" pos:end="137:50">[<expr pos:start="137:49" pos:end="137:49"><literal type="number" pos:start="137:49" pos:end="137:49">5</literal></expr>]</index></name> <operator pos:start="137:52" pos:end="137:52">&gt;</operator> <literal type="number" pos:start="137:54" pos:end="137:54">7</literal></expr> ?</condition><then pos:start="137:58" pos:end="137:58"> <expr pos:start="137:58" pos:end="137:58"><literal type="number" pos:start="137:58" pos:end="137:58">7</literal></expr> </then><else pos:start="137:60" pos:end="137:76">: <expr pos:start="137:62" pos:end="137:76"><name pos:start="137:62" pos:end="137:76"><name pos:start="137:62" pos:end="137:67">fdctrl</name><operator pos:start="137:68" pos:end="137:69">-&gt;</operator><name pos:start="137:70" pos:end="137:73">fifo</name><index pos:start="137:74" pos:end="137:76">[<expr pos:start="137:75" pos:end="137:75"><literal type="number" pos:start="137:75" pos:end="137:75">5</literal></expr>]</index></name></expr></else></ternary><operator pos:start="137:77" pos:end="137:77">)</operator></expr>;</expr_stmt>

        <expr_stmt pos:start="139:9" pos:end="139:41"><expr pos:start="139:9" pos:end="139:40"><name pos:start="139:9" pos:end="139:11">tmp</name> <operator pos:start="139:13" pos:end="139:13">=</operator> <operator pos:start="139:15" pos:end="139:15">(</operator><name pos:start="139:16" pos:end="139:30"><name pos:start="139:16" pos:end="139:21">fdctrl</name><operator pos:start="139:22" pos:end="139:23">-&gt;</operator><name pos:start="139:24" pos:end="139:27">fifo</name><index pos:start="139:28" pos:end="139:30">[<expr pos:start="139:29" pos:end="139:29"><literal type="number" pos:start="139:29" pos:end="139:29">6</literal></expr>]</index></name> <operator pos:start="139:32" pos:end="139:32">-</operator> <name pos:start="139:34" pos:end="139:35">ks</name> <operator pos:start="139:37" pos:end="139:37">+</operator> <literal type="number" pos:start="139:39" pos:end="139:39">1</literal><operator pos:start="139:40" pos:end="139:40">)</operator></expr>;</expr_stmt>

        <if_stmt pos:start="141:9" pos:end="143:35"><if pos:start="141:9" pos:end="143:35">if <condition pos:start="141:12" pos:end="141:35">(<expr pos:start="141:13" pos:end="141:34"><name pos:start="141:13" pos:end="141:27"><name pos:start="141:13" pos:end="141:18">fdctrl</name><operator pos:start="141:19" pos:end="141:20">-&gt;</operator><name pos:start="141:21" pos:end="141:24">fifo</name><index pos:start="141:25" pos:end="141:27">[<expr pos:start="141:26" pos:end="141:26"><literal type="number" pos:start="141:26" pos:end="141:26">0</literal></expr>]</index></name> <operator pos:start="141:29" pos:end="141:29">&amp;</operator> <literal type="number" pos:start="141:31" pos:end="141:34">0x80</literal></expr>)</condition><block type="pseudo" pos:start="143:13" pos:end="143:35"><block_content pos:start="143:13" pos:end="143:35">

            <expr_stmt pos:start="143:13" pos:end="143:35"><expr pos:start="143:13" pos:end="143:34"><name pos:start="143:13" pos:end="143:15">tmp</name> <operator pos:start="143:17" pos:end="143:18">+=</operator> <name pos:start="143:20" pos:end="143:34"><name pos:start="143:20" pos:end="143:25">fdctrl</name><operator pos:start="143:26" pos:end="143:27">-&gt;</operator><name pos:start="143:28" pos:end="143:31">fifo</name><index pos:start="143:32" pos:end="143:34">[<expr pos:start="143:33" pos:end="143:33"><literal type="number" pos:start="143:33" pos:end="143:33">6</literal></expr>]</index></name></expr>;</expr_stmt></block_content></block></if></if_stmt>

        <expr_stmt pos:start="145:9" pos:end="145:32"><expr pos:start="145:9" pos:end="145:31"><name pos:start="145:9" pos:end="145:24"><name pos:start="145:9" pos:end="145:14">fdctrl</name><operator pos:start="145:15" pos:end="145:16">-&gt;</operator><name pos:start="145:17" pos:end="145:24">data_len</name></name> <operator pos:start="145:26" pos:end="145:27">*=</operator> <name pos:start="145:29" pos:end="145:31">tmp</name></expr>;</expr_stmt>

    </block_content>}</block></else></if_stmt>

    <expr_stmt pos:start="149:5" pos:end="149:34"><expr pos:start="149:5" pos:end="149:33"><name pos:start="149:5" pos:end="149:15"><name pos:start="149:5" pos:end="149:10">fdctrl</name><operator pos:start="149:11" pos:end="149:12">-&gt;</operator><name pos:start="149:13" pos:end="149:15">eot</name></name> <operator pos:start="149:17" pos:end="149:17">=</operator> <name pos:start="149:19" pos:end="149:33"><name pos:start="149:19" pos:end="149:24">fdctrl</name><operator pos:start="149:25" pos:end="149:26">-&gt;</operator><name pos:start="149:27" pos:end="149:30">fifo</name><index pos:start="149:31" pos:end="149:33">[<expr pos:start="149:32" pos:end="149:32"><literal type="number" pos:start="149:32" pos:end="149:32">6</literal></expr>]</index></name></expr>;</expr_stmt>

    <if_stmt pos:start="151:5" pos:end="201:5"><if pos:start="151:5" pos:end="201:5">if <condition pos:start="151:8" pos:end="151:35">(<expr pos:start="151:9" pos:end="151:34"><name pos:start="151:9" pos:end="151:19"><name pos:start="151:9" pos:end="151:14">fdctrl</name><operator pos:start="151:15" pos:end="151:16">-&gt;</operator><name pos:start="151:17" pos:end="151:19">dor</name></name> <operator pos:start="151:21" pos:end="151:21">&amp;</operator> <name pos:start="151:23" pos:end="151:34">FD_DOR_DMAEN</name></expr>)</condition> <block pos:start="151:37" pos:end="201:5">{<block_content pos:start="153:9" pos:end="199:9">

        <decl_stmt pos:start="153:9" pos:end="153:21"><decl pos:start="153:9" pos:end="153:20"><type pos:start="153:9" pos:end="153:11"><name pos:start="153:9" pos:end="153:11">int</name></type> <name pos:start="153:13" pos:end="153:20">dma_mode</name></decl>;</decl_stmt>

        <comment type="block" pos:start="155:9" pos:end="155:79">/* DMA transfer are enabled. Check if DMA channel is well programmed */</comment>

        <expr_stmt pos:start="157:9" pos:end="157:59"><expr pos:start="157:9" pos:end="157:58"><name pos:start="157:9" pos:end="157:16">dma_mode</name> <operator pos:start="157:18" pos:end="157:18">=</operator> <call pos:start="157:20" pos:end="157:58"><name pos:start="157:20" pos:end="157:39">DMA_get_channel_mode</name><argument_list pos:start="157:40" pos:end="157:58">(<argument pos:start="157:41" pos:end="157:57"><expr pos:start="157:41" pos:end="157:57"><name pos:start="157:41" pos:end="157:57"><name pos:start="157:41" pos:end="157:46">fdctrl</name><operator pos:start="157:47" pos:end="157:48">-&gt;</operator><name pos:start="157:49" pos:end="157:57">dma_chann</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <expr_stmt pos:start="159:9" pos:end="159:39"><expr pos:start="159:9" pos:end="159:38"><name pos:start="159:9" pos:end="159:16">dma_mode</name> <operator pos:start="159:18" pos:end="159:18">=</operator> <operator pos:start="159:20" pos:end="159:20">(</operator><name pos:start="159:21" pos:end="159:28">dma_mode</name> <operator pos:start="159:30" pos:end="159:31">&gt;&gt;</operator> <literal type="number" pos:start="159:33" pos:end="159:33">2</literal><operator pos:start="159:34" pos:end="159:34">)</operator> <operator pos:start="159:36" pos:end="159:36">&amp;</operator> <literal type="number" pos:start="159:38" pos:end="159:38">3</literal></expr>;</expr_stmt>

        <expr_stmt pos:start="161:9" pos:end="167:72"><expr pos:start="161:9" pos:end="167:71"><call pos:start="161:9" pos:end="167:71"><name pos:start="161:9" pos:end="161:22">FLOPPY_DPRINTF</name><argument_list pos:start="161:23" pos:end="167:71">(<argument pos:start="161:24" pos:end="161:61"><expr pos:start="161:24" pos:end="161:61"><literal type="string" pos:start="161:24" pos:end="161:61">"dma_mode=%d direction=%d (%d - %d)\n"</literal></expr></argument>,

                       <argument pos:start="163:24" pos:end="163:31"><expr pos:start="163:24" pos:end="163:31"><name pos:start="163:24" pos:end="163:31">dma_mode</name></expr></argument>, <argument pos:start="163:34" pos:end="163:42"><expr pos:start="163:34" pos:end="163:42"><name pos:start="163:34" pos:end="163:42">direction</name></expr></argument>,

                       <argument pos:start="165:24" pos:end="167:52"><expr pos:start="165:24" pos:end="167:52"><operator pos:start="165:24" pos:end="165:24">(</operator><literal type="number" pos:start="165:25" pos:end="165:27">128</literal> <operator pos:start="165:29" pos:end="165:30">&lt;&lt;</operator> <name pos:start="165:32" pos:end="165:46"><name pos:start="165:32" pos:end="165:37">fdctrl</name><operator pos:start="165:38" pos:end="165:39">-&gt;</operator><name pos:start="165:40" pos:end="165:43">fifo</name><index pos:start="165:44" pos:end="165:46">[<expr pos:start="165:45" pos:end="165:45"><literal type="number" pos:start="165:45" pos:end="165:45">5</literal></expr>]</index></name><operator pos:start="165:47" pos:end="165:47">)</operator> <operator pos:start="165:49" pos:end="165:49">*</operator>

                       <operator pos:start="167:24" pos:end="167:24">(</operator><name pos:start="167:25" pos:end="167:42"><name pos:start="167:25" pos:end="167:31">cur_drv</name><operator pos:start="167:32" pos:end="167:33">-&gt;</operator><name pos:start="167:34" pos:end="167:42">last_sect</name></name> <operator pos:start="167:44" pos:end="167:44">-</operator> <name pos:start="167:46" pos:end="167:47">ks</name> <operator pos:start="167:49" pos:end="167:49">+</operator> <literal type="number" pos:start="167:51" pos:end="167:51">1</literal><operator pos:start="167:52" pos:end="167:52">)</operator></expr></argument>, <argument pos:start="167:55" pos:end="167:70"><expr pos:start="167:55" pos:end="167:70"><name pos:start="167:55" pos:end="167:70"><name pos:start="167:55" pos:end="167:60">fdctrl</name><operator pos:start="167:61" pos:end="167:62">-&gt;</operator><name pos:start="167:63" pos:end="167:70">data_len</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        <if_stmt pos:start="169:9" pos:end="199:9"><if pos:start="169:9" pos:end="193:9">if <condition pos:start="169:12" pos:end="175:56">(<expr pos:start="169:13" pos:end="175:55"><operator pos:start="169:13" pos:end="169:13">(</operator><operator pos:start="169:14" pos:end="169:14">(</operator><name pos:start="169:15" pos:end="169:23">direction</name> <operator pos:start="169:25" pos:end="169:26">==</operator> <name pos:start="169:28" pos:end="169:39">FD_DIR_SCANE</name> <operator pos:start="169:41" pos:end="169:42">||</operator> <name pos:start="169:44" pos:end="169:52">direction</name> <operator pos:start="169:54" pos:end="169:55">==</operator> <name pos:start="169:57" pos:end="169:68">FD_DIR_SCANL</name> <operator pos:start="169:70" pos:end="169:71">||</operator>

              <name pos:start="171:15" pos:end="171:23">direction</name> <operator pos:start="171:25" pos:end="171:26">==</operator> <name pos:start="171:28" pos:end="171:39">FD_DIR_SCANH</name><operator pos:start="171:40" pos:end="171:40">)</operator> <operator pos:start="171:42" pos:end="171:43">&amp;&amp;</operator> <name pos:start="171:45" pos:end="171:52">dma_mode</name> <operator pos:start="171:54" pos:end="171:55">==</operator> <literal type="number" pos:start="171:57" pos:end="171:57">0</literal><operator pos:start="171:58" pos:end="171:58">)</operator> <operator pos:start="171:60" pos:end="171:61">||</operator>

            <operator pos:start="173:13" pos:end="173:13">(</operator><name pos:start="173:14" pos:end="173:22">direction</name> <operator pos:start="173:24" pos:end="173:25">==</operator> <name pos:start="173:27" pos:end="173:38">FD_DIR_WRITE</name> <operator pos:start="173:40" pos:end="173:41">&amp;&amp;</operator> <name pos:start="173:43" pos:end="173:50">dma_mode</name> <operator pos:start="173:52" pos:end="173:53">==</operator> <literal type="number" pos:start="173:55" pos:end="173:55">2</literal><operator pos:start="173:56" pos:end="173:56">)</operator> <operator pos:start="173:58" pos:end="173:59">||</operator>

            <operator pos:start="175:13" pos:end="175:13">(</operator><name pos:start="175:14" pos:end="175:22">direction</name> <operator pos:start="175:24" pos:end="175:25">==</operator> <name pos:start="175:27" pos:end="175:37">FD_DIR_READ</name> <operator pos:start="175:39" pos:end="175:40">&amp;&amp;</operator> <name pos:start="175:42" pos:end="175:49">dma_mode</name> <operator pos:start="175:51" pos:end="175:52">==</operator> <literal type="number" pos:start="175:54" pos:end="175:54">1</literal><operator pos:start="175:55" pos:end="175:55">)</operator></expr>)</condition> <block pos:start="175:58" pos:end="193:9">{<block_content pos:start="179:13" pos:end="191:19">

            <comment type="block" pos:start="177:13" pos:end="177:71">/* No access is allowed until DMA transfer has completed */</comment>

            <expr_stmt pos:start="179:13" pos:end="179:39"><expr pos:start="179:13" pos:end="179:38"><name pos:start="179:13" pos:end="179:23"><name pos:start="179:13" pos:end="179:18">fdctrl</name><operator pos:start="179:19" pos:end="179:20">-&gt;</operator><name pos:start="179:21" pos:end="179:23">msr</name></name> <operator pos:start="179:25" pos:end="179:26">&amp;=</operator> <operator pos:start="179:28" pos:end="179:28">~</operator><name pos:start="179:29" pos:end="179:38">FD_MSR_RQM</name></expr>;</expr_stmt>

            <comment type="block" pos:start="181:13" pos:end="185:15">/* Now, we just have to wait for the DMA controller to

             * recall us...

             */</comment>

            <expr_stmt pos:start="187:13" pos:end="187:45"><expr pos:start="187:13" pos:end="187:44"><call pos:start="187:13" pos:end="187:44"><name pos:start="187:13" pos:end="187:25">DMA_hold_DREQ</name><argument_list pos:start="187:26" pos:end="187:44">(<argument pos:start="187:27" pos:end="187:43"><expr pos:start="187:27" pos:end="187:43"><name pos:start="187:27" pos:end="187:43"><name pos:start="187:27" pos:end="187:32">fdctrl</name><operator pos:start="187:33" pos:end="187:34">-&gt;</operator><name pos:start="187:35" pos:end="187:43">dma_chann</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <expr_stmt pos:start="189:13" pos:end="189:44"><expr pos:start="189:13" pos:end="189:43"><call pos:start="189:13" pos:end="189:43"><name pos:start="189:13" pos:end="189:24">DMA_schedule</name><argument_list pos:start="189:25" pos:end="189:43">(<argument pos:start="189:26" pos:end="189:42"><expr pos:start="189:26" pos:end="189:42"><name pos:start="189:26" pos:end="189:42"><name pos:start="189:26" pos:end="189:31">fdctrl</name><operator pos:start="189:32" pos:end="189:33">-&gt;</operator><name pos:start="189:34" pos:end="189:42">dma_chann</name></name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

            <return pos:start="191:13" pos:end="191:19">return;</return>

        </block_content>}</block></if> <else pos:start="193:11" pos:end="199:9">else <block pos:start="193:16" pos:end="199:9">{<block_content pos:start="195:13" pos:end="197:38">

            <expr_stmt pos:start="195:13" pos:end="197:38"><expr pos:start="195:13" pos:end="197:37"><call pos:start="195:13" pos:end="197:37"><name pos:start="195:13" pos:end="195:26">FLOPPY_DPRINTF</name><argument_list pos:start="195:27" pos:end="197:37">(<argument pos:start="195:28" pos:end="195:59"><expr pos:start="195:28" pos:end="195:59"><literal type="string" pos:start="195:28" pos:end="195:59">"bad dma_mode=%d direction=%d\n"</literal></expr></argument>, <argument pos:start="195:62" pos:end="195:69"><expr pos:start="195:62" pos:end="195:69"><name pos:start="195:62" pos:end="195:69">dma_mode</name></expr></argument>,

                           <argument pos:start="197:28" pos:end="197:36"><expr pos:start="197:28" pos:end="197:36"><name pos:start="197:28" pos:end="197:36">direction</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

        </block_content>}</block></else></if_stmt>

    </block_content>}</block></if></if_stmt>

    <expr_stmt pos:start="203:5" pos:end="203:47"><expr pos:start="203:5" pos:end="203:46"><call pos:start="203:5" pos:end="203:46"><name pos:start="203:5" pos:end="203:18">FLOPPY_DPRINTF</name><argument_list pos:start="203:19" pos:end="203:46">(<argument pos:start="203:20" pos:end="203:45"><expr pos:start="203:20" pos:end="203:45"><literal type="string" pos:start="203:20" pos:end="203:45">"start non-DMA transfer\n"</literal></expr></argument>)</argument_list></call></expr>;</expr_stmt>

    <expr_stmt pos:start="205:5" pos:end="205:33"><expr pos:start="205:5" pos:end="205:32"><name pos:start="205:5" pos:end="205:15"><name pos:start="205:5" pos:end="205:10">fdctrl</name><operator pos:start="205:11" pos:end="205:12">-&gt;</operator><name pos:start="205:13" pos:end="205:15">msr</name></name> <operator pos:start="205:17" pos:end="205:18">|=</operator> <name pos:start="205:20" pos:end="205:32">FD_MSR_NONDMA</name></expr>;</expr_stmt>

    <if_stmt pos:start="207:5" pos:end="209:34"><if pos:start="207:5" pos:end="209:34">if <condition pos:start="207:8" pos:end="207:34">(<expr pos:start="207:9" pos:end="207:33"><name pos:start="207:9" pos:end="207:17">direction</name> <operator pos:start="207:19" pos:end="207:20">!=</operator> <name pos:start="207:22" pos:end="207:33">FD_DIR_WRITE</name></expr>)</condition><block type="pseudo" pos:start="209:9" pos:end="209:34"><block_content pos:start="209:9" pos:end="209:34">

        <expr_stmt pos:start="209:9" pos:end="209:34"><expr pos:start="209:9" pos:end="209:33"><name pos:start="209:9" pos:end="209:19"><name pos:start="209:9" pos:end="209:14">fdctrl</name><operator pos:start="209:15" pos:end="209:16">-&gt;</operator><name pos:start="209:17" pos:end="209:19">msr</name></name> <operator pos:start="209:21" pos:end="209:22">|=</operator> <name pos:start="209:24" pos:end="209:33">FD_MSR_DIO</name></expr>;</expr_stmt></block_content></block></if></if_stmt>

    <comment type="block" pos:start="211:5" pos:end="211:42">/* IO based transfer: calculate len */</comment>

    <expr_stmt pos:start="213:5" pos:end="213:29"><expr pos:start="213:5" pos:end="213:28"><call pos:start="213:5" pos:end="213:28"><name pos:start="213:5" pos:end="213:20">fdctrl_raise_irq</name><argument_list pos:start="213:21" pos:end="213:28">(<argument pos:start="213:22" pos:end="213:27"><expr pos:start="213:22" pos:end="213:27"><name pos:start="213:22" pos:end="213:27">fdctrl</name></expr></argument>)</argument_list></call></expr>;</expr_stmt>

</block_content>}</block></function>
</unit>
